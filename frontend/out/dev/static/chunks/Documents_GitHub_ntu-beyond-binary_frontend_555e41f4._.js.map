{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/lib/use-mediapipe-face.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useRef, useState } from 'react'\r\nimport { FaceLandmarker, FilesetResolver } from '@mediapipe/tasks-vision'\r\n\r\nexport interface FaceDetectionResult {\n    blinkDetected: boolean\n    gazeDirection: { x: number; y: number } | null\n    headRotation: { pitch: number; yaw: number; roll: number } | null\n    faceDetected: boolean\n    ready: boolean\n}\n\r\nexport function useMediaPipeFace(videoElement: HTMLVideoElement | null, enabled: boolean) {\n    const [result, setResult] = useState<FaceDetectionResult>({\n        blinkDetected: false,\n        gazeDirection: null,\n        headRotation: null,\n        faceDetected: false,\n        ready: false\n    })\n    const [isReady, setIsReady] = useState(false)\n\r\n    const faceLandmarkerRef = useRef<FaceLandmarker | null>(null)\r\n    const lastBlinkTimeRef = useRef<number>(0)\r\n    const animationFrameRef = useRef<number>(0)\r\n    const frameCountRef = useRef<number>(0)\r\n\r\n    // Initialize MediaPipe\r\n    useEffect(() => {\r\n        if (!enabled) return\r\n\r\n        let isActive = true\r\n\r\n        const initializeFaceLandmarker = async () => {\r\n            try {\r\n                console.log('ðŸ” Initializing MediaPipe FaceLandmarker...')\r\n\r\n                const vision = await FilesetResolver.forVisionTasks(\r\n                    'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'\r\n                )\r\n\r\n                const faceLandmarker = await FaceLandmarker.createFromOptions(vision, {\r\n                    baseOptions: {\r\n                        modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',\r\n                        delegate: 'GPU'\r\n                    },\r\n                    runningMode: 'VIDEO',\r\n                    numFaces: 1,\r\n                    minFaceDetectionConfidence: 0.5,\r\n                    minFacePresenceConfidence: 0.5,\r\n                    minTrackingConfidence: 0.5,\r\n                    outputFaceBlendshapes: true,\r\n                    outputFacialTransformationMatrixes: true\r\n                })\r\n\r\n                if (isActive) {\n                    faceLandmarkerRef.current = faceLandmarker\n                    setIsReady(true)\n                    setResult(prev => ({ ...prev, ready: true }))\n                    console.log('âœ“ MediaPipe FaceLandmarker ready')\n                }\n            } catch (error) {\n                console.error('Failed to initialize FaceLandmarker:', error)\n            }\n        }\n\r\n        initializeFaceLandmarker()\r\n\r\n        return () => {\r\n            isActive = false\r\n            if (animationFrameRef.current) {\n                cancelAnimationFrame(animationFrameRef.current)\n            }\n            setIsReady(false)\n            setResult(prev => ({ ...prev, ready: false, faceDetected: false, blinkDetected: false, gazeDirection: null, headRotation: null }))\n        }\n    }, [enabled])\n\r\n    // Process video frames\r\n    useEffect(() => {\r\n        if (!enabled || !videoElement || !isReady || !faceLandmarkerRef.current) {\n            console.log('ðŸ“¹ MediaPipe frame processing NOT starting:', {\n                enabled,\n                hasVideo: !!videoElement,\n                isReady,\n                hasFaceLandmarker: !!faceLandmarkerRef.current\n            })\n            return\n        }\n\r\n        console.log('ðŸ“¹ MediaPipe frame processing STARTING', {\r\n            videoWidth: videoElement.videoWidth,\r\n            videoHeight: videoElement.videoHeight,\r\n            readyState: videoElement.readyState,\r\n            paused: videoElement.paused\r\n        })\r\n\r\n        let isProcessing = false\r\n\r\n        const processFrame = async () => {\r\n            if (!faceLandmarkerRef.current || !videoElement || isProcessing) {\r\n                animationFrameRef.current = requestAnimationFrame(processFrame)\r\n                return\r\n            }\r\n\r\n            if (videoElement.readyState < 2) {\r\n                animationFrameRef.current = requestAnimationFrame(processFrame)\r\n                return\r\n            }\r\n\r\n            isProcessing = true\r\n            frameCountRef.current++\r\n\r\n            try {\r\n                const startTimeMs = performance.now()\r\n                const detections = faceLandmarkerRef.current.detectForVideo(videoElement, startTimeMs)\r\n\r\n                // Log every 60 frames (~1 second)\r\n                if (frameCountRef.current % 60 === 0) {\r\n                    console.log('ðŸ“¹ MediaPipe frame', frameCountRef.current, '- Faces detected:', detections.faceLandmarks?.length || 0)\r\n                }\r\n\r\n                if (detections.faceLandmarks && detections.faceLandmarks.length > 0) {\r\n                    const landmarks = detections.faceLandmarks[0]\r\n                    const blendshapes = detections.faceBlendshapes?.[0]?.categories\r\n\r\n                    // BLINK DETECTION\r\n                    let blinkDetected = false\r\n                    if (blendshapes) {\r\n                        const leftEyeBlink = blendshapes.find(b => b.categoryName === 'eyeBlinkLeft')\r\n                        const rightEyeBlink = blendshapes.find(b => b.categoryName === 'eyeBlinkRight')\r\n\r\n                        const leftScore = leftEyeBlink?.score || 0\r\n                        const rightScore = rightEyeBlink?.score || 0\r\n\r\n                        // Log eye scores every 60 frames\r\n                        if (frameCountRef.current % 60 === 0) {\r\n                            console.log('ðŸ‘ï¸ Eye scores:', { left: leftScore.toFixed(2), right: rightScore.toFixed(2) })\r\n                        }\r\n\r\n                        // Blink threshold: both eyes > 0.5\r\n                        if (leftScore > 0.5 && rightScore > 0.5) {\r\n                            const now = Date.now()\r\n                            if (now - lastBlinkTimeRef.current > 500) {\r\n                                blinkDetected = true\r\n                                lastBlinkTimeRef.current = now\r\n                                console.log('ðŸ‘ï¸ BLINK DETECTED!', { left: leftScore.toFixed(2), right: rightScore.toFixed(2) })\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // GAZE DIRECTION\r\n                    const leftIris = landmarks[468]\r\n                    const rightIris = landmarks[473]\r\n                    const noseTip = landmarks[1]\r\n\r\n                    let gazeDirection = null\r\n                    if (leftIris && rightIris && noseTip) {\r\n                        const avgIrisX = (leftIris.x + rightIris.x) / 2\r\n                        const avgIrisY = (leftIris.y + rightIris.y) / 2\r\n\r\n                        gazeDirection = {\r\n                            x: (avgIrisX - noseTip.x) * 10,\r\n                            y: (avgIrisY - noseTip.y) * 10\r\n                        }\r\n\r\n                        // Log gaze every 60 frames\r\n                        if (frameCountRef.current % 60 === 0) {\r\n                            console.log('ðŸ‘€ Gaze:', { x: gazeDirection.x.toFixed(2), y: gazeDirection.y.toFixed(2) })\r\n                        }\r\n                    }\r\n\r\n                    // HEAD ROTATION\r\n                    let headRotation = null\r\n                    if (detections.facialTransformationMatrixes && detections.facialTransformationMatrixes.length > 0) {\r\n                        const matrix = detections.facialTransformationMatrixes[0].data\r\n\r\n                        const pitch = Math.asin(-matrix[6]) * (180 / Math.PI)\r\n                        const yaw = Math.atan2(matrix[2], matrix[10]) * (180 / Math.PI)\r\n                        const roll = Math.atan2(matrix[4], matrix[5]) * (180 / Math.PI)\r\n\r\n                        headRotation = { pitch, yaw, roll }\r\n\r\n                        // Log head rotation every 60 frames\r\n                        if (frameCountRef.current % 60 === 0) {\r\n                            const total = Math.abs(pitch) + Math.abs(yaw) + Math.abs(roll)\r\n                            console.log('ðŸ—£ï¸ Head:', { pitch: pitch.toFixed(1), yaw: yaw.toFixed(1), roll: roll.toFixed(1), total: total.toFixed(1) })\r\n                        }\r\n                    }\r\n\r\n                    setResult({\n                        blinkDetected,\n                        gazeDirection,\n                        headRotation,\n                        faceDetected: true,\n                        ready: true\n                    })\n                } else {\n                    setResult({\n                        blinkDetected: false,\n                        gazeDirection: null,\n                        headRotation: null,\n                        faceDetected: false,\n                        ready: true\n                    })\n                }\n            } catch (error) {\r\n                console.error('Error processing frame:', error)\r\n            }\r\n\r\n            isProcessing = false\r\n            animationFrameRef.current = requestAnimationFrame(processFrame)\r\n        }\r\n\r\n        processFrame()\r\n\r\n        return () => {\r\n            if (animationFrameRef.current) {\r\n                cancelAnimationFrame(animationFrameRef.current)\r\n            }\r\n        }\r\n    }, [enabled, videoElement, isReady])\n\r\n    return result\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/lib/use-local-speech.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useRef, useState, useMemo } from 'react'\r\n\r\ninterface LocalSpeechResult {\r\n    text: string\r\n    confidence: number\r\n    timestamp: number\r\n}\r\n\r\ninterface LocalSpeechStatus {\r\n    available: boolean\r\n    recording: boolean\r\n    error: string | null\r\n    serviceUrl: string\r\n}\r\n\r\nconst SPEECH_SERVICE_URL = 'http://localhost:5050'\r\nconst RECORDING_INTERVAL = 1500 // Record 1.5 second chunks for faster response\r\n\r\n/**\r\n * Hook for local speech recognition using Whisper\r\n * Records audio chunks and sends them to local Python service\r\n */\r\nexport function useLocalSpeech(enabled: boolean) {\r\n    const initCountRef = useRef(0)\r\n    initCountRef.current++\r\n    \r\n    // Only log every 10th init to avoid console spam\r\n    if (initCountRef.current % 10 === 0) {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Hook initialized (count:', initCountRef.current, '), enabled:', enabled)\r\n    }\r\n    \r\n    const [transcription, setTranscription] = useState<LocalSpeechResult | null>(null)\r\n    const [status, setStatus] = useState<LocalSpeechStatus>({\r\n        available: false,\r\n        recording: false,\r\n        error: null,\r\n        serviceUrl: SPEECH_SERVICE_URL\r\n    })\r\n\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null)\r\n    const audioChunksRef = useRef<Blob[]>([])\r\n    const recordingIntervalRef = useRef<number | null>(null)\r\n    const isProcessingRef = useRef(false)\r\n    const serviceCheckIntervalRef = useRef<number | null>(null)\r\n\r\n    // Check if service is available - IMMEDIATE execution\r\n    useEffect(() => {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] ðŸ”¥ Service check effect RUNNING')\r\n        const checkService = async () => {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Checking service at:', SPEECH_SERVICE_URL)\r\n            try {\r\n                const controller = new AbortController()\r\n                const timeoutId = setTimeout(() => controller.abort(), 2000)\r\n                \r\n                const response = await fetch(`${SPEECH_SERVICE_URL}/health`, {\r\n                    method: 'GET',\r\n                    signal: controller.signal\r\n                })\r\n                \r\n                clearTimeout(timeoutId)\r\n                \r\n                if (response.ok) {\r\n                    const data = await response.json()\r\n                    console.log('ðŸŽ¤ [LOCAL SPEECH] âœ… Service available:', data)\r\n                    setStatus(prev => {\r\n                        // Only update if status changed\r\n                        if (prev.available !== true || prev.error !== null) {\r\n                            return { ...prev, available: true, error: null }\r\n                        }\r\n                        return prev\r\n                    })\r\n                } else {\r\n                    throw new Error(`Service returned ${response.status}`)\r\n                }\r\n            } catch (err: any) {\r\n                console.warn('ðŸŽ¤ [LOCAL SPEECH] âŒ Service not available:', err.message)\r\n                console.warn('ðŸŽ¤ [LOCAL SPEECH] Make sure to run: python speech_service.py')\r\n                setStatus(prev => {\r\n                    // Only update if status changed\r\n                    const newError = 'Service not running. Start with: python speech_service.py'\r\n                    if (prev.available !== false || prev.error !== newError) {\r\n                        return { ...prev, available: false, error: newError }\r\n                    }\r\n                    return prev\r\n                })\r\n            }\r\n        }\r\n\r\n        // Run check immediately\r\n        checkService()\r\n        \r\n        // Then check every 10s\r\n        if (serviceCheckIntervalRef.current) {\r\n            clearInterval(serviceCheckIntervalRef.current)\r\n        }\r\n        serviceCheckIntervalRef.current = window.setInterval(checkService, 10000)\r\n        \r\n        return () => {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Cleaning up service check interval')\r\n            if (serviceCheckIntervalRef.current) {\r\n                clearInterval(serviceCheckIntervalRef.current)\r\n                serviceCheckIntervalRef.current = null\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    // Start/stop recording based on enabled state\r\n    useEffect(() => {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Recording effect triggered', { enabled, available: status.available })\r\n        \r\n        if (!enabled || !status.available) {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Not starting recording - enabled:', enabled, 'available:', status.available)\r\n            stopRecording()\r\n            return\r\n        }\r\n\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] âœ… Starting local speech recognition...')\r\n        startRecording()\r\n\r\n        return () => {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Cleanup - stopping local speech recognition')\r\n            stopRecording()\r\n        }\r\n    }, [enabled, status.available])\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\r\n            \r\n            // Use webm format for better compatibility\r\n            const mimeType = MediaRecorder.isTypeSupported('audio/webm') \r\n                ? 'audio/webm' \r\n                : 'audio/wav'\r\n            \r\n            mediaRecorderRef.current = new MediaRecorder(stream, {\r\n                mimeType,\r\n                audioBitsPerSecond: 16000 // Lower quality for faster processing\r\n            })\r\n\r\n            mediaRecorderRef.current.ondataavailable = (event) => {\r\n                if (event.data.size > 0) {\r\n                    audioChunksRef.current.push(event.data)\r\n                }\r\n            }\r\n\r\n            mediaRecorderRef.current.onstop = async () => {\r\n                if (audioChunksRef.current.length === 0) return\r\n                if (isProcessingRef.current) return\r\n\r\n                const audioBlob = new Blob(audioChunksRef.current, { type: mimeType })\r\n                audioChunksRef.current = []\r\n\r\n                // Only process if blob has reasonable size (some audio was captured)\r\n                if (audioBlob.size > 1000) {\r\n                    await sendAudioToService(audioBlob)\r\n                }\r\n\r\n                // Restart recording if still enabled\r\n                if (enabled && status.available && mediaRecorderRef.current) {\r\n                    audioChunksRef.current = []\r\n                    mediaRecorderRef.current.start()\r\n                    \r\n                    // Stop and process after interval\r\n                    if (recordingIntervalRef.current) {\r\n                        clearTimeout(recordingIntervalRef.current)\r\n                    }\r\n                    recordingIntervalRef.current = window.setTimeout(() => {\r\n                        if (mediaRecorderRef.current?.state === 'recording') {\r\n                            mediaRecorderRef.current.stop()\r\n                        }\r\n                    }, RECORDING_INTERVAL)\r\n                }\r\n            }\r\n\r\n            // Start recording\r\n            mediaRecorderRef.current.start()\r\n            setStatus(prev => ({ ...prev, recording: true }))\r\n            console.log('ðŸŽ¤ Recording started with format:', mimeType)\r\n\r\n            // Stop after interval to process\r\n            recordingIntervalRef.current = window.setTimeout(() => {\r\n                if (mediaRecorderRef.current?.state === 'recording') {\r\n                    mediaRecorderRef.current.stop()\r\n                }\r\n            }, RECORDING_INTERVAL)\r\n\r\n        } catch (err: any) {\r\n            console.error('ðŸŽ¤ Failed to start recording:', err)\r\n            setStatus(prev => ({ ...prev, recording: false, error: err.message }))\r\n        }\r\n    }\r\n\r\n    const stopRecording = () => {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Stopping recording...')\r\n        \r\n        if (recordingIntervalRef.current) {\r\n            clearTimeout(recordingIntervalRef.current)\r\n            recordingIntervalRef.current = null\r\n        }\r\n\r\n        if (mediaRecorderRef.current) {\r\n            try {\r\n                if (mediaRecorderRef.current.state === 'recording' || mediaRecorderRef.current.state === 'paused') {\r\n                    console.log('ðŸŽ¤ [LOCAL SPEECH] Stopping MediaRecorder')\r\n                    mediaRecorderRef.current.stop()\r\n                }\r\n                \r\n                // Stop all tracks\r\n                if (mediaRecorderRef.current.stream) {\r\n                    console.log('ðŸŽ¤ [LOCAL SPEECH] Stopping audio tracks')\r\n                    mediaRecorderRef.current.stream.getTracks().forEach(track => {\r\n                        track.stop()\r\n                        console.log('ðŸŽ¤ [LOCAL SPEECH] Stopped track:', track.kind)\r\n                    })\r\n                }\r\n            } catch (err) {\r\n                console.warn('ðŸŽ¤ [LOCAL SPEECH] Error stopping recording:', err)\r\n            }\r\n            \r\n            mediaRecorderRef.current = null\r\n        }\r\n\r\n        audioChunksRef.current = []\r\n        isProcessingRef.current = false\r\n        setStatus(prev => ({ ...prev, recording: false }))\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Recording fully stopped')\r\n    }\r\n\r\n    const sendAudioToService = async (audioBlob: Blob) => {\r\n        if (isProcessingRef.current) return\r\n        \r\n        isProcessingRef.current = true\r\n        \r\n        try {\r\n            console.log('ðŸŽ¤ Sending audio to service...', audioBlob.size, 'bytes')\r\n            \r\n            const formData = new FormData()\r\n            formData.append('audio', audioBlob, 'audio.webm')\r\n\r\n            const response = await fetch(`${SPEECH_SERVICE_URL}/transcribe`, {\r\n                method: 'POST',\r\n                body: formData,\r\n                signal: AbortSignal.timeout(10000) // 10s timeout\r\n            })\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Service returned ${response.status}`)\r\n            }\r\n\r\n            const result = await response.json()\r\n            \r\n            if (result.text && result.text.trim().length > 0) {\r\n                console.log('ðŸŽ¤ Transcription received:', result.text)\r\n                setTranscription({\r\n                    text: result.text,\r\n                    confidence: result.confidence || 0.8,\r\n                    timestamp: Date.now()\r\n                })\r\n            } else {\r\n                console.log('ðŸŽ¤ No speech detected in chunk')\r\n            }\r\n\r\n        } catch (err: any) {\r\n            console.error('ðŸŽ¤ Failed to transcribe:', err.message)\r\n            setStatus(prev => ({ ...prev, error: err.message }))\r\n        } finally {\r\n            isProcessingRef.current = false\r\n        }\r\n    }\r\n\r\n    // Memoize return value to prevent unnecessary re-renders\r\n    return useMemo(() => ({\r\n        transcription,\r\n        status\r\n    }), [transcription, status])\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 535, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/lib/use-passive-sensing.ts"],"sourcesContent":["'use client'\n\nimport { useEffect, useRef, useState, useCallback } from 'react'\nimport { useMediaPipeFace } from './use-mediapipe-face'\nimport { useLocalSpeech } from './use-local-speech'\n\nexport type InputType = 'voice' | 'motion' | 'switch' | 'blink' | 'gaze' | 'head' | 'sign' | 'facial' | 'sip-puff' | 'none'\n\ninterface PassiveSensingResult {\n    type: InputType\n    confidence: number\n    data?: any\n}\n\ninterface TranscriptionResult {\n    text: string\n    timestamp: number\n    confidence: number\n}\n\nexport interface PassiveSensingStatus {\n    audioReady: boolean\n    videoReady: boolean\n    speechAvailable: boolean\n    speechActive: boolean\n    speechError: string | null\n    mediaPipeReady: boolean\n    faceDetected: boolean\n    detectionLocked: boolean\n    audioLevel: number\n    lastTranscript: string\n    lastSpeechEvent: string\n    speechEventCounts: Record<string, number>\n    localSpeechAvailable?: boolean\n    localSpeechRecording?: boolean\n    localSpeechError?: string | null\n}\n\nexport interface PassiveSensingOptions {\n    voiceVolumeThreshold?: number\n    voiceConsecutiveFrames?: number\n    disableGaze?: boolean\n    disableVoiceVolume?: boolean\n    suppressVoiceWhileSpeaking?: boolean\n    allowedInputTypes?: InputType[]\n}\n\nexport function usePassiveSensing(enabled: boolean, options: PassiveSensingOptions = {}) {\n    const voiceVolumeThreshold = options.voiceVolumeThreshold ?? 10\n    const voiceConsecutiveFrames = options.voiceConsecutiveFrames ?? 2\n    const disableGaze = options.disableGaze ?? false\n    const disableVoiceVolume = options.disableVoiceVolume ?? false\n    const suppressVoiceWhileSpeaking = options.suppressVoiceWhileSpeaking ?? false\n    const allowedInputTypes = options.allowedInputTypes ?? null\n    const [detectedInput, setDetectedInput] = useState<PassiveSensingResult | null>(null)\n    const [transcription, setTranscription] = useState<TranscriptionResult | null>(null)\n    const [audioLevel, setAudioLevel] = useState(0)\n    const [videoElement, setVideoElement] = useState<HTMLVideoElement | null>(null)\n    const [audioReady, setAudioReady] = useState(false)\n    const [videoReady, setVideoReady] = useState(false)\n    const [speechAvailable, setSpeechAvailable] = useState(false)\n    const [speechActive, setSpeechActive] = useState(false)\n    const [speechError, setSpeechError] = useState<string | null>(null)\n    const [lastTranscript, setLastTranscript] = useState<string>('')\n    const [lastSpeechEvent, setLastSpeechEvent] = useState<string>('none')\n    const [speechEventCounts, setSpeechEventCounts] = useState<Record<string, number>>({})\n    const audioContextRef = useRef<AudioContext | null>(null)\n    const analyserRef = useRef<AnalyserNode | null>(null)\n    const recognitionRef = useRef<any>(null)\n    const recognitionActiveRef = useRef<boolean>(false)\n    const speechRestartTimerRef = useRef<number | null>(null)\n    const detectionLockRef = useRef<boolean>(false)\n    const streamRef = useRef<MediaStream | null>(null)\n    const headPitchHistoryRef = useRef<Array<{ t: number; pitch: number }>>([])\n    const lastNodTimeRef = useRef<number>(0)\n    const lastPitchRef = useRef<number | null>(null)\n    const lastPitchDirRef = useRef<1 | -1 | 0>(0)\n    \n    // Reset detection lock when enabled changes (but DON'T clear detectedInput state)\n    useEffect(() => {\n        if (enabled) {\n            console.log('ðŸ”“ Resetting detection lock (detectionLockRef only)')\n            detectionLockRef.current = false\n            // DON'T reset setDetectedInput here - it clears valid detections!\n        }\n    }, [enabled])\n\n    // Callback ref for video element\n    const videoRef = useCallback((node: HTMLVideoElement | null) => {\n        if (node) {\n            console.log('ðŸ“¹ Video element mounted')\n            setVideoElement(node)\n            if (streamRef.current) {\n                node.srcObject = streamRef.current\n                node.play().catch(() => {\n                    // Autoplay can fail until user gesture; keep stream attached.\n                })\n            }\n        }\n    }, [])\n\n    // MediaPipe face detection\n    const faceDetection = useMediaPipeFace(videoElement, enabled)\n\n    // Local speech recognition (Whisper-based) - memoize to prevent re-renders\n    const shouldEnableLocalSpeech = enabled && !disableVoiceVolume && (!allowedInputTypes || allowedInputTypes.includes('voice'))\n    const localSpeech = useLocalSpeech(shouldEnableLocalSpeech)\n\n    // Update transcription from local speech - use timestamp to avoid re-render loops\n    const lastTranscriptionTimestampRef = useRef<number>(0)\n    useEffect(() => {\n        if (localSpeech.transcription) {\n            // Only process if this is a NEW transcription\n            if (localSpeech.transcription.timestamp !== lastTranscriptionTimestampRef.current) {\n                lastTranscriptionTimestampRef.current = localSpeech.transcription.timestamp\n                \n                console.log('ðŸŽ¤ Local speech transcription:', localSpeech.transcription.text)\n                setLastTranscript(localSpeech.transcription.text)\n                setTranscription(localSpeech.transcription)\n\n                // Detect voice input from transcription\n                if (!detectionLockRef.current && localSpeech.transcription.text.trim().length > 0) {\n                    console.log('ðŸŽ¤ Voice detected via local transcription')\n                    detectionLockRef.current = true\n                    setDetectedInput({\n                        type: 'voice',\n                        confidence: localSpeech.transcription.confidence,\n                        data: { text: localSpeech.transcription.text }\n                    })\n                }\n            }\n        }\n    }, [localSpeech.transcription?.timestamp])\n\n    useEffect(() => {\n        console.log('ðŸŽ¤ usePassiveSensing effect triggered', {\n            enabled,\n            suppressVoiceWhileSpeaking,\n            allowedInputTypes,\n            disableVoiceVolume,\n            localSpeechAvailable: localSpeech.status.available,\n            localSpeechRecording: localSpeech.status.recording\n        })\n        \n        if (!enabled) {\n            console.log('ðŸŽ¤ Hook is disabled, not starting')\n            return\n        }\n\n        let animationFrameId: number\n        let stream: MediaStream | null = null\n\n        // AUDIO DETECTION + LIVE TRANSCRIPTION\n        const setupAudio = async () => {\n            try {\n                console.log('ðŸŽ¤ Requesting audio access...')\n                const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true })\n\n                audioContextRef.current = new AudioContext()\n                analyserRef.current = audioContextRef.current.createAnalyser()\n                const source = audioContextRef.current.createMediaStreamSource(audioStream)\n                source.connect(analyserRef.current)\n                analyserRef.current.fftSize = 2048\n                analyserRef.current.smoothingTimeConstant = 0.8\n\n                console.log('âœ“ Audio detection ready, analyser:', analyserRef.current)\n                setAudioReady(true)\n\n                const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition\n                if (SpeechRecognition) {\n                    console.log('ðŸŽ¤ Speech Recognition API available')\n                    setSpeechAvailable(true)\n                    if (!recognitionRef.current) {\n                        console.log('ðŸŽ¤ Creating new SpeechRecognition instance')\n                        recognitionRef.current = new SpeechRecognition()\n                        recognitionRef.current.continuous = true\n                        recognitionRef.current.interimResults = true\n                        recognitionRef.current.lang = 'en-US'\n                        console.log('ðŸŽ¤ SpeechRecognition configured:', {\n                            continuous: recognitionRef.current.continuous,\n                            interimResults: recognitionRef.current.interimResults,\n                            lang: recognitionRef.current.lang\n                        })\n                    } else {\n                        console.log('ðŸŽ¤ Reusing existing SpeechRecognition instance')\n                    }\n\n                    const bumpEvent = (name: string) => {\n                        console.log(`ðŸŽ¤ Speech event: ${name}`)\n                        setLastSpeechEvent(name)\n                        setSpeechEventCounts(prev => ({\n                            ...prev,\n                            [name]: (prev[name] || 0) + 1\n                        }))\n                    }\n\n                    recognitionRef.current.onstart = () => {\n                        console.log('ðŸŽ¤ STARTED - Recognition is now listening')\n                        setSpeechActive(true)\n                        bumpEvent('start')\n                    }\n                    recognitionRef.current.onaudiostart = () => {\n                        console.log('ðŸŽ¤ AUDIO START - User agent has started to capture audio')\n                        bumpEvent('audio_start')\n                    }\n                    recognitionRef.current.onsoundstart = () => {\n                        console.log('ðŸŽ¤ SOUND START - Any sound (including speech) has been detected')\n                        bumpEvent('sound_start')\n                    }\n                    recognitionRef.current.onspeechstart = () => {\n                        console.log('ðŸŽ¤ SPEECH START - Speech recognized by speech detection')\n                        bumpEvent('speech_start')\n                    }\n                    recognitionRef.current.onspeechend = () => {\n                        console.log('ðŸŽ¤ SPEECH END - Speech has stopped being detected')\n                        bumpEvent('speech_end')\n                    }\n                    recognitionRef.current.onaudioend = () => {\n                        console.log('ðŸŽ¤ AUDIO END - User agent has finished capturing audio')\n                        bumpEvent('audio_end')\n                    }\n                    recognitionRef.current.onnomatch = () => {\n                        console.log('ðŸŽ¤ NO MATCH - Speech was detected but no recognition result')\n                        bumpEvent('no_match')\n                    }\n\n                    recognitionRef.current.onresult = (event: any) => {\n                        const last = event.results.length - 1\n                        const text = event.results[last][0].transcript\n                        const confidence = event.results[last][0].confidence\n                        const isFinal = event.results[last].isFinal\n\n                        console.log('ðŸŽ¤ RESULT:', {\n                            text,\n                            confidence,\n                            isFinal,\n                            resultCount: event.results.length,\n                            suppressVoiceWhileSpeaking,\n                            isTTSSpeaking: window.speechSynthesis.speaking,\n                            allowedInputTypes,\n                            detectionLocked: detectionLockRef.current\n                        })\n                        \n                        bumpEvent('result')\n                        setLastTranscript(text.trim())\n\n                        if (suppressVoiceWhileSpeaking && window.speechSynthesis.speaking) {\n                            console.log('ðŸŽ¤ BLOCKED: TTS is speaking, ignoring transcription')\n                            return\n                        }\n                        if (allowedInputTypes && !allowedInputTypes.includes('voice')) {\n                            console.log('ðŸŽ¤ BLOCKED: voice not in allowedInputTypes:', allowedInputTypes)\n                            return\n                        }\n\n                        console.log('ðŸŽ¤ Setting transcription state:', text.trim())\n                        setTranscription({\n                            text: text.trim(),\n                            timestamp: Date.now(),\n                            confidence: confidence || 0.8\n                        })\n\n                        if (!detectionLockRef.current && text.trim().length > 0) {\n                            console.log('ðŸŽ¤ Voice detected via transcription, setting detectedInput')\n                            detectionLockRef.current = true\n                            setDetectedInput({\n                                type: 'voice',\n                                confidence: confidence || 0.8,\n                                data: { text }\n                            })\n                        } else if (detectionLockRef.current) {\n                            console.log('ðŸŽ¤ Detection lock is active, not setting detectedInput')\n                        }\n                    }\n\n                    recognitionRef.current.onerror = (event: any) => {\n                        console.log('ðŸŽ¤ ERROR:', {\n                            error: event.error,\n                            message: event.message,\n                            willRestart: event.error === 'aborted'\n                        })\n                        bumpEvent('error')\n                        \n                        // Silently ignore network and no-speech errors\n                        if (event.error === 'network' || event.error === 'no-speech') {\n                            console.log('ðŸŽ¤ Ignoring network/no-speech error')\n                            return\n                        }\n                        \n                        setSpeechError(event.error || 'unknown')\n                        if (event.error === 'aborted') {\n                            console.log('ðŸŽ¤ Scheduling restart after abort')\n                            scheduleSpeechRestart()\n                        }\n                    }\n                    \n                    recognitionRef.current.onend = () => {\n                        console.log('ðŸŽ¤ END - Recognition has stopped', {\n                            wasActive: recognitionActiveRef.current,\n                            enabled,\n                            willRestart: enabled\n                        })\n                        bumpEvent('end')\n                        recognitionActiveRef.current = false\n                        setSpeechActive(false)\n                        if (!enabled) {\n                            console.log('ðŸŽ¤ Not enabled, not restarting')\n                            return\n                        }\n                        console.log('ðŸŽ¤ Scheduling restart')\n                        scheduleSpeechRestart()\n                    }\n\n                    console.log('ðŸŽ¤ All event handlers attached, calling startSpeechRecognition()')\n                    startSpeechRecognition()\n                } else {\n                    console.warn('âš ï¸ Speech Recognition API not available')\n                    setSpeechAvailable(false)\n                }\n            } catch (err) {\n                console.warn('Audio access denied:', err)\n                setAudioReady(false)\n            }\n        }\n\n        // VIDEO DETECTION\n        const setupVideo = async () => {\n            try {\n                stream = await navigator.mediaDevices.getUserMedia({ video: true })\n                streamRef.current = stream\n                if (videoElement) {\n                    videoElement.srcObject = stream\n                    await videoElement.play()\n                    console.log('âœ“ Video detection ready, element:', videoElement.videoWidth, 'x', videoElement.videoHeight)\n                    setVideoReady(true)\n                }\n            } catch (err) {\n                console.warn('Video access denied:', err)\n                setVideoReady(false)\n            }\n        }\n\n        // KEYBOARD / SWITCH\n        const handleKeyPress = (e: KeyboardEvent) => {\n            if (detectionLockRef.current) return\n            if (allowedInputTypes && !allowedInputTypes.includes('switch')) return\n            console.log('ðŸŽ¹ Keyboard/Switch detected:', e.key)\n            detectionLockRef.current = true\n            setDetectedInput({\n                type: 'switch',\n                confidence: 1.0,\n                data: { key: e.key }\n            })\n        }\n\n        // MOUSE MOVEMENT\n        let mousePositions: { x: number; y: number; time: number }[] = []\n        const handleMouseMove = (e: MouseEvent) => {\n            if (detectionLockRef.current) return\n            if (allowedInputTypes && !allowedInputTypes.includes('motion')) return\n\n            const now = Date.now()\n            mousePositions.push({ x: e.clientX, y: e.clientY, time: now })\n            if (mousePositions.length > 10) mousePositions.shift()\n\n            if (mousePositions.length >= 5) {\n                const recentPositions = mousePositions.slice(-5)\n                const timeSpan = recentPositions[4].time - recentPositions[0].time\n\n                if (timeSpan > 0) {\n                    const totalDistance = recentPositions.reduce((sum, pos, i) => {\n                        if (i === 0) return 0\n                        const prev = recentPositions[i - 1]\n                        const dx = pos.x - prev.x\n                        const dy = pos.y - prev.y\n                        return sum + Math.sqrt(dx * dx + dy * dy)\n                    }, 0)\n\n                    const velocity = totalDistance / (timeSpan / 1000)\n\n                    if (velocity > 50) {\n                        console.log('ðŸ–±ï¸ Mouse motion detected, velocity:', velocity.toFixed(0), 'px/sec')\n                        detectionLockRef.current = true\n                        setDetectedInput({\n                            type: 'motion',\n                            confidence: 0.9,\n                            data: { source: 'mouse', velocity }\n                        })\n                    }\n                }\n            }\n        }\n\n        // TOUCH\n        const handleTouchStart = (e: TouchEvent) => {\n            if (detectionLockRef.current) return\n            if (allowedInputTypes && !allowedInputTypes.includes('motion')) return\n            console.log('ðŸ‘† Touch detected')\n            detectionLockRef.current = true\n            setDetectedInput({\n                type: 'motion',\n                confidence: 1.0,\n                data: { source: 'touch' }\n            })\n        }\n\n        // GAMEPAD\n        const checkGamepads = () => {\n            const gamepads = navigator.getGamepads()\n            for (const gamepad of gamepads) {\n                if (gamepad && !detectionLockRef.current) {\n                    for (let i = 0; i < gamepad.buttons.length; i++) {\n                        if (gamepad.buttons[i].pressed) {\n                            if (allowedInputTypes && !allowedInputTypes.includes('switch')) return\n                            console.log('ðŸŽ® Gamepad button detected:', i)\n                            detectionLockRef.current = true\n                            setDetectedInput({\n                                type: 'switch',\n                                confidence: 1.0,\n                                data: { source: 'gamepad', button: i }\n                            })\n                            return\n                        }\n                    }\n                }\n            }\n        }\n\n        // AUDIO LEVEL MONITORING\n        const voiceDetectionCountRef = { current: 0 } // Use an object so it persists across calls\n        const monitorAudio = () => {\n            if (!analyserRef.current) return\n\n            const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount)\n            analyserRef.current.getByteFrequencyData(dataArray)\n            const average = dataArray.reduce((a, b) => a + b) / dataArray.length\n\n            setAudioLevel(average)\n\n            // Debug: Log audio level periodically\n            if (Math.random() < 0.1) { // 10% chance to log (not every frame)\n                console.log('ðŸ”Š Audio level:', average.toFixed(1))\n            }\n\n            // Audio detection via volume\n            if (\n                !disableVoiceVolume &&\n                (!suppressVoiceWhileSpeaking || !window.speechSynthesis.speaking) &&\n                average > voiceVolumeThreshold\n            ) {\n                if (allowedInputTypes && !allowedInputTypes.includes('voice')) {\n                    return\n                }\n                voiceDetectionCountRef.current++\n                if (voiceDetectionCountRef.current >= voiceConsecutiveFrames && !detectionLockRef.current) {\n                    console.log('ðŸŽ¤ Voice detected via volume, level:', average.toFixed(1), 'Setting detection lock and state...')\n                    detectionLockRef.current = true\n                    const detection = {\n                        type: 'voice' as const,\n                        confidence: Math.min(average / 50, 1.0),\n                        data: { volume: average }\n                    }\n                    console.log('ðŸŽ¤ Calling setDetectedInput with:', detection)\n                    setDetectedInput(detection)\n                }\n            } else {\n                voiceDetectionCountRef.current = 0\n            }\n        }\n\n        const monitor = () => {\n            monitorAudio()\n            checkGamepads()\n            animationFrameId = requestAnimationFrame(monitor)\n        }\n\n        console.log('ðŸ” Protocol Omega: Starting omni-listener...')\n        setupAudio()\n        setupVideo()\n        window.addEventListener('keydown', handleKeyPress)\n        window.addEventListener('mousemove', handleMouseMove)\n        window.addEventListener('touchstart', handleTouchStart)\n        monitor()\n\n        return () => {\n            console.log('ðŸ›‘ Protocol Omega: Stopping omni-listener')\n            cancelAnimationFrame(animationFrameId)\n            window.removeEventListener('keydown', handleKeyPress)\n            window.removeEventListener('mousemove', handleMouseMove)\n            window.removeEventListener('touchstart', handleTouchStart)\n            if (stream) stream.getTracks().forEach(track => track.stop())\n            if (streamRef.current) {\n                streamRef.current.getTracks().forEach(track => track.stop())\n                streamRef.current = null\n            }\n            if (audioContextRef.current) audioContextRef.current.close()\n            if (recognitionRef.current) {\n                try { recognitionRef.current.stop() } catch {}\n                recognitionActiveRef.current = false\n                setSpeechActive(false)\n            }\n            if (speechRestartTimerRef.current) {\n                clearTimeout(speechRestartTimerRef.current)\n                speechRestartTimerRef.current = null\n            }\n        }\n    }, [enabled, videoElement])\n\n    // MEDIAPIPE FACE DETECTION\n    useEffect(() => {\n        if (!enabled || detectionLockRef.current) return\n\n        console.log('ðŸ‘ï¸ Checking face detection...', {\n            enabled,\n            locked: detectionLockRef.current,\n            hasBlinkDetection: !!faceDetection.blinkDetected,\n            hasHeadRotation: !!faceDetection.headRotation,\n            hasGazeDirection: !!faceDetection.gazeDirection\n        })\n\n        // Blink detection\n        if (faceDetection.blinkDetected) {\n            if (allowedInputTypes && !allowedInputTypes.includes('blink')) return\n            console.log('ðŸ‘ï¸ BLINK DETECTED via MediaPipe!')\n            detectionLockRef.current = true\n            setDetectedInput({\n                type: 'blink',\n                confidence: 1.0,\n                data: { source: 'mediapipe' }\n            })\n            return\n        }\n\n        // Head rotation detection\n        if (faceDetection.headRotation) {\n            if (allowedInputTypes && !allowedInputTypes.includes('head')) {\n                return\n            }\n            const { pitch, yaw, roll } = faceDetection.headRotation\n            const totalRotation = Math.abs(pitch) + Math.abs(yaw) + Math.abs(roll)\n\n            // Simple nod detector: detect pitch swing with direction changes.\n            const now = Date.now()\n            const history = headPitchHistoryRef.current\n            history.push({ t: now, pitch })\n            while (history.length > 0 && now - history[0].t > 900) {\n                history.shift()\n            }\n            if (now - lastNodTimeRef.current < 800) {\n                return\n            }\n            if (history.length >= 6) {\n                let minPitch = history[0].pitch\n                let maxPitch = history[0].pitch\n                let signChanges = 0\n                let lastDir: 1 | -1 | 0 = lastPitchDirRef.current\n                let prevPitch: number | null = lastPitchRef.current\n                for (const h of history) {\n                    if (h.pitch < minPitch) minPitch = h.pitch\n                    if (h.pitch > maxPitch) maxPitch = h.pitch\n                    if (prevPitch !== null) {\n                        const delta = h.pitch - prevPitch\n                        const dir: 1 | -1 | 0 = delta > 0.2 ? 1 : delta < -0.2 ? -1 : 0\n                        if (dir !== 0 && lastDir !== 0 && dir !== lastDir) {\n                            signChanges++\n                        }\n                        if (dir !== 0) lastDir = dir\n                    }\n                    prevPitch = h.pitch\n                }\n                const swing = maxPitch - minPitch\n                if (swing >= 14 && signChanges >= 2) {\n                    console.log('HEAD NOD DETECTED', { minPitch: minPitch.toFixed(1), maxPitch: maxPitch.toFixed(1), swing: swing.toFixed(1), signChanges })\n                    lastNodTimeRef.current = now\n                    detectionLockRef.current = true\n                    headPitchHistoryRef.current = []\n                    lastPitchRef.current = null\n                    lastPitchDirRef.current = 0\n                    setDetectedInput({\n                        type: 'head',\n                        confidence: 0.95,\n                        data: { pitch, yaw, roll, nod: true }\n                    })\n                    return\n                }\n            }\n            lastPitchRef.current = pitch\n\n            // Very sensitive threshold for onboarding: >5 degrees\n            if (totalRotation > 3) {\n                console.log('ðŸ—£ï¸ HEAD MOTION DETECTED!', { pitch: pitch.toFixed(1), yaw: yaw.toFixed(1), roll: roll.toFixed(1), total: totalRotation.toFixed(1) })\n                detectionLockRef.current = true\n                setDetectedInput({\n                    type: 'head',\n                    confidence: 0.9,\n                    data: { pitch, yaw, roll }\n                })\n                return\n            }\n        }\n\n        // Gaze detection - more sensitive for onboarding\n        if (!disableGaze && faceDetection.gazeDirection) {\n            if (allowedInputTypes && !allowedInputTypes.includes('gaze')) return\n            const { x, y } = faceDetection.gazeDirection\n            const gazeDistance = Math.sqrt(x * x + y * y)\n\n            if (gazeDistance > 0.5) {\n                console.log('ðŸ‘€ GAZE DETECTED!', { x: x.toFixed(2), y: y.toFixed(2), distance: gazeDistance.toFixed(2) })\n                detectionLockRef.current = true\n                setDetectedInput({\n                    type: 'gaze',\n                    confidence: 0.85,\n                    data: { x, y }\n                })\n            }\n        }\n    }, [enabled, faceDetection])\n\n    // Auto-clear transcription\n    useEffect(() => {\n        if (!transcription) return\n        const timer = setTimeout(() => setTranscription(null), 3000)\n        return () => clearTimeout(timer)\n    }, [transcription])\n\n    // Removed old throttled logging - now done at return statement\n\n    const startSpeechRecognition = () => {\n        console.log('ðŸŽ¤ startSpeechRecognition() called', {\n            hasRecognition: !!recognitionRef.current,\n            isActive: recognitionActiveRef.current,\n            enabled,\n            isTTSSpeaking: window.speechSynthesis.speaking,\n            speechSynthesisPending: window.speechSynthesis.pending\n        })\n        \n        if (!recognitionRef.current) {\n            console.log('ðŸŽ¤ ABORT: No recognition ref')\n            return\n        }\n        if (recognitionActiveRef.current) {\n            console.log('ðŸŽ¤ ABORT: Already active')\n            return\n        }\n        \n        try {\n            console.log('ðŸŽ¤ Calling recognition.start()...')\n            recognitionRef.current.start()\n            recognitionActiveRef.current = true\n            console.log('âœ“ Live transcription ready - recognition.start() succeeded')\n            setSpeechActive(true)\n            setSpeechError(null)\n        } catch (err: any) {\n            console.error('ðŸŽ¤ FAILED to start speech recognition:', err.message, err)\n            setSpeechError('start_failed')\n        }\n    }\n\n    const scheduleSpeechRestart = () => {\n        console.log('ðŸŽ¤ scheduleSpeechRestart() called', {\n            hasRecognition: !!recognitionRef.current,\n            enabled,\n            hasExistingTimer: !!speechRestartTimerRef.current\n        })\n        \n        if (!recognitionRef.current || !enabled) {\n            console.log('ðŸŽ¤ ABORT restart: no recognition or not enabled')\n            return\n        }\n        if (speechRestartTimerRef.current) {\n            console.log('ðŸŽ¤ ABORT restart: timer already scheduled')\n            return\n        }\n        \n        console.log('ðŸŽ¤ Scheduling restart in 800ms...')\n        speechRestartTimerRef.current = window.setTimeout(() => {\n            console.log('ðŸŽ¤ Restart timer fired')\n            speechRestartTimerRef.current = null\n            startSpeechRecognition()\n        }, 800)\n    }\n\n    const status: PassiveSensingStatus = {\n        audioReady,\n        videoReady,\n        speechAvailable,\n        speechActive,\n        speechError,\n        mediaPipeReady: faceDetection.ready,\n        faceDetected: faceDetection.faceDetected,\n        detectionLocked: detectionLockRef.current,\n        audioLevel,\n        lastTranscript,\n        lastSpeechEvent,\n        speechEventCounts,\n        localSpeechAvailable: localSpeech.status.available,\n        localSpeechRecording: localSpeech.status.recording,\n        localSpeechError: localSpeech.status.error\n    }\n\n    // Periodic detailed logging (every 2s)\n    if (Math.random() < 0.03) { // ~2 second intervals at 60fps\n        console.log('ðŸ”„ usePassiveSensing STATE:', {\n            enabled,\n            hasDetectedInput: !!detectedInput,\n            detectedInputType: detectedInput?.type,\n            hasTranscription: !!transcription,\n            transcriptionText: transcription?.text,\n            audioLevel: Math.round(audioLevel),\n            speechStatus: {\n                available: speechAvailable,\n                active: speechActive,\n                error: speechError,\n                lastEvent: lastSpeechEvent,\n                lastTranscript,\n                isTTSSpeaking: window.speechSynthesis.speaking\n            }\n        })\n    }\n\n    return {\n        detectedInput,\n        transcription,\n        audioLevel,\n        videoRef,\n        faceData: faceDetection,\n        requestSpeechStart: startSpeechRecognition,\n        status\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1317, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/components/onboarding/beacon-screen.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState, useEffect, useRef } from 'react'\nimport { usePassiveSensing, type InputType } from '@/lib/use-passive-sensing'\nimport { Volume2, Eye, Hand, Keyboard, Activity, Wind, Smile, Move } from 'lucide-react'\n\nexport function BeaconScreen({ onInputDetected }: { onInputDetected: (type: InputType) => void }) {\n    const [audioPlayed, setAudioPlayed] = useState(false)\n    const [timeoutCounter, setTimeoutCounter] = useState(0)\n    const [autoScanStarted, setAutoScanStarted] = useState(false)\n    const { detectedInput, transcription, audioLevel, videoRef, faceData, status } = usePassiveSensing(true, {\n        voiceVolumeThreshold: 25,\n        voiceConsecutiveFrames: 3,\n        suppressVoiceWhileSpeaking: true\n    })\n    const scanIntervalRef = useRef<NodeJS.Timeout | null>(null)\n    const canvasRef = useRef<HTMLCanvasElement | null>(null)\n\n    // Auto-play welcome audio (ONCE)\n    useEffect(() => {\n        if (audioPlayed) return\n\n        const speak = () => {\n            window.speechSynthesis.cancel()\n            const utterance = new SpeechSynthesisUtterance(\n                'I am listening. Make any sound, move your head, or press any switch to start.'\n            )\n            utterance.rate = 0.9\n            utterance.pitch = 1.0\n            window.speechSynthesis.speak(utterance)\n            setAudioPlayed(true)\n        }\n\n        const timer = setTimeout(speak, 500)\n        return () => clearTimeout(timer)\n    }, [audioPlayed])\n\n    // Counter for timeout\n    useEffect(() => {\n        if (detectedInput) return\n\n        const interval = setInterval(() => {\n            setTimeoutCounter(prev => prev + 1)\n        }, 1000)\n\n        return () => clearInterval(interval)\n    }, [detectedInput])\n\n    // Repeat reminder every 15 seconds\n    useEffect(() => {\n        if (detectedInput || autoScanStarted || timeoutCounter === 0) return\n\n        if (timeoutCounter % 15 === 0) {\n            window.speechSynthesis.cancel()\n            const utterance = new SpeechSynthesisUtterance(\n                'Still listening. Make any sound or movement to begin.'\n            )\n            utterance.rate = 0.9\n            window.speechSynthesis.speak(utterance)\n        }\n    }, [timeoutCounter, detectedInput, autoScanStarted])\n\n    // Auto-scan mode after 30 seconds (ONCE)\n    useEffect(() => {\n        if (timeoutCounter >= 30 && !detectedInput && !autoScanStarted) {\n            setAutoScanStarted(true)\n\n            window.speechSynthesis.cancel()\n            const utterance = new SpeechSynthesisUtterance(\n                'Entering auto-scan mode. Press any key or make a sound when you hear Setup.'\n            )\n            utterance.rate = 0.8\n            window.speechSynthesis.speak(utterance)\n\n            utterance.onend = () => {\n                let scanIndex = 0\n                const options = ['Setup', 'Exit']\n\n                scanIntervalRef.current = setInterval(() => {\n                    const scanUtterance = new SpeechSynthesisUtterance(options[scanIndex])\n                    scanUtterance.rate = 0.9\n                    window.speechSynthesis.speak(scanUtterance)\n\n                    scanIndex = (scanIndex + 1) % options.length\n                }, 2000)\n            }\n        }\n    }, [timeoutCounter, detectedInput, autoScanStarted])\n\n    // Cleanup scan interval when input detected\n    useEffect(() => {\n        if (detectedInput && scanIntervalRef.current) {\n            clearInterval(scanIntervalRef.current)\n            scanIntervalRef.current = null\n            window.speechSynthesis.cancel()\n        }\n    }, [detectedInput])\n\n    // Handle detected input - for onboarding, accept ANY detection (no confidence threshold)\n    useEffect(() => {\n        console.log('ðŸš¨ BeaconScreen detectedInput changed:', detectedInput)\n        if (detectedInput) {\n            console.log('ðŸš¨ Calling onInputDetected with type:', detectedInput.type, 'confidence:', detectedInput.confidence)\n            onInputDetected(detectedInput.type)\n        }\n    }, [detectedInput, onInputDetected])\n\n    // CRITICAL: Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            window.speechSynthesis.cancel()\n            if (scanIntervalRef.current) {\n                clearInterval(scanIntervalRef.current)\n            }\n        }\n    }, [])\n\n    // Draw waveform visualization - ACCESSIBLE: Yellow on Black\n    useEffect(() => {\n        if (!canvasRef.current) return\n\n        const canvas = canvasRef.current\n        const ctx = canvas.getContext('2d')\n        if (!ctx) return\n\n        const draw = () => {\n            // Black background\n            ctx.fillStyle = '#000000'\n            ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n            const barCount = 50\n            const barWidth = canvas.width / barCount\n            const normalizedLevel = Math.min(audioLevel / 100, 1)\n\n            for (let i = 0; i < barCount; i++) {\n                const phase = (i / barCount) * Math.PI * 2\n                const amplitude = Math.sin(phase + Date.now() / 200) * 0.5 + 0.5\n                const height = amplitude * normalizedLevel * canvas.height * 0.8\n\n                // ACCESSIBLE: Solid yellow, no gradients\n                ctx.fillStyle = '#FFFF00'\n\n                const x = i * barWidth\n                const y = (canvas.height - height) / 2\n\n                ctx.fillRect(x, y, barWidth - 2, height)\n            }\n        }\n\n        draw()\n    }, [audioLevel])\n\n    return (\n        <div className=\"fixed inset-0 bg-black flex flex-col items-center justify-center\">\n            <video ref={videoRef} className=\"hidden\" playsInline muted />\n\n            <div className=\"relative mb-8\">\n                <div className=\"w-32 h-32 rounded-full bg-white animate-pulse\"\n                    style={{ animationDuration: '3s' }} />\n\n                {detectedInput && (\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                        {detectedInput.type === 'voice' && <Volume2 className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'motion' && <Activity className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'switch' && <Keyboard className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'blink' && <Eye className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'gaze' && <Eye className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'head' && <Move className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'sign' && <Hand className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'facial' && <Smile className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'sip-puff' && <Wind className=\"h-16 w-16 text-black animate-bounce\" />}\n                    </div>\n                )}\n            </div>\n\n            {/* GAZE INDICATOR - Shows where you're looking! */}\n            {faceData?.gazeDirection && (\n                <div className=\"absolute top-1/2 left-1/2 pointer-events-none\">\n                    <div\n                        className=\"w-8 h-8 rounded-full bg-red-500 border-4 border-white shadow-lg transition-transform duration-100\"\n                        style={{\n                            transform: `translate(calc(-50% + ${faceData.gazeDirection.x * 100}px), calc(-50% + ${faceData.gazeDirection.y * 100}px))`\n                        }}\n                    />\n                </div>\n            )}\n\n            {/* HEAD ROTATION INDICATOR */}\n            {faceData?.headRotation && (\n                <div className=\"absolute top-8 left-8 bg-black/80 text-white p-4 rounded-lg font-mono text-sm\">\n                    <div>Pitch: {faceData.headRotation.pitch.toFixed(1)}Â°</div>\n                    <div>Yaw: {faceData.headRotation.yaw.toFixed(1)}Â°</div>\n                    <div>Roll: {faceData.headRotation.roll.toFixed(1)}Â°</div>\n                    <div className=\"mt-2 font-bold\">\n                        Total: {(Math.abs(faceData.headRotation.pitch) + Math.abs(faceData.headRotation.yaw) + Math.abs(faceData.headRotation.roll)).toFixed(1)}Â°\n                    </div>\n                </div>\n            )}\n\n            <div className=\"mb-8\">\n                <canvas\n                    ref={canvasRef}\n                    width={600}\n                    height={100}\n                    className=\"rounded-lg border-2 border-white/20\"\n                />\n            </div>\n\n            {transcription && (\n                <div className=\"bg-white/10 backdrop-blur-lg border-2 border-white/30 rounded-2xl px-8 py-4 max-w-2xl animate-in fade-in slide-in-from-bottom-4\">\n                    <p className=\"text-white text-2xl font-bold text-center\">\n                        \"{transcription.text}\"\n                    </p>\n                    <p className=\"text-white/60 text-sm text-center mt-2\">\n                        Confidence: {(transcription.confidence * 100).toFixed(0)}%\n                    </p>\n                </div>\n            )}\n\n            {autoScanStarted && !detectedInput && (\n                <div className=\"absolute bottom-16 text-white text-2xl font-black\">\n                    Auto-Scan Mode Active\n                </div>\n            )}\n\n            {!transcription && !detectedInput && (\n                <div className=\"text-white/60 text-lg font-medium text-center max-w-xl\">\n                    {autoScanStarted\n                        ? 'Press any key when you hear \"Setup\"'\n                        : 'Listening for voice, motion, keyboard, or any input...'}\n                </div>\n            )}\n\n            {/* Debug Status Panel */}\n            <div className=\"absolute top-6 right-6 bg-black/80 text-white border border-white/20 rounded-lg p-4 text-xs font-mono w-72\">\n                <div className=\"font-bold mb-2\">System Status</div>\n                <div>Mic: {status.audioReady ? 'READY' : 'NO'}</div>\n                <div>Camera: {status.videoReady ? 'READY' : 'NO'}</div>\n                <div>Speech API: {status.speechAvailable ? 'YES' : 'NO'}</div>\n                <div>Speech Active: {status.speechActive ? 'YES' : 'NO'}</div>\n                <div>Speech Error: {status.speechError ?? 'none'}</div>\n                <div>MediaPipe: {status.mediaPipeReady ? 'READY' : 'NO'}</div>\n                <div>Face Detected: {status.faceDetected ? 'YES' : 'NO'}</div>\n                <div>Detection Lock: {status.detectionLocked ? 'LOCKED' : 'OPEN'}</div>\n                <div>Audio Level: {Math.round(status.audioLevel)}</div>\n                <div>Last Transcript: {status.lastTranscript || 'â€”'}</div>\n                <div>Speech Event: {status.lastSpeechEvent}</div>\n            </div>\n\n            <div className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n                {detectedInput\n                    ? `${detectedInput.type} input detected`\n                    : autoScanStarted\n                        ? 'Auto-scan mode active. Press any key when you hear Setup.'\n                        : 'Waiting for input. Make any sound or movement to begin.'}\n                {transcription && ` Heard: ${transcription.text}`}\n            </div>\n        </div>\n    )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAJA;;;;AAMO,SAAS,aAAa,EAAE,eAAe,EAAkD;;IAC5F,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,uOAAQ,EAAC;IAC/C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,uOAAQ,EAAC;IACrD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,uOAAQ,EAAC;IACvD,MAAM,EAAE,aAAa,EAAE,aAAa,EAAE,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAA,sNAAiB,EAAC,MAAM;QACrG,sBAAsB;QACtB,wBAAwB;QACxB,4BAA4B;IAChC;IACA,MAAM,kBAAkB,IAAA,qOAAM,EAAwB;IACtD,MAAM,YAAY,IAAA,qOAAM,EAA2B;IAEnD,iCAAiC;IACjC,IAAA,wOAAS;kCAAC;YACN,IAAI,aAAa;YAEjB,MAAM;gDAAQ;oBACV,OAAO,eAAe,CAAC,MAAM;oBAC7B,MAAM,YAAY,IAAI,yBAClB;oBAEJ,UAAU,IAAI,GAAG;oBACjB,UAAU,KAAK,GAAG;oBAClB,OAAO,eAAe,CAAC,KAAK,CAAC;oBAC7B,eAAe;gBACnB;;YAEA,MAAM,QAAQ,WAAW,OAAO;YAChC;0CAAO,IAAM,aAAa;;QAC9B;iCAAG;QAAC;KAAY;IAEhB,sBAAsB;IACtB,IAAA,wOAAS;kCAAC;YACN,IAAI,eAAe;YAEnB,MAAM,WAAW;mDAAY;oBACzB;2DAAkB,CAAA,OAAQ,OAAO;;gBACrC;kDAAG;YAEH;0CAAO,IAAM,cAAc;;QAC/B;iCAAG;QAAC;KAAc;IAElB,mCAAmC;IACnC,IAAA,wOAAS;kCAAC;YACN,IAAI,iBAAiB,mBAAmB,mBAAmB,GAAG;YAE9D,IAAI,iBAAiB,OAAO,GAAG;gBAC3B,OAAO,eAAe,CAAC,MAAM;gBAC7B,MAAM,YAAY,IAAI,yBAClB;gBAEJ,UAAU,IAAI,GAAG;gBACjB,OAAO,eAAe,CAAC,KAAK,CAAC;YACjC;QACJ;iCAAG;QAAC;QAAgB;QAAe;KAAgB;IAEnD,yCAAyC;IACzC,IAAA,wOAAS;kCAAC;YACN,IAAI,kBAAkB,MAAM,CAAC,iBAAiB,CAAC,iBAAiB;gBAC5D,mBAAmB;gBAEnB,OAAO,eAAe,CAAC,MAAM;gBAC7B,MAAM,YAAY,IAAI,yBAClB;gBAEJ,UAAU,IAAI,GAAG;gBACjB,OAAO,eAAe,CAAC,KAAK,CAAC;gBAE7B,UAAU,KAAK;8CAAG;wBACd,IAAI,YAAY;wBAChB,MAAM,UAAU;4BAAC;4BAAS;yBAAO;wBAEjC,gBAAgB,OAAO,GAAG;sDAAY;gCAClC,MAAM,gBAAgB,IAAI,yBAAyB,OAAO,CAAC,UAAU;gCACrE,cAAc,IAAI,GAAG;gCACrB,OAAO,eAAe,CAAC,KAAK,CAAC;gCAE7B,YAAY,CAAC,YAAY,CAAC,IAAI,QAAQ,MAAM;4BAChD;qDAAG;oBACP;;YACJ;QACJ;iCAAG;QAAC;QAAgB;QAAe;KAAgB;IAEnD,4CAA4C;IAC5C,IAAA,wOAAS;kCAAC;YACN,IAAI,iBAAiB,gBAAgB,OAAO,EAAE;gBAC1C,cAAc,gBAAgB,OAAO;gBACrC,gBAAgB,OAAO,GAAG;gBAC1B,OAAO,eAAe,CAAC,MAAM;YACjC;QACJ;iCAAG;QAAC;KAAc;IAElB,yFAAyF;IACzF,IAAA,wOAAS;kCAAC;YACN,QAAQ,GAAG,CAAC,0CAA0C;YACtD,IAAI,eAAe;gBACf,QAAQ,GAAG,CAAC,yCAAyC,cAAc,IAAI,EAAE,eAAe,cAAc,UAAU;gBAChH,gBAAgB,cAAc,IAAI;YACtC;QACJ;iCAAG;QAAC;QAAe;KAAgB;IAEnC,+BAA+B;IAC/B,IAAA,wOAAS;kCAAC;YACN;0CAAO;oBACH,OAAO,eAAe,CAAC,MAAM;oBAC7B,IAAI,gBAAgB,OAAO,EAAE;wBACzB,cAAc,gBAAgB,OAAO;oBACzC;gBACJ;;QACJ;iCAAG,EAAE;IAEL,4DAA4D;IAC5D,IAAA,wOAAS;kCAAC;YACN,IAAI,CAAC,UAAU,OAAO,EAAE;YAExB,MAAM,SAAS,UAAU,OAAO;YAChC,MAAM,MAAM,OAAO,UAAU,CAAC;YAC9B,IAAI,CAAC,KAAK;YAEV,MAAM;+CAAO;oBACT,mBAAmB;oBACnB,IAAI,SAAS,GAAG;oBAChB,IAAI,QAAQ,CAAC,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;oBAE9C,MAAM,WAAW;oBACjB,MAAM,WAAW,OAAO,KAAK,GAAG;oBAChC,MAAM,kBAAkB,KAAK,GAAG,CAAC,aAAa,KAAK;oBAEnD,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,IAAK;wBAC/B,MAAM,QAAQ,AAAC,IAAI,WAAY,KAAK,EAAE,GAAG;wBACzC,MAAM,YAAY,KAAK,GAAG,CAAC,QAAQ,KAAK,GAAG,KAAK,OAAO,MAAM;wBAC7D,MAAM,SAAS,YAAY,kBAAkB,OAAO,MAAM,GAAG;wBAE7D,yCAAyC;wBACzC,IAAI,SAAS,GAAG;wBAEhB,MAAM,IAAI,IAAI;wBACd,MAAM,IAAI,CAAC,OAAO,MAAM,GAAG,MAAM,IAAI;wBAErC,IAAI,QAAQ,CAAC,GAAG,GAAG,WAAW,GAAG;oBACrC;gBACJ;;YAEA;QACJ;iCAAG;QAAC;KAAW;IAEf,qBACI,2PAAC;QAAI,WAAU;;0BACX,2PAAC;gBAAM,KAAK;gBAAU,WAAU;gBAAS,WAAW;gBAAC,KAAK;;;;;;0BAE1D,2PAAC;gBAAI,WAAU;;kCACX,2PAAC;wBAAI,WAAU;wBACX,OAAO;4BAAE,mBAAmB;wBAAK;;;;;;oBAEpC,+BACG,2PAAC;wBAAI,WAAU;;4BACV,cAAc,IAAI,KAAK,yBAAW,2PAAC,wRAAO;gCAAC,WAAU;;;;;;4BACrD,cAAc,IAAI,KAAK,0BAAY,2PAAC,uRAAQ;gCAAC,WAAU;;;;;;4BACvD,cAAc,IAAI,KAAK,0BAAY,2PAAC,uRAAQ;gCAAC,WAAU;;;;;;4BACvD,cAAc,IAAI,KAAK,yBAAW,2PAAC,wQAAG;gCAAC,WAAU;;;;;;4BACjD,cAAc,IAAI,KAAK,wBAAU,2PAAC,wQAAG;gCAAC,WAAU;;;;;;4BAChD,cAAc,IAAI,KAAK,wBAAU,2PAAC,2QAAI;gCAAC,WAAU;;;;;;4BACjD,cAAc,IAAI,KAAK,wBAAU,2PAAC,2QAAI;gCAAC,WAAU;;;;;;4BACjD,cAAc,IAAI,KAAK,0BAAY,2PAAC,8QAAK;gCAAC,WAAU;;;;;;4BACpD,cAAc,IAAI,KAAK,4BAAc,2PAAC,2QAAI;gCAAC,WAAU;;;;;;;;;;;;;;;;;;YAMjE,UAAU,+BACP,2PAAC;gBAAI,WAAU;0BACX,cAAA,2PAAC;oBACG,WAAU;oBACV,OAAO;wBACH,WAAW,CAAC,sBAAsB,EAAE,SAAS,aAAa,CAAC,CAAC,GAAG,IAAI,iBAAiB,EAAE,SAAS,aAAa,CAAC,CAAC,GAAG,IAAI,IAAI,CAAC;oBAC9H;;;;;;;;;;;YAMX,UAAU,8BACP,2PAAC;gBAAI,WAAU;;kCACX,2PAAC;;4BAAI;4BAAQ,SAAS,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC;4BAAG;;;;;;;kCACpD,2PAAC;;4BAAI;4BAAM,SAAS,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC;4BAAG;;;;;;;kCAChD,2PAAC;;4BAAI;4BAAO,SAAS,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC;4BAAG;;;;;;;kCAClD,2PAAC;wBAAI,WAAU;;4BAAiB;4BACpB,CAAC,KAAK,GAAG,CAAC,SAAS,YAAY,CAAC,KAAK,IAAI,KAAK,GAAG,CAAC,SAAS,YAAY,CAAC,GAAG,IAAI,KAAK,GAAG,CAAC,SAAS,YAAY,CAAC,IAAI,CAAC,EAAE,OAAO,CAAC;4BAAG;;;;;;;;;;;;;0BAKpJ,2PAAC;gBAAI,WAAU;0BACX,cAAA,2PAAC;oBACG,KAAK;oBACL,OAAO;oBACP,QAAQ;oBACR,WAAU;;;;;;;;;;;YAIjB,+BACG,2PAAC;gBAAI,WAAU;;kCACX,2PAAC;wBAAE,WAAU;;4BAA4C;4BACnD,cAAc,IAAI;4BAAC;;;;;;;kCAEzB,2PAAC;wBAAE,WAAU;;4BAAyC;4BACrC,CAAC,cAAc,UAAU,GAAG,GAAG,EAAE,OAAO,CAAC;4BAAG;;;;;;;;;;;;;YAKpE,mBAAmB,CAAC,+BACjB,2PAAC;gBAAI,WAAU;0BAAoD;;;;;;YAKtE,CAAC,iBAAiB,CAAC,+BAChB,2PAAC;gBAAI,WAAU;0BACV,kBACK,wCACA;;;;;;0BAKd,2PAAC;gBAAI,WAAU;;kCACX,2PAAC;wBAAI,WAAU;kCAAiB;;;;;;kCAChC,2PAAC;;4BAAI;4BAAM,OAAO,UAAU,GAAG,UAAU;;;;;;;kCACzC,2PAAC;;4BAAI;4BAAS,OAAO,UAAU,GAAG,UAAU;;;;;;;kCAC5C,2PAAC;;4BAAI;4BAAa,OAAO,eAAe,GAAG,QAAQ;;;;;;;kCACnD,2PAAC;;4BAAI;4BAAgB,OAAO,YAAY,GAAG,QAAQ;;;;;;;kCACnD,2PAAC;;4BAAI;4BAAe,OAAO,WAAW,IAAI;;;;;;;kCAC1C,2PAAC;;4BAAI;4BAAY,OAAO,cAAc,GAAG,UAAU;;;;;;;kCACnD,2PAAC;;4BAAI;4BAAgB,OAAO,YAAY,GAAG,QAAQ;;;;;;;kCACnD,2PAAC;;4BAAI;4BAAiB,OAAO,eAAe,GAAG,WAAW;;;;;;;kCAC1D,2PAAC;;4BAAI;4BAAc,KAAK,KAAK,CAAC,OAAO,UAAU;;;;;;;kCAC/C,2PAAC;;4BAAI;4BAAkB,OAAO,cAAc,IAAI;;;;;;;kCAChD,2PAAC;;4BAAI;4BAAe,OAAO,eAAe;;;;;;;;;;;;;0BAG9C,2PAAC;gBAAI,WAAU;gBAAU,MAAK;gBAAS,aAAU;;oBAC5C,gBACK,GAAG,cAAc,IAAI,CAAC,eAAe,CAAC,GACtC,kBACI,8DACA;oBACT,iBAAiB,CAAC,QAAQ,EAAE,cAAc,IAAI,EAAE;;;;;;;;;;;;;AAIjE;GA7PgB;;QAIqE,sNAAiB;;;KAJtF"}},
    {"offset": {"line": 1912, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/components/onboarding/lock-on-screen.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState, useEffect } from 'react'\nimport { type InputType, usePassiveSensing } from '@/lib/use-passive-sensing'\nimport { Button } from '@/components/ui/button'\n\ninterface LockOnScreenProps {\n    detectedInput: InputType\n    onConfirmed: () => void\n    onTimeout?: () => void\n}\n\nexport function LockOnScreen({ detectedInput, onConfirmed, onTimeout }: LockOnScreenProps) {\n    const [confirmed, setConfirmed] = useState(false)\n    const [listenForConfirm, setListenForConfirm] = useState(false)\n    const [sensingEnabled, setSensingEnabled] = useState(false)\n    const [confirmCount, setConfirmCount] = useState(0)\n    const [timeoutCounter, setTimeoutCounter] = useState(0)\n    const requiredConfirmations = 3\n    \n    // Re-enable passive sensing for confirmation ONLY after initial delay\n    const { detectedInput: confirmInput, videoRef, status } = usePassiveSensing(\n        sensingEnabled && !confirmed,\n        {\n            disableGaze: detectedInput === 'head',\n            disableVoiceVolume: true,  // Always disable voice volume - we only need the specific input type\n            suppressVoiceWhileSpeaking: true,\n            allowedInputTypes: [detectedInput]  // Only allow the specific detected input\n        }\n    )\n\n    const messages: Record<InputType, { initial: string; confirm: string; detected: string }> = {\n        voice: {\n            initial: 'I heard a voice. Speak 3 times to confirm.',\n            confirm: 'Speak now.',\n            detected: 'Voice confirmed!'\n        },\n        motion: {\n            initial: 'I see movement. Move 3 times to confirm.',\n            confirm: 'Move your mouse again.',\n            detected: 'Motion confirmed!'\n        },\n        switch: {\n            initial: 'Switch detected. Press 3 times to confirm.',\n            confirm: 'Press your switch.',\n            detected: 'Switch confirmed!'\n        },\n        blink: {\n            initial: 'I saw a blink. Blink 3 times to confirm.',\n            confirm: 'Blink deliberately.',\n            detected: 'Blink confirmed!'\n        },\n        gaze: {\n            initial: 'Eye gaze detected. Look away and back 3 times.',\n            confirm: 'Look away and back.',\n            detected: 'Eye gaze confirmed!'\n        },\n        head: {\n            initial: 'Head movement detected. Nod 3 times to confirm.',\n            confirm: 'Nod your head.',\n            detected: 'Head motion confirmed!'\n        },\n        sign: {\n            initial: 'Sign language detected. Repeat 3 times to confirm.',\n            confirm: 'Repeat your gesture.',\n            detected: 'Sign language confirmed!'\n        },\n        facial: {\n            initial: 'Facial expression detected. Make it 3 times to confirm.',\n            confirm: 'Make the expression.',\n            detected: 'Facial expression confirmed!'\n        },\n        'sip-puff': {\n            initial: 'Sip or puff detected. Do it 3 times to confirm.',\n            confirm: 'Sip or puff.',\n            detected: 'Sip-puff confirmed!'\n        },\n        none: {\n            initial: 'Waiting for input...',\n            confirm: 'Please try again.',\n            detected: 'Input confirmed!'\n        }\n    }\n\n    const message = messages[detectedInput] || messages.none\n\n    // Auto-play audio (ONCE)\n    useEffect(() => {\n        window.speechSynthesis.cancel()\n        const utterance = new SpeechSynthesisUtterance(message.initial)\n        utterance.rate = 0.9\n        \n        // Wait for TTS to finish, then enable listening\n        utterance.onend = () => {\n            console.log('ðŸŽ¯ TTS finished, enabling listening')\n            setTimeout(() => {\n                window.speechSynthesis.cancel() // Ensure fully cancelled\n                setListenForConfirm(true)\n                setSensingEnabled(true)\n                console.log('ðŸŽ¯ Lock-on: Ready for confirmation input')\n            }, 200)\n        }\n        \n        window.speechSynthesis.speak(utterance)\n    }, []) // Empty deps - only run once\n\n    // Timeout counter\n    useEffect(() => {\n        if (confirmed || !listenForConfirm) return\n\n        const interval = setInterval(() => {\n            setTimeoutCounter(prev => {\n                if (prev + 1 >= 30) {\n                    console.log('â° Confirmation timeout')\n                    if (onTimeout) onTimeout()\n                    return prev\n                }\n                return prev + 1\n            })\n        }, 1000)\n\n        return () => clearInterval(interval)\n    }, [confirmed, listenForConfirm, onTimeout])\n\n    // Listen for confirmation via passive sensing\n    useEffect(() => {\n        if (!listenForConfirm || confirmed || !confirmInput) return\n        \n        // Check if the same input type was detected again\n        if (confirmInput.type === detectedInput) {\n            const newCount = confirmCount + 1\n            console.log(`âœ“ Confirmation ${newCount}/${requiredConfirmations}:`, confirmInput.type)\n            setConfirmCount(newCount)\n            \n            // Visual/audio feedback\n            const beep = new SpeechSynthesisUtterance(`${newCount}`)\n            beep.rate = 1.2\n            beep.volume = 0.8\n            window.speechSynthesis.speak(beep)\n            \n            if (newCount >= requiredConfirmations) {\n                confirmInputAction()\n            } else {\n                // Reset sensing to allow next detection\n                setSensingEnabled(false)\n                setTimeout(() => setSensingEnabled(true), 500)\n            }\n        }\n    }, [confirmInput, listenForConfirm, confirmed, detectedInput, confirmCount])\n\n    // Listen for confirmation input (fallback for non-passive inputs)\n    useEffect(() => {\n        if (!listenForConfirm || confirmed) return\n\n        let clickCount = 0\n        let clickTimer: NodeJS.Timeout\n\n        const handleConfirm = (e: KeyboardEvent) => {\n            if (detectedInput === 'switch' && (e.key === ' ' || e.key === 'Enter')) {\n                const newCount = confirmCount + 1\n                setConfirmCount(newCount)\n                console.log(`âœ“ Switch confirmation ${newCount}/${requiredConfirmations}`)\n                \n                if (newCount >= requiredConfirmations) {\n                    confirmInputAction()\n                }\n            }\n        }\n\n        const handleClick = () => {\n            if (detectedInput === 'motion') {\n                clickCount++\n                console.log(`ðŸ–±ï¸ Motion confirmation ${clickCount}/${requiredConfirmations}`)\n                setConfirmCount(clickCount)\n                \n                if (clickCount >= requiredConfirmations) {\n                    confirmInputAction()\n                }\n                \n                clearTimeout(clickTimer)\n                clickTimer = setTimeout(() => { clickCount = 0 }, 2000)\n            }\n        }\n\n        window.addEventListener('keydown', handleConfirm)\n        window.addEventListener('click', handleClick)\n\n        return () => {\n            window.removeEventListener('keydown', handleConfirm)\n            window.removeEventListener('click', handleClick)\n            clearTimeout(clickTimer)\n        }\n    }, [listenForConfirm, confirmed, detectedInput, confirmCount])\n\n    const confirmInputAction = () => {\n        if (confirmed) return\n        setConfirmed(true)\n\n        window.speechSynthesis.cancel()\n        const utterance = new SpeechSynthesisUtterance(message.detected)\n        utterance.rate = 1.0\n        window.speechSynthesis.speak(utterance)\n\n        setTimeout(() => {\n            onConfirmed()\n        }, 1500)\n    }\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            window.speechSynthesis.cancel()\n        }\n    }, [])\n\n    return (\n        <div className=\"fixed inset-0 bg-black text-white flex flex-col items-center justify-center p-8\">\n            {/* Hidden video element for face detection */}\n            <video ref={videoRef} className=\"hidden\" playsInline muted />\n            \n            <div className=\"max-w-2xl text-center space-y-8\">\n                <div className={`text-6xl font-black transition-all duration-500 ${confirmed ? 'scale-125 text-green-400' : ''}`}>\n                    {confirmed ? 'âœ“' : '?'}\n                </div>\n\n                <h1 className=\"text-3xl font-black\">\n                    {confirmed ? message.detected : message.initial}\n                </h1>\n\n                {!confirmed && (\n                    <>\n                        <p className=\"text-xl text-gray-400\">\n                            {message.confirm}\n                        </p>\n                        \n                        {/* Progress indicator */}\n                        <div className=\"flex justify-center gap-4 mt-8\">\n                            {[...Array(requiredConfirmations)].map((_, i) => (\n                                <div\n                                    key={i}\n                                    className={`w-16 h-16 rounded-full border-4 border-white flex items-center justify-center text-2xl font-black transition-all ${\n                                        i < confirmCount ? 'bg-green-500 scale-110' : 'bg-white/20'\n                                    }`}\n                                >\n                                    {i < confirmCount ? 'âœ“' : i + 1}\n                                </div>\n                            ))}\n                        </div>\n                        \n                        {/* Timeout indicator */}\n                        <p className=\"text-sm text-gray-500 mt-4\">\n                            Time remaining: {30 - timeoutCounter}s\n                        </p>\n                    </>\n                )}\n\n                {/* Manual confirm button (accessible fallback) */}\n                {!confirmed && listenForConfirm && (\n                    <Button\n                        onClick={() => {\n                            const newCount = confirmCount + 1\n                            setConfirmCount(newCount)\n                            if (newCount >= requiredConfirmations) {\n                                confirmInputAction()\n                            }\n                        }}\n                        className=\"mt-8 text-xl px-8 py-6 font-bold border-4 border-white bg-green-600 hover:bg-green-700 text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)]\"\n                    >\n                        Count ({confirmCount}/{requiredConfirmations})\n                    </Button>\n                )}\n            </div>\n\n            <div className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n                {confirmed ? message.detected : message.initial}\n            </div>\n\n            {/* Debug Status Panel */}\n            <div className=\"absolute top-6 right-6 bg-black/80 text-white border border-white/20 rounded-lg p-4 text-xs font-mono w-80\">\n                <div className=\"font-bold mb-2\">System Status</div>\n                <div>Mic: {status.audioReady ? 'READY' : 'NO'}</div>\n                <div>Camera: {status.videoReady ? 'READY' : 'NO'}</div>\n                <div className=\"mt-2 font-bold\">Web Speech API</div>\n                <div>Available: {status.speechAvailable ? 'YES' : 'NO'}</div>\n                <div>Active: {status.speechActive ? 'YES' : 'NO'}</div>\n                <div>Error: {status.speechError ?? 'none'}</div>\n                <div className=\"mt-2 font-bold\">Local Speech (Whisper)</div>\n                <div className={status.localSpeechAvailable ? 'text-green-400' : 'text-red-400'}>\n                    Service: {status.localSpeechAvailable ? 'READY âœ“' : 'NOT RUNNING âœ—'}\n                </div>\n                <div>Recording: {status.localSpeechRecording ? 'YES' : 'NO'}</div>\n                {status.localSpeechError && (\n                    <div className=\"text-yellow-400 text-xs mt-1\">\n                        {status.localSpeechError}\n                    </div>\n                )}\n                <div className=\"mt-2 font-bold\">Detection</div>\n                <div>MediaPipe: {status.mediaPipeReady ? 'READY' : 'NO'}</div>\n                <div>Face: {status.faceDetected ? 'YES' : 'NO'}</div>\n                <div>Lock: {status.detectionLocked ? 'LOCKED' : 'OPEN'}</div>\n                <div>Audio Level: {Math.round(status.audioLevel)}</div>\n                <div className=\"mt-2 font-bold\">Transcript</div>\n                <div className=\"text-white break-words\">{status.lastTranscript || 'â€”'}</div>\n            </div>\n        </div>\n    )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2459, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/components/onboarding/input-explorer.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { useState, useEffect } from 'react'\r\nimport { type InputType, usePassiveSensing } from '@/lib/use-passive-sensing'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Volume2, Eye, Hand, Keyboard, Activity, Wind, Smile, Move, Zap } from 'lucide-react'\r\n\r\ninterface InputExplorerProps {\r\n    primaryInput: InputType\r\n    detectedInputs: InputType[]\r\n    onComplete: (allInputs: InputType[]) => void\r\n}\r\n\r\nexport function InputExplorer({ primaryInput, detectedInputs: initialInputs, onComplete }: InputExplorerProps) {\r\n    const [detectedInputs, setDetectedInputs] = useState<InputType[]>(initialInputs)\r\n    const [testedInputs, setTestedInputs] = useState<InputType[]>(initialInputs)\r\n    const [currentlyTesting, setCurrentlyTesting] = useState<InputType | null>(null)\r\n    const [skipCount, setSkipCount] = useState(0)\r\n    const [confirmCount, setConfirmCount] = useState(0)\r\n    const [sensingEnabled, setSensingEnabled] = useState(true)\r\n    const [timeoutCounter, setTimeoutCounter] = useState(0)\r\n    const [voiceChallenge, setVoiceChallenge] = useState<{ category: 'color' | 'shape' | 'fruit'; word: string } | null>(null)\r\n    const [voiceChallengeStart, setVoiceChallengeStart] = useState<number>(0)\r\n    const [voiceChallengeExpires, setVoiceChallengeExpires] = useState<number>(0)\r\n    const [voiceSessionStart, setVoiceSessionStart] = useState<number>(0)\r\n    const requiredConfirmations = 3\r\n\r\n    const { detectedInput, transcription, videoRef, status, requestSpeechStart } = usePassiveSensing(\r\n        sensingEnabled && !!currentlyTesting,\r\n        {\r\n            disableVoiceVolume: currentlyTesting !== 'voice',  // Only enable for voice testing\r\n            disableGaze: currentlyTesting === 'head',\r\n            disableVoiceVolume: primaryInput === 'voice'\r\n            ,allowedInputTypes: currentlyTesting === 'head' ? ['head'] : undefined\r\n        }\r\n    )\r\n\r\n    // All possible inputs to test\r\n    const allInputTypes: InputType[] = ['voice', 'head', 'blink', 'gaze', 'switch', 'motion', 'sign', 'facial', 'sip-puff']\r\n    \r\n    // Inputs we haven't tested yet\r\n    const untested = allInputTypes.filter(input => !testedInputs.includes(input))\r\n\r\n    const inputIcons: Record<InputType, React.ReactNode> = {\r\n        voice: <Volume2 className=\"h-12 w-12\" />,\r\n        motion: <Activity className=\"h-12 w-12\" />,\r\n        switch: <Keyboard className=\"h-12 w-12\" />,\r\n        blink: <Eye className=\"h-12 w-12\" />,\r\n        gaze: <Eye className=\"h-12 w-12\" />,\r\n        head: <Move className=\"h-12 w-12\" />,\r\n        sign: <Hand className=\"h-12 w-12\" />,\r\n        facial: <Smile className=\"h-12 w-12\" />,\r\n        'sip-puff': <Wind className=\"h-12 w-12\" />,\r\n        none: <Zap className=\"h-12 w-12\" />\r\n    }\r\n\r\n    const inputPrompts: Record<InputType, string> = {\r\n        voice: 'Voice check: say the word shown on screen. Get 3 correct in a row.',\r\n        head: 'Can you move your head? Nod 3 times.',\r\n        blink: 'Can you blink deliberately? Blink 3 times.',\r\n        gaze: 'Can you move your eyes? Look away and back 3 times.',\r\n        switch: 'Can you use a keyboard or switch? Press any key 3 times.',\r\n        motion: 'Can you use a mouse or touch? Click anywhere 3 times.',\r\n        sign: 'Can you make hand gestures? Make a gesture 3 times.',\r\n        facial: 'Can you make facial expressions? Smile or frown 3 times.',\r\n        'sip-puff': 'Can you use sip-puff controls? Use them 3 times.',\r\n        none: ''\r\n    }\r\n\r\n    const skipPrompt = primaryInput === 'voice' \r\n        ? 'Say \"skip\" 3 times to skip'\r\n        : primaryInput === 'head'\r\n        ? 'Nod 3 times to skip'\r\n        : primaryInput === 'blink'\r\n        ? 'Blink 3 times to skip'\r\n        : primaryInput === 'switch'\r\n        ? 'Press any key 3 times to skip'\r\n        : 'Use your primary input 3 times to skip'\r\n\r\n    // Auto-start testing next input\r\n    useEffect(() => {\r\n        if (!currentlyTesting && untested.length > 0) {\r\n            const nextInput = untested[0]\r\n            setCurrentlyTesting(nextInput)\r\n            setConfirmCount(0)\r\n            setSkipCount(0)\r\n            setTimeoutCounter(0)\r\n            setSensingEnabled(false)\r\n            setTimeout(() => setSensingEnabled(true), 50)\r\n            setVoiceChallenge(null)\r\n            setVoiceChallengeStart(0)\r\n            setVoiceChallengeExpires(0)\r\n            setVoiceSessionStart(Date.now())\r\n\r\n            window.speechSynthesis.cancel()\r\n            const utterance = new SpeechSynthesisUtterance(\r\n                `Let's try ${nextInput}. ${inputPrompts[nextInput]} Or ${skipPrompt}.`\r\n            )\r\n            utterance.rate = 0.9\r\n            window.speechSynthesis.speak(utterance)\r\n        } else if (untested.length === 0 && currentlyTesting === null) {\r\n            // All done!\r\n            onComplete(detectedInputs)\r\n        }\r\n    }, [currentlyTesting, untested.length, detectedInputs, onComplete])\r\n\r\n    // Watchdog: if we ever get stuck on the \"Analyzing inputs...\" screen, advance.\r\n    useEffect(() => {\r\n        if (currentlyTesting !== null) return\r\n        const timer = setTimeout(() => {\r\n            if (untested.length > 0) {\r\n                setCurrentlyTesting(untested[0])\r\n            } else {\r\n                onComplete(detectedInputs)\r\n            }\r\n        }, 1500)\r\n        return () => clearTimeout(timer)\r\n    }, [currentlyTesting, untested.length, onComplete, detectedInputs])\r\n\r\n    // Timeout counter\r\n    useEffect(() => {\r\n        if (!currentlyTesting) return\r\n\r\n        const interval = setInterval(() => {\r\n            setTimeoutCounter(prev => {\r\n                if (prev + 1 >= 30) {\r\n                    console.log('â° Timeout - skipping', currentlyTesting)\r\n                    handleSkip()\r\n                    return 0\r\n                }\r\n                return prev + 1\r\n            })\r\n        }, 1000)\r\n\r\n        return () => clearInterval(interval)\r\n    }, [currentlyTesting])\r\n\r\n    const pickVoiceChallenge = () => {\r\n        const categories: Array<{ category: 'color' | 'shape' | 'fruit'; words: string[] }> = [\r\n            { category: 'color', words: ['red', 'blue', 'green', 'yellow', 'orange', 'purple'] },\r\n            { category: 'shape', words: ['circle', 'square', 'triangle', 'star', 'heart'] },\r\n            { category: 'fruit', words: ['apple', 'banana', 'orange', 'grape', 'pear'] }\r\n        ]\r\n        const cat = categories[Math.floor(Math.random() * categories.length)]\r\n        const word = cat.words[Math.floor(Math.random() * cat.words.length)]\r\n        setVoiceChallenge({ category: cat.category, word })\r\n        const now = Date.now()\r\n        setVoiceChallengeStart(now)\r\n        setVoiceChallengeExpires(now + 10000)\r\n    }\r\n\r\n    // Voice challenge lifecycle\r\n    useEffect(() => {\r\n        if (currentlyTesting !== 'voice') return\r\n\r\n        if (!voiceChallenge) {\r\n            pickVoiceChallenge()\r\n            return\r\n        }\r\n\r\n        const timer = setInterval(() => {\r\n            const now = Date.now()\r\n            if (now >= voiceChallengeExpires) {\r\n                pickVoiceChallenge()\r\n            }\r\n        }, 500)\r\n\r\n        return () => clearInterval(timer)\r\n    }, [currentlyTesting, voiceChallenge, voiceChallengeExpires])\r\n\r\n    // Listen for new input detection\r\n    useEffect(() => {\r\n        if (!detectedInput || !currentlyTesting) return\r\n        if (currentlyTesting === 'voice') return\r\n\r\n        // Testing for this specific input\r\n        if (detectedInput.type === currentlyTesting) {\r\n            const newCount = confirmCount + 1\r\n            console.log(`âœ“ ${currentlyTesting} confirmation ${newCount}/${requiredConfirmations}`)\r\n            setConfirmCount(newCount)\r\n\r\n            const beep = new SpeechSynthesisUtterance(`${newCount}`)\r\n            beep.rate = 1.2\r\n            window.speechSynthesis.speak(beep)\r\n\r\n            if (newCount >= requiredConfirmations) {\r\n                handleConfirm(currentlyTesting)\r\n            } else {\r\n                // Reset sensing\r\n                setSensingEnabled(false)\r\n                setTimeout(() => setSensingEnabled(true), 500)\r\n            }\r\n        }\r\n        // Skip via primary input\r\n        else if (detectedInput.type === primaryInput && primaryInput !== 'voice') {\r\n            const newCount = skipCount + 1\r\n            console.log(`â­ï¸ Skip count ${newCount}/${requiredConfirmations}`)\r\n            setSkipCount(newCount)\r\n\r\n            const beep = new SpeechSynthesisUtterance(`skip ${newCount}`)\r\n            beep.rate = 1.2\r\n            window.speechSynthesis.speak(beep)\r\n\r\n            if (newCount >= requiredConfirmations) {\r\n                handleSkip()\r\n            } else {\r\n                // Reset sensing\r\n                setSensingEnabled(false)\r\n                setTimeout(() => setSensingEnabled(true), 500)\r\n            }\r\n        }\r\n    }, [detectedInput, currentlyTesting, confirmCount, skipCount, primaryInput])\r\n\r\n    // Voice skip via transcription (all tests)\r\n    useEffect(() => {\r\n        if (primaryInput !== 'voice' || !transcription || !currentlyTesting) return\r\n        const text = transcription.text.toLowerCase()\r\n        if (!text.includes('skip')) return\r\n\r\n        const newCount = skipCount + 1\r\n        setSkipCount(newCount)\r\n        const beep = new SpeechSynthesisUtterance(`skip ${newCount}`)\r\n        beep.rate = 1.2\r\n        window.speechSynthesis.speak(beep)\r\n        if (newCount >= requiredConfirmations) {\r\n            handleSkip()\r\n        }\r\n    }, [primaryInput, transcription, currentlyTesting, skipCount])\r\n\r\n    // Voice verification via transcription\r\n    useEffect(() => {\r\n        if (currentlyTesting !== 'voice' || !transcription) return\r\n        const text = transcription.text.toLowerCase()\r\n\r\n        if (voiceChallenge && text.includes(voiceChallenge.word)) {\r\n            const newCount = confirmCount + 1\r\n            setConfirmCount(newCount)\r\n            const beep = new SpeechSynthesisUtterance(`${newCount}`)\r\n            beep.rate = 1.2\r\n            window.speechSynthesis.speak(beep)\r\n\r\n            if (newCount >= requiredConfirmations) {\r\n                handleConfirm('voice')\r\n            } else {\r\n                pickVoiceChallenge()\r\n            }\r\n        }\r\n    }, [currentlyTesting, transcription, voiceChallenge, confirmCount, skipCount, primaryInput])\r\n\r\n    const handleConfirm = (inputType: InputType) => {\r\n        console.log('âœ“ Confirmed:', inputType)\r\n        setDetectedInputs(prev => [...prev, inputType])\r\n        setTestedInputs(prev => (prev.includes(inputType) ? prev : [...prev, inputType]))\r\n        \r\n        window.speechSynthesis.cancel()\r\n        const utterance = new SpeechSynthesisUtterance(`Great! ${inputType} confirmed.`)\r\n        utterance.rate = 1.0\r\n        window.speechSynthesis.speak(utterance)\r\n\r\n        setTimeout(() => {\r\n            setCurrentlyTesting(null)\r\n            setConfirmCount(0)\r\n            setSkipCount(0)\r\n        }, 1500)\r\n    }\r\n\r\n    const handleSkip = () => {\r\n        console.log('â­ï¸ Skipped:', currentlyTesting)\r\n        if (currentlyTesting) {\r\n            setTestedInputs(prev => (prev.includes(currentlyTesting) ? prev : [...prev, currentlyTesting]))\r\n        }\r\n        \r\n        window.speechSynthesis.cancel()\r\n        const utterance = new SpeechSynthesisUtterance('Skipped.')\r\n        utterance.rate = 1.0\r\n        window.speechSynthesis.speak(utterance)\r\n\r\n        setTimeout(() => {\r\n            setCurrentlyTesting(null)\r\n            setConfirmCount(0)\r\n            setSkipCount(0)\r\n        }, 800)\r\n    }\r\n\r\n    // Cleanup\r\n    useEffect(() => {\r\n        return () => {\r\n            window.speechSynthesis.cancel()\r\n        }\r\n    }, [])\r\n\r\n    if (!currentlyTesting) {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-gradient-to-br from-green-500 to-blue-600 flex items-center justify-center\">\r\n                <div className=\"text-white text-center\">\r\n                    <div className=\"text-6xl mb-4 animate-pulse\">âœ“</div>\r\n                    <h2 className=\"text-3xl font-black\">Analyzing inputs...</h2>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black text-white flex flex-col items-center justify-center p-8\">\r\n            <video ref={videoRef} className=\"hidden\" playsInline muted />\r\n\r\n            <div className=\"max-w-3xl text-center space-y-8\">\r\n                {/* Icon */}\r\n                <div className=\"flex justify-center\">\r\n                    <div className=\"w-32 h-32 bg-white/10 rounded-full flex items-center justify-center\">\r\n                        {inputIcons[currentlyTesting]}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Prompt */}\r\n                <h1 className=\"text-3xl font-black\">\r\n                    {inputPrompts[currentlyTesting]}\r\n                </h1>\r\n\r\n                {currentlyTesting === 'voice' && voiceChallenge && (\r\n                    <div className=\"bg-white text-black rounded-2xl px-8 py-6 inline-flex flex-col items-center gap-2 border-4 border-white\">\r\n                        <div className=\"text-sm font-semibold uppercase tracking-wide\">\r\n                            Say the {voiceChallenge.category}\r\n                        </div>\r\n                        <div className=\"text-4xl font-black\">\r\n                            {voiceChallenge.word}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-600\">\r\n                            {Math.max(0, Math.ceil((voiceChallengeExpires - Date.now()) / 1000))}s remaining\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {currentlyTesting === 'voice' && (!status.speechActive || status.speechError) && (\r\n                    <button\r\n                        onClick={() => requestSpeechStart?.()}\r\n                        className=\"mt-4 px-6 py-3 bg-white text-black font-bold rounded-lg border-4 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)]\"\r\n                    >\r\n                        Enable Voice Recognition\r\n                    </button>\r\n                )}\r\n\r\n                {/* Progress indicators */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Confirm progress */}\r\n                    <div>\r\n                        <p className=\"text-sm text-gray-400 mb-2\">Try it:</p>\r\n                        <div className=\"flex justify-center gap-4\">\r\n                            {[...Array(requiredConfirmations)].map((_, i) => (\r\n                                <div\r\n                                    key={i}\r\n                                    className={`w-12 h-12 rounded-full border-4 border-white flex items-center justify-center text-lg font-black transition-all ${\r\n                                        i < confirmCount ? 'bg-green-500 scale-110' : 'bg-white/20'\r\n                                    }`}\r\n                                >\r\n                                    {i < confirmCount ? 'âœ“' : i + 1}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Skip progress */}\r\n                    <div>\r\n                        <p className=\"text-sm text-gray-400 mb-2\">{skipPrompt}</p>\r\n                        <div className=\"flex justify-center gap-4\">\r\n                            {[...Array(requiredConfirmations)].map((_, i) => (\r\n                                <div\r\n                                    key={i}\r\n                                    className={`w-12 h-12 rounded-full border-4 border-gray-500 flex items-center justify-center text-lg font-black transition-all ${\r\n                                        i < skipCount ? 'bg-gray-600 scale-110' : 'bg-white/10'\r\n                                    }`}\r\n                                >\r\n                                    {i < skipCount ? 'â­' : i + 1}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Timeout */}\r\n                <p className=\"text-sm text-gray-500\">\r\n                    Auto-skip in {30 - timeoutCounter}s\r\n                </p>\r\n\r\n                {/* Progress through all inputs */}\r\n                <div className=\"pt-8 border-t border-white/20\">\r\n                    <p className=\"text-sm text-gray-400 mb-4\">\r\n                        Testing {detectedInputs.length + 1} of {allInputTypes.length} inputs\r\n                    </p>\r\n                    <div className=\"flex justify-center gap-2 flex-wrap\">\r\n                        {allInputTypes.map(input => (\r\n                            <div\r\n                                key={input}\r\n                                className={`px-3 py-1 rounded-full text-xs font-bold ${\r\n                                    detectedInputs.includes(input)\r\n                                        ? 'bg-green-500 text-white'\r\n                                        : input === currentlyTesting\r\n                                        ? 'bg-yellow-500 text-black'\r\n                                        : 'bg-white/10 text-gray-400'\r\n                                }`}\r\n                            >\r\n                                {input}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Manual buttons */}\r\n                <div className=\"flex gap-4 justify-center pt-4\">\r\n                    <Button\r\n                        onClick={() => {\r\n                            const newCount = confirmCount + 1\r\n                            setConfirmCount(newCount)\r\n                            if (newCount >= requiredConfirmations) {\r\n                                handleConfirm(currentlyTesting)\r\n                            }\r\n                        }}\r\n                        className=\"text-lg px-6 py-4 font-bold border-4 border-white bg-green-600 hover:bg-green-700\"\r\n                    >\r\n                        Yes ({confirmCount}/{requiredConfirmations})\r\n                    </Button>\r\n                    <Button\r\n                        onClick={() => {\r\n                            const newCount = skipCount + 1\r\n                            setSkipCount(newCount)\r\n                            if (newCount >= requiredConfirmations) {\r\n                                handleSkip()\r\n                            }\r\n                        }}\r\n                        className=\"text-lg px-6 py-4 font-bold border-4 border-white bg-gray-600 hover:bg-gray-700\"\r\n                    >\r\n                        Skip ({skipCount}/{requiredConfirmations})\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Debug Status Panel */}\r\n            <div className=\"absolute top-6 right-6 bg-black/80 text-white border border-white/20 rounded-lg p-4 text-xs font-mono w-72\">\r\n                <div className=\"font-bold mb-2\">System Status</div>\r\n                <div>Mic: {status.audioReady ? 'READY' : 'NO'}</div>\r\n                <div>Camera: {status.videoReady ? 'READY' : 'NO'}</div>\r\n                <div>Speech API: {status.speechAvailable ? 'YES' : 'NO'}</div>\r\n                <div>Speech Active: {status.speechActive ? 'YES' : 'NO'}</div>\r\n                <div>Speech Error: {status.speechError ?? 'none'}</div>\r\n                <div>MediaPipe: {status.mediaPipeReady ? 'READY' : 'NO'}</div>\r\n                <div>Face Detected: {status.faceDetected ? 'YES' : 'NO'}</div>\r\n                <div>Detection Lock: {status.detectionLocked ? 'LOCKED' : 'OPEN'}</div>\r\n                <div>Audio Level: {Math.round(status.audioLevel)}</div>\r\n                <div>Last Transcript: {status.lastTranscript || 'â€”'}</div>\r\n                <div>Speech Event: {status.lastSpeechEvent}</div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3347, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/app/onboarding/page.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { BeaconScreen } from '@/components/onboarding/beacon-screen'\nimport { LockOnScreen } from '@/components/onboarding/lock-on-screen'\nimport { InputExplorer } from '@/components/onboarding/input-explorer'\nimport { type InputType } from '@/lib/use-passive-sensing'\nimport { useFluentContext } from '@/lib/fluent-context'\n\ntype OnboardingStep = 'beacon' | 'lock-on' | 'explore' | 'name' | 'complete'\n\nexport default function OnboardingPage() {\n    const router = useRouter()\n    const { updateSetting } = useFluentContext()\n    const [step, setStep] = useState<OnboardingStep>('beacon')\n    const [detectedInputType, setDetectedInputType] = useState<InputType>('none')\n    const [allDetectedInputs, setAllDetectedInputs] = useState<InputType[]>([])\n    const [profileName, setProfileName] = useState('')\n\n    const handleInputDetected = (type: InputType) => {\n        console.log('ðŸŽ¯ OnboardingPage.handleInputDetected called with type:', type)\n        setDetectedInputType(type)\n        setAllDetectedInputs([type])\n        setStep('lock-on')\n    }\n\n    const handleLockOnConfirmed = () => {\n        console.log('Lock-on confirmed, exploring other inputs')\n        setStep('explore')\n    }\n\n    const handleLockOnTimeout = () => {\n        console.log('Lock-on timeout, returning to beacon')\n        setStep('beacon')\n        setDetectedInputType('none')\n    }\n\n    const handleExplorationComplete = (allInputs: InputType[]) => {\n        console.log('Exploration complete:', allInputs)\n        setAllDetectedInputs(allInputs)\n        setStep('name')\n    }\n\n    const handleProfileNameSubmit = () => {\n        if (!profileName.trim() || allDetectedInputs.length === 0) return\n\n        // Default settings based on inputs\n        updateSetting('dwellTime', 1000)\n        updateSetting('tremorFilter', 0)\n\n        // Create profile object\n        const profile = {\n            name: profileName.trim(),\n            primaryInput: detectedInputType,\n            availableInputs: allDetectedInputs,\n            lastUsed: new Date().toISOString(),\n            calibration: {\n                primaryInput: detectedInputType,\n                availableInputs: allDetectedInputs,\n                precision: 'medium' as const,\n                tremorDetected: false,\n                dwellTime: 1000,\n                rangeOfMotion: 100,\n                preferredSpeed: 'medium' as const\n            }\n        }\n\n        // Save to profiles list\n        const existingProfiles = JSON.parse(localStorage.getItem('fluent-user-profiles') || '[]')\n        existingProfiles.push(profile)\n        localStorage.setItem('fluent-user-profiles', JSON.stringify(existingProfiles))\n\n        // Mark onboarding as complete\n        localStorage.setItem('fluent-onboarding-complete', 'true')\n        localStorage.setItem('fluent-current-profile', profileName.trim())\n        localStorage.setItem('fluent-primary-input', detectedInputType)\n        localStorage.setItem('fluent-available-inputs', JSON.stringify(allDetectedInputs))\n        localStorage.setItem('fluent-calibration', JSON.stringify(profile.calibration))\n\n        setStep('complete')\n\n        // Redirect to dashboard after showing success\n        setTimeout(() => {\n            router.push('/')\n        }, 3000)\n    }\n\n    const handleSkipOnboarding = () => {\n        // Set minimal defaults\n        updateSetting('dwellTime', 1000)\n        updateSetting('tremorFilter', 0)\n\n        // Create default profile\n        const defaultProfile = {\n            name: 'Guest',\n            primaryInput: 'type' as InputType,\n            availableInputs: ['type', 'voice'] as InputType[],\n            lastUsed: new Date().toISOString(),\n            calibration: {\n                primaryInput: 'type' as InputType,\n                availableInputs: ['type', 'voice'] as InputType[],\n                precision: 'medium' as const,\n                tremorDetected: false,\n                dwellTime: 1000,\n                rangeOfMotion: 100,\n                preferredSpeed: 'medium' as const\n            }\n        }\n\n        // Save minimal profile\n        const existingProfiles = JSON.parse(localStorage.getItem('fluent-user-profiles') || '[]')\n        existingProfiles.push(defaultProfile)\n        localStorage.setItem('fluent-user-profiles', JSON.stringify(existingProfiles))\n\n        // Mark onboarding as skipped/complete\n        localStorage.setItem('fluent-onboarding-complete', 'true')\n        localStorage.setItem('fluent-current-profile', 'Guest')\n        localStorage.setItem('fluent-primary-input', 'type')\n        localStorage.setItem('fluent-available-inputs', JSON.stringify(['type', 'voice']))\n        localStorage.setItem('fluent-calibration', JSON.stringify(defaultProfile.calibration))\n\n        // Redirect to dashboard\n        router.push('/')\n    }\n\n    return (\n        <>\n            {/* Skip Button - Always visible except on complete step */}\n            {step !== 'complete' && (\n                <button\n                    onClick={handleSkipOnboarding}\n                    className=\"fixed top-6 left-6 z-50 bg-white hover:bg-gray-100 text-gray-800 font-bold py-2 px-4 rounded-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all\"\n                    aria-label=\"Skip onboarding\"\n                >\n                    Skip Onboarding â†’\n                </button>\n            )}\n\n            {step === 'beacon' && <BeaconScreen onInputDetected={handleInputDetected} />}\n\n            {step === 'lock-on' && (\n                <LockOnScreen\n                    detectedInput={detectedInputType}\n                    onConfirmed={handleLockOnConfirmed}\n                    onTimeout={handleLockOnTimeout}\n                />\n            )}\n\n            {step === 'explore' && (\n                <InputExplorer\n                    primaryInput={detectedInputType}\n                    detectedInputs={allDetectedInputs}\n                    onComplete={handleExplorationComplete}\n                />\n            )}\n\n            {step === 'name' && (\n                <div className=\"fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-8\">\n                    <div className=\"bg-white rounded-2xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] p-8 max-w-md w-full\">\n                        <h2 className=\"text-3xl font-black mb-4 text-center\">What's your name?</h2>\n                        <p className=\"text-gray-600 mb-6 text-center\">This helps us save your settings</p>\n\n                        <input\n                            type=\"text\"\n                            value={profileName}\n                            onChange={(e) => setProfileName(e.target.value)}\n                            onKeyDown={(e) => e.key === 'Enter' && handleProfileNameSubmit()}\n                            placeholder=\"Enter your name\"\n                            className=\"w-full px-4 py-3 border-4 border-black rounded-lg text-lg font-bold mb-4 focus:outline-none focus:ring-4 focus:ring-blue-400\"\n                            autoFocus\n                        />\n\n                        <button\n                            onClick={handleProfileNameSubmit}\n                            disabled={!profileName.trim()}\n                            className=\"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-black py-3 px-6 rounded-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all disabled:cursor-not-allowed\"\n                        >\n                            Continue\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {step === 'complete' && (\n                <div className=\"fixed inset-0 bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center p-8\">\n                    <div className=\"text-center\">\n                        <div className=\"text-9xl mb-8 animate-bounce\">âœ“</div>\n                        <h1 className=\"text-6xl font-black text-white mb-4\">Welcome, {profileName}!</h1>\n                        <p className=\"text-2xl text-white/80 font-bold\">Your profile is ready</p>\n                        <p className=\"text-lg text-white/60 mt-4\">\n                            Primary Input: {detectedInputType}\n                        </p>\n                        {allDetectedInputs.length > 1 && (\n                            <p className=\"text-lg text-white/60\">\n                                Also available: {allDetectedInputs.filter(i => i !== detectedInputType).join(', ')}\n                            </p>\n                        )}\n                    </div>\n                </div>\n            )}\n        </>\n    )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAEA;;;AARA;;;;;;;AAYe,SAAS;;IACpB,MAAM,SAAS,IAAA,gNAAS;IACxB,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,8MAAgB;IAC1C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,uOAAQ,EAAiB;IACjD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,uOAAQ,EAAY;IACtE,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,uOAAQ,EAAc,EAAE;IAC1E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,uOAAQ,EAAC;IAE/C,MAAM,sBAAsB,CAAC;QACzB,QAAQ,GAAG,CAAC,2DAA2D;QACvE,qBAAqB;QACrB,qBAAqB;YAAC;SAAK;QAC3B,QAAQ;IACZ;IAEA,MAAM,wBAAwB;QAC1B,QAAQ,GAAG,CAAC;QACZ,QAAQ;IACZ;IAEA,MAAM,sBAAsB;QACxB,QAAQ,GAAG,CAAC;QACZ,QAAQ;QACR,qBAAqB;IACzB;IAEA,MAAM,4BAA4B,CAAC;QAC/B,QAAQ,GAAG,CAAC,yBAAyB;QACrC,qBAAqB;QACrB,QAAQ;IACZ;IAEA,MAAM,0BAA0B;QAC5B,IAAI,CAAC,YAAY,IAAI,MAAM,kBAAkB,MAAM,KAAK,GAAG;QAE3D,mCAAmC;QACnC,cAAc,aAAa;QAC3B,cAAc,gBAAgB;QAE9B,wBAAwB;QACxB,MAAM,UAAU;YACZ,MAAM,YAAY,IAAI;YACtB,cAAc;YACd,iBAAiB;YACjB,UAAU,IAAI,OAAO,WAAW;YAChC,aAAa;gBACT,cAAc;gBACd,iBAAiB;gBACjB,WAAW;gBACX,gBAAgB;gBAChB,WAAW;gBACX,eAAe;gBACf,gBAAgB;YACpB;QACJ;QAEA,wBAAwB;QACxB,MAAM,mBAAmB,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,2BAA2B;QACpF,iBAAiB,IAAI,CAAC;QACtB,aAAa,OAAO,CAAC,wBAAwB,KAAK,SAAS,CAAC;QAE5D,8BAA8B;QAC9B,aAAa,OAAO,CAAC,8BAA8B;QACnD,aAAa,OAAO,CAAC,0BAA0B,YAAY,IAAI;QAC/D,aAAa,OAAO,CAAC,wBAAwB;QAC7C,aAAa,OAAO,CAAC,2BAA2B,KAAK,SAAS,CAAC;QAC/D,aAAa,OAAO,CAAC,sBAAsB,KAAK,SAAS,CAAC,QAAQ,WAAW;QAE7E,QAAQ;QAER,8CAA8C;QAC9C,WAAW;YACP,OAAO,IAAI,CAAC;QAChB,GAAG;IACP;IAEA,MAAM,uBAAuB;QACzB,uBAAuB;QACvB,cAAc,aAAa;QAC3B,cAAc,gBAAgB;QAE9B,yBAAyB;QACzB,MAAM,iBAAiB;YACnB,MAAM;YACN,cAAc;YACd,iBAAiB;gBAAC;gBAAQ;aAAQ;YAClC,UAAU,IAAI,OAAO,WAAW;YAChC,aAAa;gBACT,cAAc;gBACd,iBAAiB;oBAAC;oBAAQ;iBAAQ;gBAClC,WAAW;gBACX,gBAAgB;gBAChB,WAAW;gBACX,eAAe;gBACf,gBAAgB;YACpB;QACJ;QAEA,uBAAuB;QACvB,MAAM,mBAAmB,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,2BAA2B;QACpF,iBAAiB,IAAI,CAAC;QACtB,aAAa,OAAO,CAAC,wBAAwB,KAAK,SAAS,CAAC;QAE5D,sCAAsC;QACtC,aAAa,OAAO,CAAC,8BAA8B;QACnD,aAAa,OAAO,CAAC,0BAA0B;QAC/C,aAAa,OAAO,CAAC,wBAAwB;QAC7C,aAAa,OAAO,CAAC,2BAA2B,KAAK,SAAS,CAAC;YAAC;YAAQ;SAAQ;QAChF,aAAa,OAAO,CAAC,sBAAsB,KAAK,SAAS,CAAC,eAAe,WAAW;QAEpF,wBAAwB;QACxB,OAAO,IAAI,CAAC;IAChB;IAEA,qBACI;;YAEK,SAAS,4BACN,2PAAC;gBACG,SAAS;gBACT,WAAU;gBACV,cAAW;0BACd;;;;;;YAKJ,SAAS,0BAAY,2PAAC,8NAAY;gBAAC,iBAAiB;;;;;;YAEpD,SAAS,2BACN,2PAAC,kOAAY;gBACT,eAAe;gBACf,aAAa;gBACb,WAAW;;;;;;YAIlB,SAAS,2BACN,2PAAC,gOAAa;gBACV,cAAc;gBACd,gBAAgB;gBAChB,YAAY;;;;;;YAInB,SAAS,wBACN,2PAAC;gBAAI,WAAU;0BACX,cAAA,2PAAC;oBAAI,WAAU;;sCACX,2PAAC;4BAAG,WAAU;sCAAuC;;;;;;sCACrD,2PAAC;4BAAE,WAAU;sCAAiC;;;;;;sCAE9C,2PAAC;4BACG,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;4BAC9C,WAAW,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW;4BACvC,aAAY;4BACZ,WAAU;4BACV,SAAS;;;;;;sCAGb,2PAAC;4BACG,SAAS;4BACT,UAAU,CAAC,YAAY,IAAI;4BAC3B,WAAU;sCACb;;;;;;;;;;;;;;;;;YAOZ,SAAS,4BACN,2PAAC;gBAAI,WAAU;0BACX,cAAA,2PAAC;oBAAI,WAAU;;sCACX,2PAAC;4BAAI,WAAU;sCAA+B;;;;;;sCAC9C,2PAAC;4BAAG,WAAU;;gCAAsC;gCAAU;gCAAY;;;;;;;sCAC1E,2PAAC;4BAAE,WAAU;sCAAmC;;;;;;sCAChD,2PAAC;4BAAE,WAAU;;gCAA6B;gCACtB;;;;;;;wBAEnB,kBAAkB,MAAM,GAAG,mBACxB,2PAAC;4BAAE,WAAU;;gCAAwB;gCAChB,kBAAkB,MAAM,CAAC,CAAA,IAAK,MAAM,mBAAmB,IAAI,CAAC;;;;;;;;;;;;;;;;;;;;AAQ7G;GA/LwB;;QACL,gNAAS;QACE,8MAAgB;;;KAFtB"}}]
}