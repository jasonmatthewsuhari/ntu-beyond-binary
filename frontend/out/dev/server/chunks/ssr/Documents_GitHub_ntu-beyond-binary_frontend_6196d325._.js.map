{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/lib/use-mediapipe-face.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useRef, useState } from 'react'\r\nimport { FaceLandmarker, FilesetResolver } from '@mediapipe/tasks-vision'\r\n\r\nexport interface FaceDetectionResult {\n    blinkDetected: boolean\n    gazeDirection: { x: number; y: number } | null\n    headRotation: { pitch: number; yaw: number; roll: number } | null\n    faceDetected: boolean\n    ready: boolean\n}\n\r\nexport function useMediaPipeFace(videoElement: HTMLVideoElement | null, enabled: boolean) {\n    const [result, setResult] = useState<FaceDetectionResult>({\n        blinkDetected: false,\n        gazeDirection: null,\n        headRotation: null,\n        faceDetected: false,\n        ready: false\n    })\n    const [isReady, setIsReady] = useState(false)\n\r\n    const faceLandmarkerRef = useRef<FaceLandmarker | null>(null)\r\n    const lastBlinkTimeRef = useRef<number>(0)\r\n    const animationFrameRef = useRef<number>(0)\r\n    const frameCountRef = useRef<number>(0)\r\n\r\n    // Initialize MediaPipe\r\n    useEffect(() => {\r\n        if (!enabled) return\r\n\r\n        let isActive = true\r\n\r\n        const initializeFaceLandmarker = async () => {\r\n            try {\r\n                console.log('ðŸ” Initializing MediaPipe FaceLandmarker...')\r\n\r\n                const vision = await FilesetResolver.forVisionTasks(\r\n                    'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'\r\n                )\r\n\r\n                const faceLandmarker = await FaceLandmarker.createFromOptions(vision, {\r\n                    baseOptions: {\r\n                        modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',\r\n                        delegate: 'GPU'\r\n                    },\r\n                    runningMode: 'VIDEO',\r\n                    numFaces: 1,\r\n                    minFaceDetectionConfidence: 0.5,\r\n                    minFacePresenceConfidence: 0.5,\r\n                    minTrackingConfidence: 0.5,\r\n                    outputFaceBlendshapes: true,\r\n                    outputFacialTransformationMatrixes: true\r\n                })\r\n\r\n                if (isActive) {\n                    faceLandmarkerRef.current = faceLandmarker\n                    setIsReady(true)\n                    setResult(prev => ({ ...prev, ready: true }))\n                    console.log('âœ“ MediaPipe FaceLandmarker ready')\n                }\n            } catch (error) {\n                console.error('Failed to initialize FaceLandmarker:', error)\n            }\n        }\n\r\n        initializeFaceLandmarker()\r\n\r\n        return () => {\r\n            isActive = false\r\n            if (animationFrameRef.current) {\n                cancelAnimationFrame(animationFrameRef.current)\n            }\n            setIsReady(false)\n            setResult(prev => ({ ...prev, ready: false, faceDetected: false, blinkDetected: false, gazeDirection: null, headRotation: null }))\n        }\n    }, [enabled])\n\r\n    // Process video frames\r\n    useEffect(() => {\r\n        if (!enabled || !videoElement || !isReady || !faceLandmarkerRef.current) {\n            console.log('ðŸ“¹ MediaPipe frame processing NOT starting:', {\n                enabled,\n                hasVideo: !!videoElement,\n                isReady,\n                hasFaceLandmarker: !!faceLandmarkerRef.current\n            })\n            return\n        }\n\r\n        console.log('ðŸ“¹ MediaPipe frame processing STARTING', {\r\n            videoWidth: videoElement.videoWidth,\r\n            videoHeight: videoElement.videoHeight,\r\n            readyState: videoElement.readyState,\r\n            paused: videoElement.paused\r\n        })\r\n\r\n        let isProcessing = false\r\n\r\n        const processFrame = async () => {\r\n            if (!faceLandmarkerRef.current || !videoElement || isProcessing) {\r\n                animationFrameRef.current = requestAnimationFrame(processFrame)\r\n                return\r\n            }\r\n\r\n            if (videoElement.readyState < 2) {\r\n                animationFrameRef.current = requestAnimationFrame(processFrame)\r\n                return\r\n            }\r\n\r\n            isProcessing = true\r\n            frameCountRef.current++\r\n\r\n            try {\r\n                const startTimeMs = performance.now()\r\n                const detections = faceLandmarkerRef.current.detectForVideo(videoElement, startTimeMs)\r\n\r\n                // Log every 60 frames (~1 second)\r\n                if (frameCountRef.current % 60 === 0) {\r\n                    console.log('ðŸ“¹ MediaPipe frame', frameCountRef.current, '- Faces detected:', detections.faceLandmarks?.length || 0)\r\n                }\r\n\r\n                if (detections.faceLandmarks && detections.faceLandmarks.length > 0) {\r\n                    const landmarks = detections.faceLandmarks[0]\r\n                    const blendshapes = detections.faceBlendshapes?.[0]?.categories\r\n\r\n                    // BLINK DETECTION\r\n                    let blinkDetected = false\r\n                    if (blendshapes) {\r\n                        const leftEyeBlink = blendshapes.find(b => b.categoryName === 'eyeBlinkLeft')\r\n                        const rightEyeBlink = blendshapes.find(b => b.categoryName === 'eyeBlinkRight')\r\n\r\n                        const leftScore = leftEyeBlink?.score || 0\r\n                        const rightScore = rightEyeBlink?.score || 0\r\n\r\n                        // Log eye scores every 60 frames\r\n                        if (frameCountRef.current % 60 === 0) {\r\n                            console.log('ðŸ‘ï¸ Eye scores:', { left: leftScore.toFixed(2), right: rightScore.toFixed(2) })\r\n                        }\r\n\r\n                        // Blink threshold: both eyes > 0.5\r\n                        if (leftScore > 0.5 && rightScore > 0.5) {\r\n                            const now = Date.now()\r\n                            if (now - lastBlinkTimeRef.current > 500) {\r\n                                blinkDetected = true\r\n                                lastBlinkTimeRef.current = now\r\n                                console.log('ðŸ‘ï¸ BLINK DETECTED!', { left: leftScore.toFixed(2), right: rightScore.toFixed(2) })\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // GAZE DIRECTION\r\n                    const leftIris = landmarks[468]\r\n                    const rightIris = landmarks[473]\r\n                    const noseTip = landmarks[1]\r\n\r\n                    let gazeDirection = null\r\n                    if (leftIris && rightIris && noseTip) {\r\n                        const avgIrisX = (leftIris.x + rightIris.x) / 2\r\n                        const avgIrisY = (leftIris.y + rightIris.y) / 2\r\n\r\n                        gazeDirection = {\r\n                            x: (avgIrisX - noseTip.x) * 10,\r\n                            y: (avgIrisY - noseTip.y) * 10\r\n                        }\r\n\r\n                        // Log gaze every 60 frames\r\n                        if (frameCountRef.current % 60 === 0) {\r\n                            console.log('ðŸ‘€ Gaze:', { x: gazeDirection.x.toFixed(2), y: gazeDirection.y.toFixed(2) })\r\n                        }\r\n                    }\r\n\r\n                    // HEAD ROTATION\r\n                    let headRotation = null\r\n                    if (detections.facialTransformationMatrixes && detections.facialTransformationMatrixes.length > 0) {\r\n                        const matrix = detections.facialTransformationMatrixes[0].data\r\n\r\n                        const pitch = Math.asin(-matrix[6]) * (180 / Math.PI)\r\n                        const yaw = Math.atan2(matrix[2], matrix[10]) * (180 / Math.PI)\r\n                        const roll = Math.atan2(matrix[4], matrix[5]) * (180 / Math.PI)\r\n\r\n                        headRotation = { pitch, yaw, roll }\r\n\r\n                        // Log head rotation every 60 frames\r\n                        if (frameCountRef.current % 60 === 0) {\r\n                            const total = Math.abs(pitch) + Math.abs(yaw) + Math.abs(roll)\r\n                            console.log('ðŸ—£ï¸ Head:', { pitch: pitch.toFixed(1), yaw: yaw.toFixed(1), roll: roll.toFixed(1), total: total.toFixed(1) })\r\n                        }\r\n                    }\r\n\r\n                    setResult({\n                        blinkDetected,\n                        gazeDirection,\n                        headRotation,\n                        faceDetected: true,\n                        ready: true\n                    })\n                } else {\n                    setResult({\n                        blinkDetected: false,\n                        gazeDirection: null,\n                        headRotation: null,\n                        faceDetected: false,\n                        ready: true\n                    })\n                }\n            } catch (error) {\r\n                console.error('Error processing frame:', error)\r\n            }\r\n\r\n            isProcessing = false\r\n            animationFrameRef.current = requestAnimationFrame(processFrame)\r\n        }\r\n\r\n        processFrame()\r\n\r\n        return () => {\r\n            if (animationFrameRef.current) {\r\n                cancelAnimationFrame(animationFrameRef.current)\r\n            }\r\n        }\r\n    }, [enabled, videoElement, isReady])\n\r\n    return result\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/lib/use-local-speech.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useRef, useState, useMemo } from 'react'\r\n\r\ninterface LocalSpeechResult {\r\n    text: string\r\n    confidence: number\r\n    timestamp: number\r\n}\r\n\r\ninterface LocalSpeechStatus {\r\n    available: boolean\r\n    recording: boolean\r\n    error: string | null\r\n    serviceUrl: string\r\n}\r\n\r\nconst SPEECH_SERVICE_URL = 'http://localhost:5050'\r\nconst RECORDING_INTERVAL = 1500 // Record 1.5 second chunks for faster response\r\n\r\n/**\r\n * Hook for local speech recognition using Whisper\r\n * Records audio chunks and sends them to local Python service\r\n */\r\nexport function useLocalSpeech(enabled: boolean) {\r\n    const initCountRef = useRef(0)\r\n    initCountRef.current++\r\n    \r\n    // Only log every 10th init to avoid console spam\r\n    if (initCountRef.current % 10 === 0) {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Hook initialized (count:', initCountRef.current, '), enabled:', enabled)\r\n    }\r\n    \r\n    const [transcription, setTranscription] = useState<LocalSpeechResult | null>(null)\r\n    const [status, setStatus] = useState<LocalSpeechStatus>({\r\n        available: false,\r\n        recording: false,\r\n        error: null,\r\n        serviceUrl: SPEECH_SERVICE_URL\r\n    })\r\n\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null)\r\n    const audioChunksRef = useRef<Blob[]>([])\r\n    const recordingIntervalRef = useRef<number | null>(null)\r\n    const isProcessingRef = useRef(false)\r\n    const serviceCheckIntervalRef = useRef<number | null>(null)\r\n\r\n    // Check if service is available - IMMEDIATE execution\r\n    useEffect(() => {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] ðŸ”¥ Service check effect RUNNING')\r\n        const checkService = async () => {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Checking service at:', SPEECH_SERVICE_URL)\r\n            try {\r\n                const controller = new AbortController()\r\n                const timeoutId = setTimeout(() => controller.abort(), 2000)\r\n                \r\n                const response = await fetch(`${SPEECH_SERVICE_URL}/health`, {\r\n                    method: 'GET',\r\n                    signal: controller.signal\r\n                })\r\n                \r\n                clearTimeout(timeoutId)\r\n                \r\n                if (response.ok) {\r\n                    const data = await response.json()\r\n                    console.log('ðŸŽ¤ [LOCAL SPEECH] âœ… Service available:', data)\r\n                    setStatus(prev => {\r\n                        // Only update if status changed\r\n                        if (prev.available !== true || prev.error !== null) {\r\n                            return { ...prev, available: true, error: null }\r\n                        }\r\n                        return prev\r\n                    })\r\n                } else {\r\n                    throw new Error(`Service returned ${response.status}`)\r\n                }\r\n            } catch (err: any) {\r\n                console.warn('ðŸŽ¤ [LOCAL SPEECH] âŒ Service not available:', err.message)\r\n                console.warn('ðŸŽ¤ [LOCAL SPEECH] Make sure to run: python speech_service.py')\r\n                setStatus(prev => {\r\n                    // Only update if status changed\r\n                    const newError = 'Service not running. Start with: python speech_service.py'\r\n                    if (prev.available !== false || prev.error !== newError) {\r\n                        return { ...prev, available: false, error: newError }\r\n                    }\r\n                    return prev\r\n                })\r\n            }\r\n        }\r\n\r\n        // Run check immediately\r\n        checkService()\r\n        \r\n        // Then check every 10s\r\n        if (serviceCheckIntervalRef.current) {\r\n            clearInterval(serviceCheckIntervalRef.current)\r\n        }\r\n        serviceCheckIntervalRef.current = window.setInterval(checkService, 10000)\r\n        \r\n        return () => {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Cleaning up service check interval')\r\n            if (serviceCheckIntervalRef.current) {\r\n                clearInterval(serviceCheckIntervalRef.current)\r\n                serviceCheckIntervalRef.current = null\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    // Start/stop recording based on enabled state\r\n    useEffect(() => {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Recording effect triggered', { enabled, available: status.available })\r\n        \r\n        if (!enabled || !status.available) {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Not starting recording - enabled:', enabled, 'available:', status.available)\r\n            stopRecording()\r\n            return\r\n        }\r\n\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] âœ… Starting local speech recognition...')\r\n        startRecording()\r\n\r\n        return () => {\r\n            console.log('ðŸŽ¤ [LOCAL SPEECH] Cleanup - stopping local speech recognition')\r\n            stopRecording()\r\n        }\r\n    }, [enabled, status.available])\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\r\n            \r\n            // Use webm format for better compatibility\r\n            const mimeType = MediaRecorder.isTypeSupported('audio/webm') \r\n                ? 'audio/webm' \r\n                : 'audio/wav'\r\n            \r\n            mediaRecorderRef.current = new MediaRecorder(stream, {\r\n                mimeType,\r\n                audioBitsPerSecond: 16000 // Lower quality for faster processing\r\n            })\r\n\r\n            mediaRecorderRef.current.ondataavailable = (event) => {\r\n                if (event.data.size > 0) {\r\n                    audioChunksRef.current.push(event.data)\r\n                }\r\n            }\r\n\r\n            mediaRecorderRef.current.onstop = async () => {\r\n                if (audioChunksRef.current.length === 0) return\r\n                if (isProcessingRef.current) return\r\n\r\n                const audioBlob = new Blob(audioChunksRef.current, { type: mimeType })\r\n                audioChunksRef.current = []\r\n\r\n                // Only process if blob has reasonable size (some audio was captured)\r\n                if (audioBlob.size > 1000) {\r\n                    await sendAudioToService(audioBlob)\r\n                }\r\n\r\n                // Restart recording if still enabled\r\n                if (enabled && status.available && mediaRecorderRef.current) {\r\n                    audioChunksRef.current = []\r\n                    mediaRecorderRef.current.start()\r\n                    \r\n                    // Stop and process after interval\r\n                    if (recordingIntervalRef.current) {\r\n                        clearTimeout(recordingIntervalRef.current)\r\n                    }\r\n                    recordingIntervalRef.current = window.setTimeout(() => {\r\n                        if (mediaRecorderRef.current?.state === 'recording') {\r\n                            mediaRecorderRef.current.stop()\r\n                        }\r\n                    }, RECORDING_INTERVAL)\r\n                }\r\n            }\r\n\r\n            // Start recording\r\n            mediaRecorderRef.current.start()\r\n            setStatus(prev => ({ ...prev, recording: true }))\r\n            console.log('ðŸŽ¤ Recording started with format:', mimeType)\r\n\r\n            // Stop after interval to process\r\n            recordingIntervalRef.current = window.setTimeout(() => {\r\n                if (mediaRecorderRef.current?.state === 'recording') {\r\n                    mediaRecorderRef.current.stop()\r\n                }\r\n            }, RECORDING_INTERVAL)\r\n\r\n        } catch (err: any) {\r\n            console.error('ðŸŽ¤ Failed to start recording:', err)\r\n            setStatus(prev => ({ ...prev, recording: false, error: err.message }))\r\n        }\r\n    }\r\n\r\n    const stopRecording = () => {\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Stopping recording...')\r\n        \r\n        if (recordingIntervalRef.current) {\r\n            clearTimeout(recordingIntervalRef.current)\r\n            recordingIntervalRef.current = null\r\n        }\r\n\r\n        if (mediaRecorderRef.current) {\r\n            try {\r\n                if (mediaRecorderRef.current.state === 'recording' || mediaRecorderRef.current.state === 'paused') {\r\n                    console.log('ðŸŽ¤ [LOCAL SPEECH] Stopping MediaRecorder')\r\n                    mediaRecorderRef.current.stop()\r\n                }\r\n                \r\n                // Stop all tracks\r\n                if (mediaRecorderRef.current.stream) {\r\n                    console.log('ðŸŽ¤ [LOCAL SPEECH] Stopping audio tracks')\r\n                    mediaRecorderRef.current.stream.getTracks().forEach(track => {\r\n                        track.stop()\r\n                        console.log('ðŸŽ¤ [LOCAL SPEECH] Stopped track:', track.kind)\r\n                    })\r\n                }\r\n            } catch (err) {\r\n                console.warn('ðŸŽ¤ [LOCAL SPEECH] Error stopping recording:', err)\r\n            }\r\n            \r\n            mediaRecorderRef.current = null\r\n        }\r\n\r\n        audioChunksRef.current = []\r\n        isProcessingRef.current = false\r\n        setStatus(prev => ({ ...prev, recording: false }))\r\n        console.log('ðŸŽ¤ [LOCAL SPEECH] Recording fully stopped')\r\n    }\r\n\r\n    const sendAudioToService = async (audioBlob: Blob) => {\r\n        if (isProcessingRef.current) return\r\n        \r\n        isProcessingRef.current = true\r\n        \r\n        try {\r\n            console.log('ðŸŽ¤ Sending audio to service...', audioBlob.size, 'bytes')\r\n            \r\n            const formData = new FormData()\r\n            formData.append('audio', audioBlob, 'audio.webm')\r\n\r\n            const response = await fetch(`${SPEECH_SERVICE_URL}/transcribe`, {\r\n                method: 'POST',\r\n                body: formData,\r\n                signal: AbortSignal.timeout(10000) // 10s timeout\r\n            })\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`Service returned ${response.status}`)\r\n            }\r\n\r\n            const result = await response.json()\r\n            \r\n            if (result.text && result.text.trim().length > 0) {\r\n                console.log('ðŸŽ¤ Transcription received:', result.text)\r\n                setTranscription({\r\n                    text: result.text,\r\n                    confidence: result.confidence || 0.8,\r\n                    timestamp: Date.now()\r\n                })\r\n            } else {\r\n                console.log('ðŸŽ¤ No speech detected in chunk')\r\n            }\r\n\r\n        } catch (err: any) {\r\n            console.error('ðŸŽ¤ Failed to transcribe:', err.message)\r\n            setStatus(prev => ({ ...prev, error: err.message }))\r\n        } finally {\r\n            isProcessingRef.current = false\r\n        }\r\n    }\r\n\r\n    // Memoize return value to prevent unnecessary re-renders\r\n    return useMemo(() => ({\r\n        transcription,\r\n        status\r\n    }), [transcription, status])\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 485, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/lib/use-passive-sensing.ts"],"sourcesContent":["'use client'\n\nimport { useEffect, useRef, useState, useCallback } from 'react'\nimport { useMediaPipeFace } from './use-mediapipe-face'\nimport { useLocalSpeech } from './use-local-speech'\n\nexport type InputType = 'voice' | 'motion' | 'switch' | 'blink' | 'gaze' | 'head' | 'sign' | 'facial' | 'sip-puff' | 'none'\n\ninterface PassiveSensingResult {\n    type: InputType\n    confidence: number\n    data?: any\n}\n\ninterface TranscriptionResult {\n    text: string\n    timestamp: number\n    confidence: number\n}\n\nexport interface PassiveSensingStatus {\n    audioReady: boolean\n    videoReady: boolean\n    speechAvailable: boolean\n    speechActive: boolean\n    speechError: string | null\n    mediaPipeReady: boolean\n    faceDetected: boolean\n    detectionLocked: boolean\n    audioLevel: number\n    lastTranscript: string\n    lastSpeechEvent: string\n    speechEventCounts: Record<string, number>\n    localSpeechAvailable?: boolean\n    localSpeechRecording?: boolean\n    localSpeechError?: string | null\n}\n\nexport interface PassiveSensingOptions {\n    voiceVolumeThreshold?: number\n    voiceConsecutiveFrames?: number\n    disableGaze?: boolean\n    disableVoiceVolume?: boolean\n    suppressVoiceWhileSpeaking?: boolean\n    allowedInputTypes?: InputType[]\n}\n\nexport function usePassiveSensing(enabled: boolean, options: PassiveSensingOptions = {}) {\n    const voiceVolumeThreshold = options.voiceVolumeThreshold ?? 10\n    const voiceConsecutiveFrames = options.voiceConsecutiveFrames ?? 2\n    const disableGaze = options.disableGaze ?? false\n    const disableVoiceVolume = options.disableVoiceVolume ?? false\n    const suppressVoiceWhileSpeaking = options.suppressVoiceWhileSpeaking ?? false\n    const allowedInputTypes = options.allowedInputTypes ?? null\n    const [detectedInput, setDetectedInput] = useState<PassiveSensingResult | null>(null)\n    const [transcription, setTranscription] = useState<TranscriptionResult | null>(null)\n    const [audioLevel, setAudioLevel] = useState(0)\n    const [videoElement, setVideoElement] = useState<HTMLVideoElement | null>(null)\n    const [audioReady, setAudioReady] = useState(false)\n    const [videoReady, setVideoReady] = useState(false)\n    const [speechAvailable, setSpeechAvailable] = useState(false)\n    const [speechActive, setSpeechActive] = useState(false)\n    const [speechError, setSpeechError] = useState<string | null>(null)\n    const [lastTranscript, setLastTranscript] = useState<string>('')\n    const [lastSpeechEvent, setLastSpeechEvent] = useState<string>('none')\n    const [speechEventCounts, setSpeechEventCounts] = useState<Record<string, number>>({})\n    const audioContextRef = useRef<AudioContext | null>(null)\n    const analyserRef = useRef<AnalyserNode | null>(null)\n    const recognitionRef = useRef<any>(null)\n    const recognitionActiveRef = useRef<boolean>(false)\n    const speechRestartTimerRef = useRef<number | null>(null)\n    const detectionLockRef = useRef<boolean>(false)\n    const streamRef = useRef<MediaStream | null>(null)\n    const headPitchHistoryRef = useRef<Array<{ t: number; pitch: number }>>([])\n    const lastNodTimeRef = useRef<number>(0)\n    const lastPitchRef = useRef<number | null>(null)\n    const lastPitchDirRef = useRef<1 | -1 | 0>(0)\n    \n    // Reset detection lock when enabled changes (but DON'T clear detectedInput state)\n    useEffect(() => {\n        if (enabled) {\n            console.log('ðŸ”“ Resetting detection lock (detectionLockRef only)')\n            detectionLockRef.current = false\n            // DON'T reset setDetectedInput here - it clears valid detections!\n        }\n    }, [enabled])\n\n    // Callback ref for video element\n    const videoRef = useCallback((node: HTMLVideoElement | null) => {\n        if (node) {\n            console.log('ðŸ“¹ Video element mounted')\n            setVideoElement(node)\n            if (streamRef.current) {\n                node.srcObject = streamRef.current\n                node.play().catch(() => {\n                    // Autoplay can fail until user gesture; keep stream attached.\n                })\n            }\n        }\n    }, [])\n\n    // MediaPipe face detection\n    const faceDetection = useMediaPipeFace(videoElement, enabled)\n\n    // Local speech recognition (Whisper-based) - memoize to prevent re-renders\n    const shouldEnableLocalSpeech = enabled && !disableVoiceVolume && (!allowedInputTypes || allowedInputTypes.includes('voice'))\n    const localSpeech = useLocalSpeech(shouldEnableLocalSpeech)\n\n    // Update transcription from local speech - use timestamp to avoid re-render loops\n    const lastTranscriptionTimestampRef = useRef<number>(0)\n    useEffect(() => {\n        if (localSpeech.transcription) {\n            // Only process if this is a NEW transcription\n            if (localSpeech.transcription.timestamp !== lastTranscriptionTimestampRef.current) {\n                lastTranscriptionTimestampRef.current = localSpeech.transcription.timestamp\n                \n                console.log('ðŸŽ¤ Local speech transcription:', localSpeech.transcription.text)\n                setLastTranscript(localSpeech.transcription.text)\n                setTranscription(localSpeech.transcription)\n\n                // Detect voice input from transcription\n                if (!detectionLockRef.current && localSpeech.transcription.text.trim().length > 0) {\n                    console.log('ðŸŽ¤ Voice detected via local transcription')\n                    detectionLockRef.current = true\n                    setDetectedInput({\n                        type: 'voice',\n                        confidence: localSpeech.transcription.confidence,\n                        data: { text: localSpeech.transcription.text }\n                    })\n                }\n            }\n        }\n    }, [localSpeech.transcription?.timestamp])\n\n    useEffect(() => {\n        console.log('ðŸŽ¤ usePassiveSensing effect triggered', {\n            enabled,\n            suppressVoiceWhileSpeaking,\n            allowedInputTypes,\n            disableVoiceVolume,\n            localSpeechAvailable: localSpeech.status.available,\n            localSpeechRecording: localSpeech.status.recording\n        })\n        \n        if (!enabled) {\n            console.log('ðŸŽ¤ Hook is disabled, not starting')\n            return\n        }\n\n        let animationFrameId: number\n        let stream: MediaStream | null = null\n\n        // AUDIO DETECTION + LIVE TRANSCRIPTION\n        const setupAudio = async () => {\n            try {\n                console.log('ðŸŽ¤ Requesting audio access...')\n                const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true })\n\n                audioContextRef.current = new AudioContext()\n                analyserRef.current = audioContextRef.current.createAnalyser()\n                const source = audioContextRef.current.createMediaStreamSource(audioStream)\n                source.connect(analyserRef.current)\n                analyserRef.current.fftSize = 2048\n                analyserRef.current.smoothingTimeConstant = 0.8\n\n                console.log('âœ“ Audio detection ready, analyser:', analyserRef.current)\n                setAudioReady(true)\n\n                const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition\n                if (SpeechRecognition) {\n                    console.log('ðŸŽ¤ Speech Recognition API available')\n                    setSpeechAvailable(true)\n                    if (!recognitionRef.current) {\n                        console.log('ðŸŽ¤ Creating new SpeechRecognition instance')\n                        recognitionRef.current = new SpeechRecognition()\n                        recognitionRef.current.continuous = true\n                        recognitionRef.current.interimResults = true\n                        recognitionRef.current.lang = 'en-US'\n                        console.log('ðŸŽ¤ SpeechRecognition configured:', {\n                            continuous: recognitionRef.current.continuous,\n                            interimResults: recognitionRef.current.interimResults,\n                            lang: recognitionRef.current.lang\n                        })\n                    } else {\n                        console.log('ðŸŽ¤ Reusing existing SpeechRecognition instance')\n                    }\n\n                    const bumpEvent = (name: string) => {\n                        console.log(`ðŸŽ¤ Speech event: ${name}`)\n                        setLastSpeechEvent(name)\n                        setSpeechEventCounts(prev => ({\n                            ...prev,\n                            [name]: (prev[name] || 0) + 1\n                        }))\n                    }\n\n                    recognitionRef.current.onstart = () => {\n                        console.log('ðŸŽ¤ STARTED - Recognition is now listening')\n                        setSpeechActive(true)\n                        bumpEvent('start')\n                    }\n                    recognitionRef.current.onaudiostart = () => {\n                        console.log('ðŸŽ¤ AUDIO START - User agent has started to capture audio')\n                        bumpEvent('audio_start')\n                    }\n                    recognitionRef.current.onsoundstart = () => {\n                        console.log('ðŸŽ¤ SOUND START - Any sound (including speech) has been detected')\n                        bumpEvent('sound_start')\n                    }\n                    recognitionRef.current.onspeechstart = () => {\n                        console.log('ðŸŽ¤ SPEECH START - Speech recognized by speech detection')\n                        bumpEvent('speech_start')\n                    }\n                    recognitionRef.current.onspeechend = () => {\n                        console.log('ðŸŽ¤ SPEECH END - Speech has stopped being detected')\n                        bumpEvent('speech_end')\n                    }\n                    recognitionRef.current.onaudioend = () => {\n                        console.log('ðŸŽ¤ AUDIO END - User agent has finished capturing audio')\n                        bumpEvent('audio_end')\n                    }\n                    recognitionRef.current.onnomatch = () => {\n                        console.log('ðŸŽ¤ NO MATCH - Speech was detected but no recognition result')\n                        bumpEvent('no_match')\n                    }\n\n                    recognitionRef.current.onresult = (event: any) => {\n                        const last = event.results.length - 1\n                        const text = event.results[last][0].transcript\n                        const confidence = event.results[last][0].confidence\n                        const isFinal = event.results[last].isFinal\n\n                        console.log('ðŸŽ¤ RESULT:', {\n                            text,\n                            confidence,\n                            isFinal,\n                            resultCount: event.results.length,\n                            suppressVoiceWhileSpeaking,\n                            isTTSSpeaking: window.speechSynthesis.speaking,\n                            allowedInputTypes,\n                            detectionLocked: detectionLockRef.current\n                        })\n                        \n                        bumpEvent('result')\n                        setLastTranscript(text.trim())\n\n                        if (suppressVoiceWhileSpeaking && window.speechSynthesis.speaking) {\n                            console.log('ðŸŽ¤ BLOCKED: TTS is speaking, ignoring transcription')\n                            return\n                        }\n                        if (allowedInputTypes && !allowedInputTypes.includes('voice')) {\n                            console.log('ðŸŽ¤ BLOCKED: voice not in allowedInputTypes:', allowedInputTypes)\n                            return\n                        }\n\n                        console.log('ðŸŽ¤ Setting transcription state:', text.trim())\n                        setTranscription({\n                            text: text.trim(),\n                            timestamp: Date.now(),\n                            confidence: confidence || 0.8\n                        })\n\n                        if (!detectionLockRef.current && text.trim().length > 0) {\n                            console.log('ðŸŽ¤ Voice detected via transcription, setting detectedInput')\n                            detectionLockRef.current = true\n                            setDetectedInput({\n                                type: 'voice',\n                                confidence: confidence || 0.8,\n                                data: { text }\n                            })\n                        } else if (detectionLockRef.current) {\n                            console.log('ðŸŽ¤ Detection lock is active, not setting detectedInput')\n                        }\n                    }\n\n                    recognitionRef.current.onerror = (event: any) => {\n                        console.log('ðŸŽ¤ ERROR:', {\n                            error: event.error,\n                            message: event.message,\n                            willRestart: event.error === 'aborted'\n                        })\n                        bumpEvent('error')\n                        \n                        // Silently ignore network and no-speech errors\n                        if (event.error === 'network' || event.error === 'no-speech') {\n                            console.log('ðŸŽ¤ Ignoring network/no-speech error')\n                            return\n                        }\n                        \n                        setSpeechError(event.error || 'unknown')\n                        if (event.error === 'aborted') {\n                            console.log('ðŸŽ¤ Scheduling restart after abort')\n                            scheduleSpeechRestart()\n                        }\n                    }\n                    \n                    recognitionRef.current.onend = () => {\n                        console.log('ðŸŽ¤ END - Recognition has stopped', {\n                            wasActive: recognitionActiveRef.current,\n                            enabled,\n                            willRestart: enabled\n                        })\n                        bumpEvent('end')\n                        recognitionActiveRef.current = false\n                        setSpeechActive(false)\n                        if (!enabled) {\n                            console.log('ðŸŽ¤ Not enabled, not restarting')\n                            return\n                        }\n                        console.log('ðŸŽ¤ Scheduling restart')\n                        scheduleSpeechRestart()\n                    }\n\n                    console.log('ðŸŽ¤ All event handlers attached, calling startSpeechRecognition()')\n                    startSpeechRecognition()\n                } else {\n                    console.warn('âš ï¸ Speech Recognition API not available')\n                    setSpeechAvailable(false)\n                }\n            } catch (err) {\n                console.warn('Audio access denied:', err)\n                setAudioReady(false)\n            }\n        }\n\n        // VIDEO DETECTION\n        const setupVideo = async () => {\n            try {\n                stream = await navigator.mediaDevices.getUserMedia({ video: true })\n                streamRef.current = stream\n                if (videoElement) {\n                    videoElement.srcObject = stream\n                    await videoElement.play()\n                    console.log('âœ“ Video detection ready, element:', videoElement.videoWidth, 'x', videoElement.videoHeight)\n                    setVideoReady(true)\n                }\n            } catch (err) {\n                console.warn('Video access denied:', err)\n                setVideoReady(false)\n            }\n        }\n\n        // KEYBOARD / SWITCH\n        const handleKeyPress = (e: KeyboardEvent) => {\n            if (detectionLockRef.current) return\n            if (allowedInputTypes && !allowedInputTypes.includes('switch')) return\n            console.log('ðŸŽ¹ Keyboard/Switch detected:', e.key)\n            detectionLockRef.current = true\n            setDetectedInput({\n                type: 'switch',\n                confidence: 1.0,\n                data: { key: e.key }\n            })\n        }\n\n        // MOUSE MOVEMENT\n        let mousePositions: { x: number; y: number; time: number }[] = []\n        const handleMouseMove = (e: MouseEvent) => {\n            if (detectionLockRef.current) return\n            if (allowedInputTypes && !allowedInputTypes.includes('motion')) return\n\n            const now = Date.now()\n            mousePositions.push({ x: e.clientX, y: e.clientY, time: now })\n            if (mousePositions.length > 10) mousePositions.shift()\n\n            if (mousePositions.length >= 5) {\n                const recentPositions = mousePositions.slice(-5)\n                const timeSpan = recentPositions[4].time - recentPositions[0].time\n\n                if (timeSpan > 0) {\n                    const totalDistance = recentPositions.reduce((sum, pos, i) => {\n                        if (i === 0) return 0\n                        const prev = recentPositions[i - 1]\n                        const dx = pos.x - prev.x\n                        const dy = pos.y - prev.y\n                        return sum + Math.sqrt(dx * dx + dy * dy)\n                    }, 0)\n\n                    const velocity = totalDistance / (timeSpan / 1000)\n\n                    if (velocity > 50) {\n                        console.log('ðŸ–±ï¸ Mouse motion detected, velocity:', velocity.toFixed(0), 'px/sec')\n                        detectionLockRef.current = true\n                        setDetectedInput({\n                            type: 'motion',\n                            confidence: 0.9,\n                            data: { source: 'mouse', velocity }\n                        })\n                    }\n                }\n            }\n        }\n\n        // TOUCH\n        const handleTouchStart = (e: TouchEvent) => {\n            if (detectionLockRef.current) return\n            if (allowedInputTypes && !allowedInputTypes.includes('motion')) return\n            console.log('ðŸ‘† Touch detected')\n            detectionLockRef.current = true\n            setDetectedInput({\n                type: 'motion',\n                confidence: 1.0,\n                data: { source: 'touch' }\n            })\n        }\n\n        // GAMEPAD\n        const checkGamepads = () => {\n            const gamepads = navigator.getGamepads()\n            for (const gamepad of gamepads) {\n                if (gamepad && !detectionLockRef.current) {\n                    for (let i = 0; i < gamepad.buttons.length; i++) {\n                        if (gamepad.buttons[i].pressed) {\n                            if (allowedInputTypes && !allowedInputTypes.includes('switch')) return\n                            console.log('ðŸŽ® Gamepad button detected:', i)\n                            detectionLockRef.current = true\n                            setDetectedInput({\n                                type: 'switch',\n                                confidence: 1.0,\n                                data: { source: 'gamepad', button: i }\n                            })\n                            return\n                        }\n                    }\n                }\n            }\n        }\n\n        // AUDIO LEVEL MONITORING\n        const voiceDetectionCountRef = { current: 0 } // Use an object so it persists across calls\n        const monitorAudio = () => {\n            if (!analyserRef.current) return\n\n            const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount)\n            analyserRef.current.getByteFrequencyData(dataArray)\n            const average = dataArray.reduce((a, b) => a + b) / dataArray.length\n\n            setAudioLevel(average)\n\n            // Debug: Log audio level periodically\n            if (Math.random() < 0.1) { // 10% chance to log (not every frame)\n                console.log('ðŸ”Š Audio level:', average.toFixed(1))\n            }\n\n            // Audio detection via volume\n            if (\n                !disableVoiceVolume &&\n                (!suppressVoiceWhileSpeaking || !window.speechSynthesis.speaking) &&\n                average > voiceVolumeThreshold\n            ) {\n                if (allowedInputTypes && !allowedInputTypes.includes('voice')) {\n                    return\n                }\n                voiceDetectionCountRef.current++\n                if (voiceDetectionCountRef.current >= voiceConsecutiveFrames && !detectionLockRef.current) {\n                    console.log('ðŸŽ¤ Voice detected via volume, level:', average.toFixed(1), 'Setting detection lock and state...')\n                    detectionLockRef.current = true\n                    const detection = {\n                        type: 'voice' as const,\n                        confidence: Math.min(average / 50, 1.0),\n                        data: { volume: average }\n                    }\n                    console.log('ðŸŽ¤ Calling setDetectedInput with:', detection)\n                    setDetectedInput(detection)\n                }\n            } else {\n                voiceDetectionCountRef.current = 0\n            }\n        }\n\n        const monitor = () => {\n            monitorAudio()\n            checkGamepads()\n            animationFrameId = requestAnimationFrame(monitor)\n        }\n\n        console.log('ðŸ” Protocol Omega: Starting omni-listener...')\n        setupAudio()\n        setupVideo()\n        window.addEventListener('keydown', handleKeyPress)\n        window.addEventListener('mousemove', handleMouseMove)\n        window.addEventListener('touchstart', handleTouchStart)\n        monitor()\n\n        return () => {\n            console.log('ðŸ›‘ Protocol Omega: Stopping omni-listener')\n            cancelAnimationFrame(animationFrameId)\n            window.removeEventListener('keydown', handleKeyPress)\n            window.removeEventListener('mousemove', handleMouseMove)\n            window.removeEventListener('touchstart', handleTouchStart)\n            if (stream) stream.getTracks().forEach(track => track.stop())\n            if (streamRef.current) {\n                streamRef.current.getTracks().forEach(track => track.stop())\n                streamRef.current = null\n            }\n            if (audioContextRef.current) audioContextRef.current.close()\n            if (recognitionRef.current) {\n                try { recognitionRef.current.stop() } catch {}\n                recognitionActiveRef.current = false\n                setSpeechActive(false)\n            }\n            if (speechRestartTimerRef.current) {\n                clearTimeout(speechRestartTimerRef.current)\n                speechRestartTimerRef.current = null\n            }\n        }\n    }, [enabled, videoElement])\n\n    // MEDIAPIPE FACE DETECTION\n    useEffect(() => {\n        if (!enabled || detectionLockRef.current) return\n\n        console.log('ðŸ‘ï¸ Checking face detection...', {\n            enabled,\n            locked: detectionLockRef.current,\n            hasBlinkDetection: !!faceDetection.blinkDetected,\n            hasHeadRotation: !!faceDetection.headRotation,\n            hasGazeDirection: !!faceDetection.gazeDirection\n        })\n\n        // Blink detection\n        if (faceDetection.blinkDetected) {\n            if (allowedInputTypes && !allowedInputTypes.includes('blink')) return\n            console.log('ðŸ‘ï¸ BLINK DETECTED via MediaPipe!')\n            detectionLockRef.current = true\n            setDetectedInput({\n                type: 'blink',\n                confidence: 1.0,\n                data: { source: 'mediapipe' }\n            })\n            return\n        }\n\n        // Head rotation detection\n        if (faceDetection.headRotation) {\n            if (allowedInputTypes && !allowedInputTypes.includes('head')) {\n                return\n            }\n            const { pitch, yaw, roll } = faceDetection.headRotation\n            const totalRotation = Math.abs(pitch) + Math.abs(yaw) + Math.abs(roll)\n\n            // Simple nod detector: detect pitch swing with direction changes.\n            const now = Date.now()\n            const history = headPitchHistoryRef.current\n            history.push({ t: now, pitch })\n            while (history.length > 0 && now - history[0].t > 900) {\n                history.shift()\n            }\n            if (now - lastNodTimeRef.current < 800) {\n                return\n            }\n            if (history.length >= 6) {\n                let minPitch = history[0].pitch\n                let maxPitch = history[0].pitch\n                let signChanges = 0\n                let lastDir: 1 | -1 | 0 = lastPitchDirRef.current\n                let prevPitch: number | null = lastPitchRef.current\n                for (const h of history) {\n                    if (h.pitch < minPitch) minPitch = h.pitch\n                    if (h.pitch > maxPitch) maxPitch = h.pitch\n                    if (prevPitch !== null) {\n                        const delta = h.pitch - prevPitch\n                        const dir: 1 | -1 | 0 = delta > 0.2 ? 1 : delta < -0.2 ? -1 : 0\n                        if (dir !== 0 && lastDir !== 0 && dir !== lastDir) {\n                            signChanges++\n                        }\n                        if (dir !== 0) lastDir = dir\n                    }\n                    prevPitch = h.pitch\n                }\n                const swing = maxPitch - minPitch\n                if (swing >= 14 && signChanges >= 2) {\n                    console.log('HEAD NOD DETECTED', { minPitch: minPitch.toFixed(1), maxPitch: maxPitch.toFixed(1), swing: swing.toFixed(1), signChanges })\n                    lastNodTimeRef.current = now\n                    detectionLockRef.current = true\n                    headPitchHistoryRef.current = []\n                    lastPitchRef.current = null\n                    lastPitchDirRef.current = 0\n                    setDetectedInput({\n                        type: 'head',\n                        confidence: 0.95,\n                        data: { pitch, yaw, roll, nod: true }\n                    })\n                    return\n                }\n            }\n            lastPitchRef.current = pitch\n\n            // Very sensitive threshold for onboarding: >5 degrees\n            if (totalRotation > 3) {\n                console.log('ðŸ—£ï¸ HEAD MOTION DETECTED!', { pitch: pitch.toFixed(1), yaw: yaw.toFixed(1), roll: roll.toFixed(1), total: totalRotation.toFixed(1) })\n                detectionLockRef.current = true\n                setDetectedInput({\n                    type: 'head',\n                    confidence: 0.9,\n                    data: { pitch, yaw, roll }\n                })\n                return\n            }\n        }\n\n        // Gaze detection - more sensitive for onboarding\n        if (!disableGaze && faceDetection.gazeDirection) {\n            if (allowedInputTypes && !allowedInputTypes.includes('gaze')) return\n            const { x, y } = faceDetection.gazeDirection\n            const gazeDistance = Math.sqrt(x * x + y * y)\n\n            if (gazeDistance > 0.5) {\n                console.log('ðŸ‘€ GAZE DETECTED!', { x: x.toFixed(2), y: y.toFixed(2), distance: gazeDistance.toFixed(2) })\n                detectionLockRef.current = true\n                setDetectedInput({\n                    type: 'gaze',\n                    confidence: 0.85,\n                    data: { x, y }\n                })\n            }\n        }\n    }, [enabled, faceDetection])\n\n    // Auto-clear transcription\n    useEffect(() => {\n        if (!transcription) return\n        const timer = setTimeout(() => setTranscription(null), 3000)\n        return () => clearTimeout(timer)\n    }, [transcription])\n\n    // Removed old throttled logging - now done at return statement\n\n    const startSpeechRecognition = () => {\n        console.log('ðŸŽ¤ startSpeechRecognition() called', {\n            hasRecognition: !!recognitionRef.current,\n            isActive: recognitionActiveRef.current,\n            enabled,\n            isTTSSpeaking: window.speechSynthesis.speaking,\n            speechSynthesisPending: window.speechSynthesis.pending\n        })\n        \n        if (!recognitionRef.current) {\n            console.log('ðŸŽ¤ ABORT: No recognition ref')\n            return\n        }\n        if (recognitionActiveRef.current) {\n            console.log('ðŸŽ¤ ABORT: Already active')\n            return\n        }\n        \n        try {\n            console.log('ðŸŽ¤ Calling recognition.start()...')\n            recognitionRef.current.start()\n            recognitionActiveRef.current = true\n            console.log('âœ“ Live transcription ready - recognition.start() succeeded')\n            setSpeechActive(true)\n            setSpeechError(null)\n        } catch (err: any) {\n            console.error('ðŸŽ¤ FAILED to start speech recognition:', err.message, err)\n            setSpeechError('start_failed')\n        }\n    }\n\n    const scheduleSpeechRestart = () => {\n        console.log('ðŸŽ¤ scheduleSpeechRestart() called', {\n            hasRecognition: !!recognitionRef.current,\n            enabled,\n            hasExistingTimer: !!speechRestartTimerRef.current\n        })\n        \n        if (!recognitionRef.current || !enabled) {\n            console.log('ðŸŽ¤ ABORT restart: no recognition or not enabled')\n            return\n        }\n        if (speechRestartTimerRef.current) {\n            console.log('ðŸŽ¤ ABORT restart: timer already scheduled')\n            return\n        }\n        \n        console.log('ðŸŽ¤ Scheduling restart in 800ms...')\n        speechRestartTimerRef.current = window.setTimeout(() => {\n            console.log('ðŸŽ¤ Restart timer fired')\n            speechRestartTimerRef.current = null\n            startSpeechRecognition()\n        }, 800)\n    }\n\n    const status: PassiveSensingStatus = {\n        audioReady,\n        videoReady,\n        speechAvailable,\n        speechActive,\n        speechError,\n        mediaPipeReady: faceDetection.ready,\n        faceDetected: faceDetection.faceDetected,\n        detectionLocked: detectionLockRef.current,\n        audioLevel,\n        lastTranscript,\n        lastSpeechEvent,\n        speechEventCounts,\n        localSpeechAvailable: localSpeech.status.available,\n        localSpeechRecording: localSpeech.status.recording,\n        localSpeechError: localSpeech.status.error\n    }\n\n    // Periodic detailed logging (every 2s)\n    if (Math.random() < 0.03) { // ~2 second intervals at 60fps\n        console.log('ðŸ”„ usePassiveSensing STATE:', {\n            enabled,\n            hasDetectedInput: !!detectedInput,\n            detectedInputType: detectedInput?.type,\n            hasTranscription: !!transcription,\n            transcriptionText: transcription?.text,\n            audioLevel: Math.round(audioLevel),\n            speechStatus: {\n                available: speechAvailable,\n                active: speechActive,\n                error: speechError,\n                lastEvent: lastSpeechEvent,\n                lastTranscript,\n                isTTSSpeaking: window.speechSynthesis.speaking\n            }\n        })\n    }\n\n    return {\n        detectedInput,\n        transcription,\n        audioLevel,\n        videoRef,\n        faceData: faceDetection,\n        requestSpeechStart: startSpeechRecognition,\n        status\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/components/onboarding/beacon-screen.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState, useEffect, useRef } from 'react'\nimport { usePassiveSensing, type InputType } from '@/lib/use-passive-sensing'\nimport { Volume2, Eye, Hand, Keyboard, Activity, Wind, Smile, Move } from 'lucide-react'\n\nexport function BeaconScreen({ onInputDetected }: { onInputDetected: (type: InputType) => void }) {\n    const [audioPlayed, setAudioPlayed] = useState(false)\n    const [timeoutCounter, setTimeoutCounter] = useState(0)\n    const [autoScanStarted, setAutoScanStarted] = useState(false)\n    const { detectedInput, transcription, audioLevel, videoRef, faceData, status } = usePassiveSensing(true, {\n        voiceVolumeThreshold: 25,\n        voiceConsecutiveFrames: 3,\n        suppressVoiceWhileSpeaking: true\n    })\n    const scanIntervalRef = useRef<NodeJS.Timeout | null>(null)\n    const canvasRef = useRef<HTMLCanvasElement | null>(null)\n\n    // Auto-play welcome audio (ONCE)\n    useEffect(() => {\n        if (audioPlayed) return\n\n        const speak = () => {\n            window.speechSynthesis.cancel()\n            const utterance = new SpeechSynthesisUtterance(\n                'I am listening. Make any sound, move your head, or press any switch to start.'\n            )\n            utterance.rate = 0.9\n            utterance.pitch = 1.0\n            window.speechSynthesis.speak(utterance)\n            setAudioPlayed(true)\n        }\n\n        const timer = setTimeout(speak, 500)\n        return () => clearTimeout(timer)\n    }, [audioPlayed])\n\n    // Counter for timeout\n    useEffect(() => {\n        if (detectedInput) return\n\n        const interval = setInterval(() => {\n            setTimeoutCounter(prev => prev + 1)\n        }, 1000)\n\n        return () => clearInterval(interval)\n    }, [detectedInput])\n\n    // Repeat reminder every 15 seconds\n    useEffect(() => {\n        if (detectedInput || autoScanStarted || timeoutCounter === 0) return\n\n        if (timeoutCounter % 15 === 0) {\n            window.speechSynthesis.cancel()\n            const utterance = new SpeechSynthesisUtterance(\n                'Still listening. Make any sound or movement to begin.'\n            )\n            utterance.rate = 0.9\n            window.speechSynthesis.speak(utterance)\n        }\n    }, [timeoutCounter, detectedInput, autoScanStarted])\n\n    // Auto-scan mode after 30 seconds (ONCE)\n    useEffect(() => {\n        if (timeoutCounter >= 30 && !detectedInput && !autoScanStarted) {\n            setAutoScanStarted(true)\n\n            window.speechSynthesis.cancel()\n            const utterance = new SpeechSynthesisUtterance(\n                'Entering auto-scan mode. Press any key or make a sound when you hear Setup.'\n            )\n            utterance.rate = 0.8\n            window.speechSynthesis.speak(utterance)\n\n            utterance.onend = () => {\n                let scanIndex = 0\n                const options = ['Setup', 'Exit']\n\n                scanIntervalRef.current = setInterval(() => {\n                    const scanUtterance = new SpeechSynthesisUtterance(options[scanIndex])\n                    scanUtterance.rate = 0.9\n                    window.speechSynthesis.speak(scanUtterance)\n\n                    scanIndex = (scanIndex + 1) % options.length\n                }, 2000)\n            }\n        }\n    }, [timeoutCounter, detectedInput, autoScanStarted])\n\n    // Cleanup scan interval when input detected\n    useEffect(() => {\n        if (detectedInput && scanIntervalRef.current) {\n            clearInterval(scanIntervalRef.current)\n            scanIntervalRef.current = null\n            window.speechSynthesis.cancel()\n        }\n    }, [detectedInput])\n\n    // Handle detected input - for onboarding, accept ANY detection (no confidence threshold)\n    useEffect(() => {\n        console.log('ðŸš¨ BeaconScreen detectedInput changed:', detectedInput)\n        if (detectedInput) {\n            console.log('ðŸš¨ Calling onInputDetected with type:', detectedInput.type, 'confidence:', detectedInput.confidence)\n            onInputDetected(detectedInput.type)\n        }\n    }, [detectedInput, onInputDetected])\n\n    // CRITICAL: Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            window.speechSynthesis.cancel()\n            if (scanIntervalRef.current) {\n                clearInterval(scanIntervalRef.current)\n            }\n        }\n    }, [])\n\n    // Draw waveform visualization - ACCESSIBLE: Yellow on Black\n    useEffect(() => {\n        if (!canvasRef.current) return\n\n        const canvas = canvasRef.current\n        const ctx = canvas.getContext('2d')\n        if (!ctx) return\n\n        const draw = () => {\n            // Black background\n            ctx.fillStyle = '#000000'\n            ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n            const barCount = 50\n            const barWidth = canvas.width / barCount\n            const normalizedLevel = Math.min(audioLevel / 100, 1)\n\n            for (let i = 0; i < barCount; i++) {\n                const phase = (i / barCount) * Math.PI * 2\n                const amplitude = Math.sin(phase + Date.now() / 200) * 0.5 + 0.5\n                const height = amplitude * normalizedLevel * canvas.height * 0.8\n\n                // ACCESSIBLE: Solid yellow, no gradients\n                ctx.fillStyle = '#FFFF00'\n\n                const x = i * barWidth\n                const y = (canvas.height - height) / 2\n\n                ctx.fillRect(x, y, barWidth - 2, height)\n            }\n        }\n\n        draw()\n    }, [audioLevel])\n\n    return (\n        <div className=\"fixed inset-0 bg-black flex flex-col items-center justify-center\">\n            <video ref={videoRef} className=\"hidden\" playsInline muted />\n\n            <div className=\"relative mb-8\">\n                <div className=\"w-32 h-32 rounded-full bg-white animate-pulse\"\n                    style={{ animationDuration: '3s' }} />\n\n                {detectedInput && (\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                        {detectedInput.type === 'voice' && <Volume2 className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'motion' && <Activity className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'switch' && <Keyboard className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'blink' && <Eye className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'gaze' && <Eye className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'head' && <Move className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'sign' && <Hand className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'facial' && <Smile className=\"h-16 w-16 text-black animate-bounce\" />}\n                        {detectedInput.type === 'sip-puff' && <Wind className=\"h-16 w-16 text-black animate-bounce\" />}\n                    </div>\n                )}\n            </div>\n\n            {/* GAZE INDICATOR - Shows where you're looking! */}\n            {faceData?.gazeDirection && (\n                <div className=\"absolute top-1/2 left-1/2 pointer-events-none\">\n                    <div\n                        className=\"w-8 h-8 rounded-full bg-red-500 border-4 border-white shadow-lg transition-transform duration-100\"\n                        style={{\n                            transform: `translate(calc(-50% + ${faceData.gazeDirection.x * 100}px), calc(-50% + ${faceData.gazeDirection.y * 100}px))`\n                        }}\n                    />\n                </div>\n            )}\n\n            {/* HEAD ROTATION INDICATOR */}\n            {faceData?.headRotation && (\n                <div className=\"absolute top-8 left-8 bg-black/80 text-white p-4 rounded-lg font-mono text-sm\">\n                    <div>Pitch: {faceData.headRotation.pitch.toFixed(1)}Â°</div>\n                    <div>Yaw: {faceData.headRotation.yaw.toFixed(1)}Â°</div>\n                    <div>Roll: {faceData.headRotation.roll.toFixed(1)}Â°</div>\n                    <div className=\"mt-2 font-bold\">\n                        Total: {(Math.abs(faceData.headRotation.pitch) + Math.abs(faceData.headRotation.yaw) + Math.abs(faceData.headRotation.roll)).toFixed(1)}Â°\n                    </div>\n                </div>\n            )}\n\n            <div className=\"mb-8\">\n                <canvas\n                    ref={canvasRef}\n                    width={600}\n                    height={100}\n                    className=\"rounded-lg border-2 border-white/20\"\n                />\n            </div>\n\n            {transcription && (\n                <div className=\"bg-white/10 backdrop-blur-lg border-2 border-white/30 rounded-2xl px-8 py-4 max-w-2xl animate-in fade-in slide-in-from-bottom-4\">\n                    <p className=\"text-white text-2xl font-bold text-center\">\n                        \"{transcription.text}\"\n                    </p>\n                    <p className=\"text-white/60 text-sm text-center mt-2\">\n                        Confidence: {(transcription.confidence * 100).toFixed(0)}%\n                    </p>\n                </div>\n            )}\n\n            {autoScanStarted && !detectedInput && (\n                <div className=\"absolute bottom-16 text-white text-2xl font-black\">\n                    Auto-Scan Mode Active\n                </div>\n            )}\n\n            {!transcription && !detectedInput && (\n                <div className=\"text-white/60 text-lg font-medium text-center max-w-xl\">\n                    {autoScanStarted\n                        ? 'Press any key when you hear \"Setup\"'\n                        : 'Listening for voice, motion, keyboard, or any input...'}\n                </div>\n            )}\n\n            {/* Debug Status Panel */}\n            <div className=\"absolute top-6 right-6 bg-black/80 text-white border border-white/20 rounded-lg p-4 text-xs font-mono w-72\">\n                <div className=\"font-bold mb-2\">System Status</div>\n                <div>Mic: {status.audioReady ? 'READY' : 'NO'}</div>\n                <div>Camera: {status.videoReady ? 'READY' : 'NO'}</div>\n                <div>Speech API: {status.speechAvailable ? 'YES' : 'NO'}</div>\n                <div>Speech Active: {status.speechActive ? 'YES' : 'NO'}</div>\n                <div>Speech Error: {status.speechError ?? 'none'}</div>\n                <div>MediaPipe: {status.mediaPipeReady ? 'READY' : 'NO'}</div>\n                <div>Face Detected: {status.faceDetected ? 'YES' : 'NO'}</div>\n                <div>Detection Lock: {status.detectionLocked ? 'LOCKED' : 'OPEN'}</div>\n                <div>Audio Level: {Math.round(status.audioLevel)}</div>\n                <div>Last Transcript: {status.lastTranscript || 'â€”'}</div>\n                <div>Speech Event: {status.lastSpeechEvent}</div>\n            </div>\n\n            <div className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n                {detectedInput\n                    ? `${detectedInput.type} input detected`\n                    : autoScanStarted\n                        ? 'Auto-scan mode active. Press any key when you hear Setup.'\n                        : 'Waiting for input. Make any sound or movement to begin.'}\n                {transcription && ` Heard: ${transcription.text}`}\n            </div>\n        </div>\n    )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1736, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/components/onboarding/lock-on-screen.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState, useEffect } from 'react'\nimport { type InputType, usePassiveSensing } from '@/lib/use-passive-sensing'\nimport { Button } from '@/components/ui/button'\n\ninterface LockOnScreenProps {\n    detectedInput: InputType\n    onConfirmed: () => void\n    onTimeout?: () => void\n}\n\nexport function LockOnScreen({ detectedInput, onConfirmed, onTimeout }: LockOnScreenProps) {\n    const [confirmed, setConfirmed] = useState(false)\n    const [listenForConfirm, setListenForConfirm] = useState(false)\n    const [sensingEnabled, setSensingEnabled] = useState(false)\n    const [confirmCount, setConfirmCount] = useState(0)\n    const [timeoutCounter, setTimeoutCounter] = useState(0)\n    const requiredConfirmations = 3\n    \n    // Re-enable passive sensing for confirmation ONLY after initial delay\n    const { detectedInput: confirmInput, videoRef, status } = usePassiveSensing(\n        sensingEnabled && !confirmed,\n        {\n            disableGaze: detectedInput === 'head',\n            disableVoiceVolume: true,  // Always disable voice volume - we only need the specific input type\n            suppressVoiceWhileSpeaking: true,\n            allowedInputTypes: [detectedInput]  // Only allow the specific detected input\n        }\n    )\n\n    const messages: Record<InputType, { initial: string; confirm: string; detected: string }> = {\n        voice: {\n            initial: 'I heard a voice. Speak 3 times to confirm.',\n            confirm: 'Speak now.',\n            detected: 'Voice confirmed!'\n        },\n        motion: {\n            initial: 'I see movement. Move 3 times to confirm.',\n            confirm: 'Move your mouse again.',\n            detected: 'Motion confirmed!'\n        },\n        switch: {\n            initial: 'Switch detected. Press 3 times to confirm.',\n            confirm: 'Press your switch.',\n            detected: 'Switch confirmed!'\n        },\n        blink: {\n            initial: 'I saw a blink. Blink 3 times to confirm.',\n            confirm: 'Blink deliberately.',\n            detected: 'Blink confirmed!'\n        },\n        gaze: {\n            initial: 'Eye gaze detected. Look away and back 3 times.',\n            confirm: 'Look away and back.',\n            detected: 'Eye gaze confirmed!'\n        },\n        head: {\n            initial: 'Head movement detected. Nod 3 times to confirm.',\n            confirm: 'Nod your head.',\n            detected: 'Head motion confirmed!'\n        },\n        sign: {\n            initial: 'Sign language detected. Repeat 3 times to confirm.',\n            confirm: 'Repeat your gesture.',\n            detected: 'Sign language confirmed!'\n        },\n        facial: {\n            initial: 'Facial expression detected. Make it 3 times to confirm.',\n            confirm: 'Make the expression.',\n            detected: 'Facial expression confirmed!'\n        },\n        'sip-puff': {\n            initial: 'Sip or puff detected. Do it 3 times to confirm.',\n            confirm: 'Sip or puff.',\n            detected: 'Sip-puff confirmed!'\n        },\n        none: {\n            initial: 'Waiting for input...',\n            confirm: 'Please try again.',\n            detected: 'Input confirmed!'\n        }\n    }\n\n    const message = messages[detectedInput] || messages.none\n\n    // Auto-play audio (ONCE)\n    useEffect(() => {\n        window.speechSynthesis.cancel()\n        const utterance = new SpeechSynthesisUtterance(message.initial)\n        utterance.rate = 0.9\n        \n        // Wait for TTS to finish, then enable listening\n        utterance.onend = () => {\n            console.log('ðŸŽ¯ TTS finished, enabling listening')\n            setTimeout(() => {\n                window.speechSynthesis.cancel() // Ensure fully cancelled\n                setListenForConfirm(true)\n                setSensingEnabled(true)\n                console.log('ðŸŽ¯ Lock-on: Ready for confirmation input')\n            }, 200)\n        }\n        \n        window.speechSynthesis.speak(utterance)\n    }, []) // Empty deps - only run once\n\n    // Timeout counter\n    useEffect(() => {\n        if (confirmed || !listenForConfirm) return\n\n        const interval = setInterval(() => {\n            setTimeoutCounter(prev => {\n                if (prev + 1 >= 30) {\n                    console.log('â° Confirmation timeout')\n                    if (onTimeout) onTimeout()\n                    return prev\n                }\n                return prev + 1\n            })\n        }, 1000)\n\n        return () => clearInterval(interval)\n    }, [confirmed, listenForConfirm, onTimeout])\n\n    // Listen for confirmation via passive sensing\n    useEffect(() => {\n        if (!listenForConfirm || confirmed || !confirmInput) return\n        \n        // Check if the same input type was detected again\n        if (confirmInput.type === detectedInput) {\n            const newCount = confirmCount + 1\n            console.log(`âœ“ Confirmation ${newCount}/${requiredConfirmations}:`, confirmInput.type)\n            setConfirmCount(newCount)\n            \n            // Visual/audio feedback\n            const beep = new SpeechSynthesisUtterance(`${newCount}`)\n            beep.rate = 1.2\n            beep.volume = 0.8\n            window.speechSynthesis.speak(beep)\n            \n            if (newCount >= requiredConfirmations) {\n                confirmInputAction()\n            } else {\n                // Reset sensing to allow next detection\n                setSensingEnabled(false)\n                setTimeout(() => setSensingEnabled(true), 500)\n            }\n        }\n    }, [confirmInput, listenForConfirm, confirmed, detectedInput, confirmCount])\n\n    // Listen for confirmation input (fallback for non-passive inputs)\n    useEffect(() => {\n        if (!listenForConfirm || confirmed) return\n\n        let clickCount = 0\n        let clickTimer: NodeJS.Timeout\n\n        const handleConfirm = (e: KeyboardEvent) => {\n            if (detectedInput === 'switch' && (e.key === ' ' || e.key === 'Enter')) {\n                const newCount = confirmCount + 1\n                setConfirmCount(newCount)\n                console.log(`âœ“ Switch confirmation ${newCount}/${requiredConfirmations}`)\n                \n                if (newCount >= requiredConfirmations) {\n                    confirmInputAction()\n                }\n            }\n        }\n\n        const handleClick = () => {\n            if (detectedInput === 'motion') {\n                clickCount++\n                console.log(`ðŸ–±ï¸ Motion confirmation ${clickCount}/${requiredConfirmations}`)\n                setConfirmCount(clickCount)\n                \n                if (clickCount >= requiredConfirmations) {\n                    confirmInputAction()\n                }\n                \n                clearTimeout(clickTimer)\n                clickTimer = setTimeout(() => { clickCount = 0 }, 2000)\n            }\n        }\n\n        window.addEventListener('keydown', handleConfirm)\n        window.addEventListener('click', handleClick)\n\n        return () => {\n            window.removeEventListener('keydown', handleConfirm)\n            window.removeEventListener('click', handleClick)\n            clearTimeout(clickTimer)\n        }\n    }, [listenForConfirm, confirmed, detectedInput, confirmCount])\n\n    const confirmInputAction = () => {\n        if (confirmed) return\n        setConfirmed(true)\n\n        window.speechSynthesis.cancel()\n        const utterance = new SpeechSynthesisUtterance(message.detected)\n        utterance.rate = 1.0\n        window.speechSynthesis.speak(utterance)\n\n        setTimeout(() => {\n            onConfirmed()\n        }, 1500)\n    }\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            window.speechSynthesis.cancel()\n        }\n    }, [])\n\n    return (\n        <div className=\"fixed inset-0 bg-black text-white flex flex-col items-center justify-center p-8\">\n            {/* Hidden video element for face detection */}\n            <video ref={videoRef} className=\"hidden\" playsInline muted />\n            \n            <div className=\"max-w-2xl text-center space-y-8\">\n                <div className={`text-6xl font-black transition-all duration-500 ${confirmed ? 'scale-125 text-green-400' : ''}`}>\n                    {confirmed ? 'âœ“' : '?'}\n                </div>\n\n                <h1 className=\"text-3xl font-black\">\n                    {confirmed ? message.detected : message.initial}\n                </h1>\n\n                {!confirmed && (\n                    <>\n                        <p className=\"text-xl text-gray-400\">\n                            {message.confirm}\n                        </p>\n                        \n                        {/* Progress indicator */}\n                        <div className=\"flex justify-center gap-4 mt-8\">\n                            {[...Array(requiredConfirmations)].map((_, i) => (\n                                <div\n                                    key={i}\n                                    className={`w-16 h-16 rounded-full border-4 border-white flex items-center justify-center text-2xl font-black transition-all ${\n                                        i < confirmCount ? 'bg-green-500 scale-110' : 'bg-white/20'\n                                    }`}\n                                >\n                                    {i < confirmCount ? 'âœ“' : i + 1}\n                                </div>\n                            ))}\n                        </div>\n                        \n                        {/* Timeout indicator */}\n                        <p className=\"text-sm text-gray-500 mt-4\">\n                            Time remaining: {30 - timeoutCounter}s\n                        </p>\n                    </>\n                )}\n\n                {/* Manual confirm button (accessible fallback) */}\n                {!confirmed && listenForConfirm && (\n                    <Button\n                        onClick={() => {\n                            const newCount = confirmCount + 1\n                            setConfirmCount(newCount)\n                            if (newCount >= requiredConfirmations) {\n                                confirmInputAction()\n                            }\n                        }}\n                        className=\"mt-8 text-xl px-8 py-6 font-bold border-4 border-white bg-green-600 hover:bg-green-700 text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)]\"\n                    >\n                        Count ({confirmCount}/{requiredConfirmations})\n                    </Button>\n                )}\n            </div>\n\n            <div className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n                {confirmed ? message.detected : message.initial}\n            </div>\n\n            {/* Debug Status Panel */}\n            <div className=\"absolute top-6 right-6 bg-black/80 text-white border border-white/20 rounded-lg p-4 text-xs font-mono w-80\">\n                <div className=\"font-bold mb-2\">System Status</div>\n                <div>Mic: {status.audioReady ? 'READY' : 'NO'}</div>\n                <div>Camera: {status.videoReady ? 'READY' : 'NO'}</div>\n                <div className=\"mt-2 font-bold\">Web Speech API</div>\n                <div>Available: {status.speechAvailable ? 'YES' : 'NO'}</div>\n                <div>Active: {status.speechActive ? 'YES' : 'NO'}</div>\n                <div>Error: {status.speechError ?? 'none'}</div>\n                <div className=\"mt-2 font-bold\">Local Speech (Whisper)</div>\n                <div className={status.localSpeechAvailable ? 'text-green-400' : 'text-red-400'}>\n                    Service: {status.localSpeechAvailable ? 'READY âœ“' : 'NOT RUNNING âœ—'}\n                </div>\n                <div>Recording: {status.localSpeechRecording ? 'YES' : 'NO'}</div>\n                {status.localSpeechError && (\n                    <div className=\"text-yellow-400 text-xs mt-1\">\n                        {status.localSpeechError}\n                    </div>\n                )}\n                <div className=\"mt-2 font-bold\">Detection</div>\n                <div>MediaPipe: {status.mediaPipeReady ? 'READY' : 'NO'}</div>\n                <div>Face: {status.faceDetected ? 'YES' : 'NO'}</div>\n                <div>Lock: {status.detectionLocked ? 'LOCKED' : 'OPEN'}</div>\n                <div>Audio Level: {Math.round(status.audioLevel)}</div>\n                <div className=\"mt-2 font-bold\">Transcript</div>\n                <div className=\"text-white break-words\">{status.lastTranscript || 'â€”'}</div>\n            </div>\n        </div>\n    )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2238, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/components/onboarding/input-explorer.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { useState, useEffect } from 'react'\r\nimport { type InputType, usePassiveSensing } from '@/lib/use-passive-sensing'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Volume2, Eye, Hand, Keyboard, Activity, Wind, Smile, Move, Zap } from 'lucide-react'\r\n\r\ninterface InputExplorerProps {\r\n    primaryInput: InputType\r\n    detectedInputs: InputType[]\r\n    onComplete: (allInputs: InputType[]) => void\r\n}\r\n\r\nexport function InputExplorer({ primaryInput, detectedInputs: initialInputs, onComplete }: InputExplorerProps) {\r\n    const [detectedInputs, setDetectedInputs] = useState<InputType[]>(initialInputs)\r\n    const [testedInputs, setTestedInputs] = useState<InputType[]>(initialInputs)\r\n    const [currentlyTesting, setCurrentlyTesting] = useState<InputType | null>(null)\r\n    const [skipCount, setSkipCount] = useState(0)\r\n    const [confirmCount, setConfirmCount] = useState(0)\r\n    const [sensingEnabled, setSensingEnabled] = useState(true)\r\n    const [timeoutCounter, setTimeoutCounter] = useState(0)\r\n    const [voiceChallenge, setVoiceChallenge] = useState<{ category: 'color' | 'shape' | 'fruit'; word: string } | null>(null)\r\n    const [voiceChallengeStart, setVoiceChallengeStart] = useState<number>(0)\r\n    const [voiceChallengeExpires, setVoiceChallengeExpires] = useState<number>(0)\r\n    const [voiceSessionStart, setVoiceSessionStart] = useState<number>(0)\r\n    const requiredConfirmations = 3\r\n\r\n    const { detectedInput, transcription, videoRef, status, requestSpeechStart } = usePassiveSensing(\r\n        sensingEnabled && !!currentlyTesting,\r\n        {\r\n            disableVoiceVolume: currentlyTesting !== 'voice',  // Only enable for voice testing\r\n            disableGaze: currentlyTesting === 'head',\r\n            disableVoiceVolume: primaryInput === 'voice'\r\n            ,allowedInputTypes: currentlyTesting === 'head' ? ['head'] : undefined\r\n        }\r\n    )\r\n\r\n    // All possible inputs to test\r\n    const allInputTypes: InputType[] = ['voice', 'head', 'blink', 'gaze', 'switch', 'motion', 'sign', 'facial', 'sip-puff']\r\n    \r\n    // Inputs we haven't tested yet\r\n    const untested = allInputTypes.filter(input => !testedInputs.includes(input))\r\n\r\n    const inputIcons: Record<InputType, React.ReactNode> = {\r\n        voice: <Volume2 className=\"h-12 w-12\" />,\r\n        motion: <Activity className=\"h-12 w-12\" />,\r\n        switch: <Keyboard className=\"h-12 w-12\" />,\r\n        blink: <Eye className=\"h-12 w-12\" />,\r\n        gaze: <Eye className=\"h-12 w-12\" />,\r\n        head: <Move className=\"h-12 w-12\" />,\r\n        sign: <Hand className=\"h-12 w-12\" />,\r\n        facial: <Smile className=\"h-12 w-12\" />,\r\n        'sip-puff': <Wind className=\"h-12 w-12\" />,\r\n        none: <Zap className=\"h-12 w-12\" />\r\n    }\r\n\r\n    const inputPrompts: Record<InputType, string> = {\r\n        voice: 'Voice check: say the word shown on screen. Get 3 correct in a row.',\r\n        head: 'Can you move your head? Nod 3 times.',\r\n        blink: 'Can you blink deliberately? Blink 3 times.',\r\n        gaze: 'Can you move your eyes? Look away and back 3 times.',\r\n        switch: 'Can you use a keyboard or switch? Press any key 3 times.',\r\n        motion: 'Can you use a mouse or touch? Click anywhere 3 times.',\r\n        sign: 'Can you make hand gestures? Make a gesture 3 times.',\r\n        facial: 'Can you make facial expressions? Smile or frown 3 times.',\r\n        'sip-puff': 'Can you use sip-puff controls? Use them 3 times.',\r\n        none: ''\r\n    }\r\n\r\n    const skipPrompt = primaryInput === 'voice' \r\n        ? 'Say \"skip\" 3 times to skip'\r\n        : primaryInput === 'head'\r\n        ? 'Nod 3 times to skip'\r\n        : primaryInput === 'blink'\r\n        ? 'Blink 3 times to skip'\r\n        : primaryInput === 'switch'\r\n        ? 'Press any key 3 times to skip'\r\n        : 'Use your primary input 3 times to skip'\r\n\r\n    // Auto-start testing next input\r\n    useEffect(() => {\r\n        if (!currentlyTesting && untested.length > 0) {\r\n            const nextInput = untested[0]\r\n            setCurrentlyTesting(nextInput)\r\n            setConfirmCount(0)\r\n            setSkipCount(0)\r\n            setTimeoutCounter(0)\r\n            setSensingEnabled(false)\r\n            setTimeout(() => setSensingEnabled(true), 50)\r\n            setVoiceChallenge(null)\r\n            setVoiceChallengeStart(0)\r\n            setVoiceChallengeExpires(0)\r\n            setVoiceSessionStart(Date.now())\r\n\r\n            window.speechSynthesis.cancel()\r\n            const utterance = new SpeechSynthesisUtterance(\r\n                `Let's try ${nextInput}. ${inputPrompts[nextInput]} Or ${skipPrompt}.`\r\n            )\r\n            utterance.rate = 0.9\r\n            window.speechSynthesis.speak(utterance)\r\n        } else if (untested.length === 0 && currentlyTesting === null) {\r\n            // All done!\r\n            onComplete(detectedInputs)\r\n        }\r\n    }, [currentlyTesting, untested.length, detectedInputs, onComplete])\r\n\r\n    // Watchdog: if we ever get stuck on the \"Analyzing inputs...\" screen, advance.\r\n    useEffect(() => {\r\n        if (currentlyTesting !== null) return\r\n        const timer = setTimeout(() => {\r\n            if (untested.length > 0) {\r\n                setCurrentlyTesting(untested[0])\r\n            } else {\r\n                onComplete(detectedInputs)\r\n            }\r\n        }, 1500)\r\n        return () => clearTimeout(timer)\r\n    }, [currentlyTesting, untested.length, onComplete, detectedInputs])\r\n\r\n    // Timeout counter\r\n    useEffect(() => {\r\n        if (!currentlyTesting) return\r\n\r\n        const interval = setInterval(() => {\r\n            setTimeoutCounter(prev => {\r\n                if (prev + 1 >= 30) {\r\n                    console.log('â° Timeout - skipping', currentlyTesting)\r\n                    handleSkip()\r\n                    return 0\r\n                }\r\n                return prev + 1\r\n            })\r\n        }, 1000)\r\n\r\n        return () => clearInterval(interval)\r\n    }, [currentlyTesting])\r\n\r\n    const pickVoiceChallenge = () => {\r\n        const categories: Array<{ category: 'color' | 'shape' | 'fruit'; words: string[] }> = [\r\n            { category: 'color', words: ['red', 'blue', 'green', 'yellow', 'orange', 'purple'] },\r\n            { category: 'shape', words: ['circle', 'square', 'triangle', 'star', 'heart'] },\r\n            { category: 'fruit', words: ['apple', 'banana', 'orange', 'grape', 'pear'] }\r\n        ]\r\n        const cat = categories[Math.floor(Math.random() * categories.length)]\r\n        const word = cat.words[Math.floor(Math.random() * cat.words.length)]\r\n        setVoiceChallenge({ category: cat.category, word })\r\n        const now = Date.now()\r\n        setVoiceChallengeStart(now)\r\n        setVoiceChallengeExpires(now + 10000)\r\n    }\r\n\r\n    // Voice challenge lifecycle\r\n    useEffect(() => {\r\n        if (currentlyTesting !== 'voice') return\r\n\r\n        if (!voiceChallenge) {\r\n            pickVoiceChallenge()\r\n            return\r\n        }\r\n\r\n        const timer = setInterval(() => {\r\n            const now = Date.now()\r\n            if (now >= voiceChallengeExpires) {\r\n                pickVoiceChallenge()\r\n            }\r\n        }, 500)\r\n\r\n        return () => clearInterval(timer)\r\n    }, [currentlyTesting, voiceChallenge, voiceChallengeExpires])\r\n\r\n    // Listen for new input detection\r\n    useEffect(() => {\r\n        if (!detectedInput || !currentlyTesting) return\r\n        if (currentlyTesting === 'voice') return\r\n\r\n        // Testing for this specific input\r\n        if (detectedInput.type === currentlyTesting) {\r\n            const newCount = confirmCount + 1\r\n            console.log(`âœ“ ${currentlyTesting} confirmation ${newCount}/${requiredConfirmations}`)\r\n            setConfirmCount(newCount)\r\n\r\n            const beep = new SpeechSynthesisUtterance(`${newCount}`)\r\n            beep.rate = 1.2\r\n            window.speechSynthesis.speak(beep)\r\n\r\n            if (newCount >= requiredConfirmations) {\r\n                handleConfirm(currentlyTesting)\r\n            } else {\r\n                // Reset sensing\r\n                setSensingEnabled(false)\r\n                setTimeout(() => setSensingEnabled(true), 500)\r\n            }\r\n        }\r\n        // Skip via primary input\r\n        else if (detectedInput.type === primaryInput && primaryInput !== 'voice') {\r\n            const newCount = skipCount + 1\r\n            console.log(`â­ï¸ Skip count ${newCount}/${requiredConfirmations}`)\r\n            setSkipCount(newCount)\r\n\r\n            const beep = new SpeechSynthesisUtterance(`skip ${newCount}`)\r\n            beep.rate = 1.2\r\n            window.speechSynthesis.speak(beep)\r\n\r\n            if (newCount >= requiredConfirmations) {\r\n                handleSkip()\r\n            } else {\r\n                // Reset sensing\r\n                setSensingEnabled(false)\r\n                setTimeout(() => setSensingEnabled(true), 500)\r\n            }\r\n        }\r\n    }, [detectedInput, currentlyTesting, confirmCount, skipCount, primaryInput])\r\n\r\n    // Voice skip via transcription (all tests)\r\n    useEffect(() => {\r\n        if (primaryInput !== 'voice' || !transcription || !currentlyTesting) return\r\n        const text = transcription.text.toLowerCase()\r\n        if (!text.includes('skip')) return\r\n\r\n        const newCount = skipCount + 1\r\n        setSkipCount(newCount)\r\n        const beep = new SpeechSynthesisUtterance(`skip ${newCount}`)\r\n        beep.rate = 1.2\r\n        window.speechSynthesis.speak(beep)\r\n        if (newCount >= requiredConfirmations) {\r\n            handleSkip()\r\n        }\r\n    }, [primaryInput, transcription, currentlyTesting, skipCount])\r\n\r\n    // Voice verification via transcription\r\n    useEffect(() => {\r\n        if (currentlyTesting !== 'voice' || !transcription) return\r\n        const text = transcription.text.toLowerCase()\r\n\r\n        if (voiceChallenge && text.includes(voiceChallenge.word)) {\r\n            const newCount = confirmCount + 1\r\n            setConfirmCount(newCount)\r\n            const beep = new SpeechSynthesisUtterance(`${newCount}`)\r\n            beep.rate = 1.2\r\n            window.speechSynthesis.speak(beep)\r\n\r\n            if (newCount >= requiredConfirmations) {\r\n                handleConfirm('voice')\r\n            } else {\r\n                pickVoiceChallenge()\r\n            }\r\n        }\r\n    }, [currentlyTesting, transcription, voiceChallenge, confirmCount, skipCount, primaryInput])\r\n\r\n    const handleConfirm = (inputType: InputType) => {\r\n        console.log('âœ“ Confirmed:', inputType)\r\n        setDetectedInputs(prev => [...prev, inputType])\r\n        setTestedInputs(prev => (prev.includes(inputType) ? prev : [...prev, inputType]))\r\n        \r\n        window.speechSynthesis.cancel()\r\n        const utterance = new SpeechSynthesisUtterance(`Great! ${inputType} confirmed.`)\r\n        utterance.rate = 1.0\r\n        window.speechSynthesis.speak(utterance)\r\n\r\n        setTimeout(() => {\r\n            setCurrentlyTesting(null)\r\n            setConfirmCount(0)\r\n            setSkipCount(0)\r\n        }, 1500)\r\n    }\r\n\r\n    const handleSkip = () => {\r\n        console.log('â­ï¸ Skipped:', currentlyTesting)\r\n        if (currentlyTesting) {\r\n            setTestedInputs(prev => (prev.includes(currentlyTesting) ? prev : [...prev, currentlyTesting]))\r\n        }\r\n        \r\n        window.speechSynthesis.cancel()\r\n        const utterance = new SpeechSynthesisUtterance('Skipped.')\r\n        utterance.rate = 1.0\r\n        window.speechSynthesis.speak(utterance)\r\n\r\n        setTimeout(() => {\r\n            setCurrentlyTesting(null)\r\n            setConfirmCount(0)\r\n            setSkipCount(0)\r\n        }, 800)\r\n    }\r\n\r\n    // Cleanup\r\n    useEffect(() => {\r\n        return () => {\r\n            window.speechSynthesis.cancel()\r\n        }\r\n    }, [])\r\n\r\n    if (!currentlyTesting) {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-gradient-to-br from-green-500 to-blue-600 flex items-center justify-center\">\r\n                <div className=\"text-white text-center\">\r\n                    <div className=\"text-6xl mb-4 animate-pulse\">âœ“</div>\r\n                    <h2 className=\"text-3xl font-black\">Analyzing inputs...</h2>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black text-white flex flex-col items-center justify-center p-8\">\r\n            <video ref={videoRef} className=\"hidden\" playsInline muted />\r\n\r\n            <div className=\"max-w-3xl text-center space-y-8\">\r\n                {/* Icon */}\r\n                <div className=\"flex justify-center\">\r\n                    <div className=\"w-32 h-32 bg-white/10 rounded-full flex items-center justify-center\">\r\n                        {inputIcons[currentlyTesting]}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Prompt */}\r\n                <h1 className=\"text-3xl font-black\">\r\n                    {inputPrompts[currentlyTesting]}\r\n                </h1>\r\n\r\n                {currentlyTesting === 'voice' && voiceChallenge && (\r\n                    <div className=\"bg-white text-black rounded-2xl px-8 py-6 inline-flex flex-col items-center gap-2 border-4 border-white\">\r\n                        <div className=\"text-sm font-semibold uppercase tracking-wide\">\r\n                            Say the {voiceChallenge.category}\r\n                        </div>\r\n                        <div className=\"text-4xl font-black\">\r\n                            {voiceChallenge.word}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-600\">\r\n                            {Math.max(0, Math.ceil((voiceChallengeExpires - Date.now()) / 1000))}s remaining\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {currentlyTesting === 'voice' && (!status.speechActive || status.speechError) && (\r\n                    <button\r\n                        onClick={() => requestSpeechStart?.()}\r\n                        className=\"mt-4 px-6 py-3 bg-white text-black font-bold rounded-lg border-4 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)]\"\r\n                    >\r\n                        Enable Voice Recognition\r\n                    </button>\r\n                )}\r\n\r\n                {/* Progress indicators */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Confirm progress */}\r\n                    <div>\r\n                        <p className=\"text-sm text-gray-400 mb-2\">Try it:</p>\r\n                        <div className=\"flex justify-center gap-4\">\r\n                            {[...Array(requiredConfirmations)].map((_, i) => (\r\n                                <div\r\n                                    key={i}\r\n                                    className={`w-12 h-12 rounded-full border-4 border-white flex items-center justify-center text-lg font-black transition-all ${\r\n                                        i < confirmCount ? 'bg-green-500 scale-110' : 'bg-white/20'\r\n                                    }`}\r\n                                >\r\n                                    {i < confirmCount ? 'âœ“' : i + 1}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Skip progress */}\r\n                    <div>\r\n                        <p className=\"text-sm text-gray-400 mb-2\">{skipPrompt}</p>\r\n                        <div className=\"flex justify-center gap-4\">\r\n                            {[...Array(requiredConfirmations)].map((_, i) => (\r\n                                <div\r\n                                    key={i}\r\n                                    className={`w-12 h-12 rounded-full border-4 border-gray-500 flex items-center justify-center text-lg font-black transition-all ${\r\n                                        i < skipCount ? 'bg-gray-600 scale-110' : 'bg-white/10'\r\n                                    }`}\r\n                                >\r\n                                    {i < skipCount ? 'â­' : i + 1}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Timeout */}\r\n                <p className=\"text-sm text-gray-500\">\r\n                    Auto-skip in {30 - timeoutCounter}s\r\n                </p>\r\n\r\n                {/* Progress through all inputs */}\r\n                <div className=\"pt-8 border-t border-white/20\">\r\n                    <p className=\"text-sm text-gray-400 mb-4\">\r\n                        Testing {detectedInputs.length + 1} of {allInputTypes.length} inputs\r\n                    </p>\r\n                    <div className=\"flex justify-center gap-2 flex-wrap\">\r\n                        {allInputTypes.map(input => (\r\n                            <div\r\n                                key={input}\r\n                                className={`px-3 py-1 rounded-full text-xs font-bold ${\r\n                                    detectedInputs.includes(input)\r\n                                        ? 'bg-green-500 text-white'\r\n                                        : input === currentlyTesting\r\n                                        ? 'bg-yellow-500 text-black'\r\n                                        : 'bg-white/10 text-gray-400'\r\n                                }`}\r\n                            >\r\n                                {input}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Manual buttons */}\r\n                <div className=\"flex gap-4 justify-center pt-4\">\r\n                    <Button\r\n                        onClick={() => {\r\n                            const newCount = confirmCount + 1\r\n                            setConfirmCount(newCount)\r\n                            if (newCount >= requiredConfirmations) {\r\n                                handleConfirm(currentlyTesting)\r\n                            }\r\n                        }}\r\n                        className=\"text-lg px-6 py-4 font-bold border-4 border-white bg-green-600 hover:bg-green-700\"\r\n                    >\r\n                        Yes ({confirmCount}/{requiredConfirmations})\r\n                    </Button>\r\n                    <Button\r\n                        onClick={() => {\r\n                            const newCount = skipCount + 1\r\n                            setSkipCount(newCount)\r\n                            if (newCount >= requiredConfirmations) {\r\n                                handleSkip()\r\n                            }\r\n                        }}\r\n                        className=\"text-lg px-6 py-4 font-bold border-4 border-white bg-gray-600 hover:bg-gray-700\"\r\n                    >\r\n                        Skip ({skipCount}/{requiredConfirmations})\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Debug Status Panel */}\r\n            <div className=\"absolute top-6 right-6 bg-black/80 text-white border border-white/20 rounded-lg p-4 text-xs font-mono w-72\">\r\n                <div className=\"font-bold mb-2\">System Status</div>\r\n                <div>Mic: {status.audioReady ? 'READY' : 'NO'}</div>\r\n                <div>Camera: {status.videoReady ? 'READY' : 'NO'}</div>\r\n                <div>Speech API: {status.speechAvailable ? 'YES' : 'NO'}</div>\r\n                <div>Speech Active: {status.speechActive ? 'YES' : 'NO'}</div>\r\n                <div>Speech Error: {status.speechError ?? 'none'}</div>\r\n                <div>MediaPipe: {status.mediaPipeReady ? 'READY' : 'NO'}</div>\r\n                <div>Face Detected: {status.faceDetected ? 'YES' : 'NO'}</div>\r\n                <div>Detection Lock: {status.detectionLocked ? 'LOCKED' : 'OPEN'}</div>\r\n                <div>Audio Level: {Math.round(status.audioLevel)}</div>\r\n                <div>Last Transcript: {status.lastTranscript || 'â€”'}</div>\r\n                <div>Speech Event: {status.lastSpeechEvent}</div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3075, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jason/Documents/GitHub/ntu-beyond-binary/frontend/app/onboarding/page.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { BeaconScreen } from '@/components/onboarding/beacon-screen'\nimport { LockOnScreen } from '@/components/onboarding/lock-on-screen'\nimport { InputExplorer } from '@/components/onboarding/input-explorer'\nimport { type InputType } from '@/lib/use-passive-sensing'\nimport { useFluentContext } from '@/lib/fluent-context'\n\ntype OnboardingStep = 'beacon' | 'lock-on' | 'explore' | 'name' | 'complete'\n\nexport default function OnboardingPage() {\n    const router = useRouter()\n    const { updateSetting } = useFluentContext()\n    const [step, setStep] = useState<OnboardingStep>('beacon')\n    const [detectedInputType, setDetectedInputType] = useState<InputType>('none')\n    const [allDetectedInputs, setAllDetectedInputs] = useState<InputType[]>([])\n    const [profileName, setProfileName] = useState('')\n\n    const handleInputDetected = (type: InputType) => {\n        console.log('ðŸŽ¯ OnboardingPage.handleInputDetected called with type:', type)\n        setDetectedInputType(type)\n        setAllDetectedInputs([type])\n        setStep('lock-on')\n    }\n\n    const handleLockOnConfirmed = () => {\n        console.log('Lock-on confirmed, exploring other inputs')\n        setStep('explore')\n    }\n\n    const handleLockOnTimeout = () => {\n        console.log('Lock-on timeout, returning to beacon')\n        setStep('beacon')\n        setDetectedInputType('none')\n    }\n\n    const handleExplorationComplete = (allInputs: InputType[]) => {\n        console.log('Exploration complete:', allInputs)\n        setAllDetectedInputs(allInputs)\n        setStep('name')\n    }\n\n    const handleProfileNameSubmit = () => {\n        if (!profileName.trim() || allDetectedInputs.length === 0) return\n\n        // Default settings based on inputs\n        updateSetting('dwellTime', 1000)\n        updateSetting('tremorFilter', 0)\n\n        // Create profile object\n        const profile = {\n            name: profileName.trim(),\n            primaryInput: detectedInputType,\n            availableInputs: allDetectedInputs,\n            lastUsed: new Date().toISOString(),\n            calibration: {\n                primaryInput: detectedInputType,\n                availableInputs: allDetectedInputs,\n                precision: 'medium' as const,\n                tremorDetected: false,\n                dwellTime: 1000,\n                rangeOfMotion: 100,\n                preferredSpeed: 'medium' as const\n            }\n        }\n\n        // Save to profiles list\n        const existingProfiles = JSON.parse(localStorage.getItem('fluent-user-profiles') || '[]')\n        existingProfiles.push(profile)\n        localStorage.setItem('fluent-user-profiles', JSON.stringify(existingProfiles))\n\n        // Mark onboarding as complete\n        localStorage.setItem('fluent-onboarding-complete', 'true')\n        localStorage.setItem('fluent-current-profile', profileName.trim())\n        localStorage.setItem('fluent-primary-input', detectedInputType)\n        localStorage.setItem('fluent-available-inputs', JSON.stringify(allDetectedInputs))\n        localStorage.setItem('fluent-calibration', JSON.stringify(profile.calibration))\n\n        setStep('complete')\n\n        // Redirect to dashboard after showing success\n        setTimeout(() => {\n            router.push('/')\n        }, 3000)\n    }\n\n    const handleSkipOnboarding = () => {\n        // Set minimal defaults\n        updateSetting('dwellTime', 1000)\n        updateSetting('tremorFilter', 0)\n\n        // Create default profile\n        const defaultProfile = {\n            name: 'Guest',\n            primaryInput: 'type' as InputType,\n            availableInputs: ['type', 'voice'] as InputType[],\n            lastUsed: new Date().toISOString(),\n            calibration: {\n                primaryInput: 'type' as InputType,\n                availableInputs: ['type', 'voice'] as InputType[],\n                precision: 'medium' as const,\n                tremorDetected: false,\n                dwellTime: 1000,\n                rangeOfMotion: 100,\n                preferredSpeed: 'medium' as const\n            }\n        }\n\n        // Save minimal profile\n        const existingProfiles = JSON.parse(localStorage.getItem('fluent-user-profiles') || '[]')\n        existingProfiles.push(defaultProfile)\n        localStorage.setItem('fluent-user-profiles', JSON.stringify(existingProfiles))\n\n        // Mark onboarding as skipped/complete\n        localStorage.setItem('fluent-onboarding-complete', 'true')\n        localStorage.setItem('fluent-current-profile', 'Guest')\n        localStorage.setItem('fluent-primary-input', 'type')\n        localStorage.setItem('fluent-available-inputs', JSON.stringify(['type', 'voice']))\n        localStorage.setItem('fluent-calibration', JSON.stringify(defaultProfile.calibration))\n\n        // Redirect to dashboard\n        router.push('/')\n    }\n\n    return (\n        <>\n            {/* Skip Button - Always visible except on complete step */}\n            {step !== 'complete' && (\n                <button\n                    onClick={handleSkipOnboarding}\n                    className=\"fixed top-6 left-6 z-50 bg-white hover:bg-gray-100 text-gray-800 font-bold py-2 px-4 rounded-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all\"\n                    aria-label=\"Skip onboarding\"\n                >\n                    Skip Onboarding â†’\n                </button>\n            )}\n\n            {step === 'beacon' && <BeaconScreen onInputDetected={handleInputDetected} />}\n\n            {step === 'lock-on' && (\n                <LockOnScreen\n                    detectedInput={detectedInputType}\n                    onConfirmed={handleLockOnConfirmed}\n                    onTimeout={handleLockOnTimeout}\n                />\n            )}\n\n            {step === 'explore' && (\n                <InputExplorer\n                    primaryInput={detectedInputType}\n                    detectedInputs={allDetectedInputs}\n                    onComplete={handleExplorationComplete}\n                />\n            )}\n\n            {step === 'name' && (\n                <div className=\"fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-8\">\n                    <div className=\"bg-white rounded-2xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] p-8 max-w-md w-full\">\n                        <h2 className=\"text-3xl font-black mb-4 text-center\">What's your name?</h2>\n                        <p className=\"text-gray-600 mb-6 text-center\">This helps us save your settings</p>\n\n                        <input\n                            type=\"text\"\n                            value={profileName}\n                            onChange={(e) => setProfileName(e.target.value)}\n                            onKeyDown={(e) => e.key === 'Enter' && handleProfileNameSubmit()}\n                            placeholder=\"Enter your name\"\n                            className=\"w-full px-4 py-3 border-4 border-black rounded-lg text-lg font-bold mb-4 focus:outline-none focus:ring-4 focus:ring-blue-400\"\n                            autoFocus\n                        />\n\n                        <button\n                            onClick={handleProfileNameSubmit}\n                            disabled={!profileName.trim()}\n                            className=\"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-black py-3 px-6 rounded-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all disabled:cursor-not-allowed\"\n                        >\n                            Continue\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {step === 'complete' && (\n                <div className=\"fixed inset-0 bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center p-8\">\n                    <div className=\"text-center\">\n                        <div className=\"text-9xl mb-8 animate-bounce\">âœ“</div>\n                        <h1 className=\"text-6xl font-black text-white mb-4\">Welcome, {profileName}!</h1>\n                        <p className=\"text-2xl text-white/80 font-bold\">Your profile is ready</p>\n                        <p className=\"text-lg text-white/60 mt-4\">\n                            Primary Input: {detectedInputType}\n                        </p>\n                        {allDetectedInputs.length > 1 && (\n                            <p className=\"text-lg text-white/60\">\n                                Also available: {allDetectedInputs.filter(i => i !== detectedInputType).join(', ')}\n                            </p>\n                        )}\n                    </div>\n                </div>\n            )}\n        </>\n    )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAEA;AARA;;;;;;;;AAYe,SAAS;IACpB,MAAM,SAAS,IAAA,6MAAS;IACxB,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,2MAAgB;IAC1C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+QAAQ,EAAiB;IACjD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,+QAAQ,EAAY;IACtE,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,+QAAQ,EAAc,EAAE;IAC1E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,+QAAQ,EAAC;IAE/C,MAAM,sBAAsB,CAAC;QACzB,QAAQ,GAAG,CAAC,2DAA2D;QACvE,qBAAqB;QACrB,qBAAqB;YAAC;SAAK;QAC3B,QAAQ;IACZ;IAEA,MAAM,wBAAwB;QAC1B,QAAQ,GAAG,CAAC;QACZ,QAAQ;IACZ;IAEA,MAAM,sBAAsB;QACxB,QAAQ,GAAG,CAAC;QACZ,QAAQ;QACR,qBAAqB;IACzB;IAEA,MAAM,4BAA4B,CAAC;QAC/B,QAAQ,GAAG,CAAC,yBAAyB;QACrC,qBAAqB;QACrB,QAAQ;IACZ;IAEA,MAAM,0BAA0B;QAC5B,IAAI,CAAC,YAAY,IAAI,MAAM,kBAAkB,MAAM,KAAK,GAAG;QAE3D,mCAAmC;QACnC,cAAc,aAAa;QAC3B,cAAc,gBAAgB;QAE9B,wBAAwB;QACxB,MAAM,UAAU;YACZ,MAAM,YAAY,IAAI;YACtB,cAAc;YACd,iBAAiB;YACjB,UAAU,IAAI,OAAO,WAAW;YAChC,aAAa;gBACT,cAAc;gBACd,iBAAiB;gBACjB,WAAW;gBACX,gBAAgB;gBAChB,WAAW;gBACX,eAAe;gBACf,gBAAgB;YACpB;QACJ;QAEA,wBAAwB;QACxB,MAAM,mBAAmB,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,2BAA2B;QACpF,iBAAiB,IAAI,CAAC;QACtB,aAAa,OAAO,CAAC,wBAAwB,KAAK,SAAS,CAAC;QAE5D,8BAA8B;QAC9B,aAAa,OAAO,CAAC,8BAA8B;QACnD,aAAa,OAAO,CAAC,0BAA0B,YAAY,IAAI;QAC/D,aAAa,OAAO,CAAC,wBAAwB;QAC7C,aAAa,OAAO,CAAC,2BAA2B,KAAK,SAAS,CAAC;QAC/D,aAAa,OAAO,CAAC,sBAAsB,KAAK,SAAS,CAAC,QAAQ,WAAW;QAE7E,QAAQ;QAER,8CAA8C;QAC9C,WAAW;YACP,OAAO,IAAI,CAAC;QAChB,GAAG;IACP;IAEA,MAAM,uBAAuB;QACzB,uBAAuB;QACvB,cAAc,aAAa;QAC3B,cAAc,gBAAgB;QAE9B,yBAAyB;QACzB,MAAM,iBAAiB;YACnB,MAAM;YACN,cAAc;YACd,iBAAiB;gBAAC;gBAAQ;aAAQ;YAClC,UAAU,IAAI,OAAO,WAAW;YAChC,aAAa;gBACT,cAAc;gBACd,iBAAiB;oBAAC;oBAAQ;iBAAQ;gBAClC,WAAW;gBACX,gBAAgB;gBAChB,WAAW;gBACX,eAAe;gBACf,gBAAgB;YACpB;QACJ;QAEA,uBAAuB;QACvB,MAAM,mBAAmB,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,2BAA2B;QACpF,iBAAiB,IAAI,CAAC;QACtB,aAAa,OAAO,CAAC,wBAAwB,KAAK,SAAS,CAAC;QAE5D,sCAAsC;QACtC,aAAa,OAAO,CAAC,8BAA8B;QACnD,aAAa,OAAO,CAAC,0BAA0B;QAC/C,aAAa,OAAO,CAAC,wBAAwB;QAC7C,aAAa,OAAO,CAAC,2BAA2B,KAAK,SAAS,CAAC;YAAC;YAAQ;SAAQ;QAChF,aAAa,OAAO,CAAC,sBAAsB,KAAK,SAAS,CAAC,eAAe,WAAW;QAEpF,wBAAwB;QACxB,OAAO,IAAI,CAAC;IAChB;IAEA,qBACI;;YAEK,SAAS,4BACN,4SAAC;gBACG,SAAS;gBACT,WAAU;gBACV,cAAW;0BACd;;;;;;YAKJ,SAAS,0BAAY,4SAAC,2NAAY;gBAAC,iBAAiB;;;;;;YAEpD,SAAS,2BACN,4SAAC,+NAAY;gBACT,eAAe;gBACf,aAAa;gBACb,WAAW;;;;;;YAIlB,SAAS,2BACN,4SAAC,6NAAa;gBACV,cAAc;gBACd,gBAAgB;gBAChB,YAAY;;;;;;YAInB,SAAS,wBACN,4SAAC;gBAAI,WAAU;0BACX,cAAA,4SAAC;oBAAI,WAAU;;sCACX,4SAAC;4BAAG,WAAU;sCAAuC;;;;;;sCACrD,4SAAC;4BAAE,WAAU;sCAAiC;;;;;;sCAE9C,4SAAC;4BACG,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;4BAC9C,WAAW,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW;4BACvC,aAAY;4BACZ,WAAU;4BACV,SAAS;;;;;;sCAGb,4SAAC;4BACG,SAAS;4BACT,UAAU,CAAC,YAAY,IAAI;4BAC3B,WAAU;sCACb;;;;;;;;;;;;;;;;;YAOZ,SAAS,4BACN,4SAAC;gBAAI,WAAU;0BACX,cAAA,4SAAC;oBAAI,WAAU;;sCACX,4SAAC;4BAAI,WAAU;sCAA+B;;;;;;sCAC9C,4SAAC;4BAAG,WAAU;;gCAAsC;gCAAU;gCAAY;;;;;;;sCAC1E,4SAAC;4BAAE,WAAU;sCAAmC;;;;;;sCAChD,4SAAC;4BAAE,WAAU;;gCAA6B;gCACtB;;;;;;;wBAEnB,kBAAkB,MAAM,GAAG,mBACxB,4SAAC;4BAAE,WAAU;;gCAAwB;gCAChB,kBAAkB,MAAM,CAAC,CAAA,IAAK,MAAM,mBAAmB,IAAI,CAAC;;;;;;;;;;;;;;;;;;;;AAQ7G"}}]
}